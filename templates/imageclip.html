<!DOCTYPE html>
{% load i18n %}
{% get_current_language as LANGUAGE_CODE %}
<html translate="no">
<head><meta charset="utf-8">
<title>{% trans "Image Clip" %}</title>
<link href="../static/style/font-awesome/css/font-awesome.min.css" rel="stylesheet" type="text/css" />
<script src="../static/javascript/jquery-1.12.4.min.js"></script>
<script src="../static/javascript/information/jquery-migrate-1.4.1.min.js"></script>
<link rel="stylesheet" href="../static/style/information/font-icons/font-icons.min.css" />
<link rel="stylesheet" href="../static/style/information/bootstrap/bootstrap.min.css" />
<link rel="stylesheet" href="../static/style/information/select2.css">
<link rel="stylesheet" href="../static/style/information/grey.css">
<link rel="stylesheet" href="../static/style/information/AdminLTE.min.css">
<link rel="stylesheet" href="../static/style/information/jeesite.css">
<!--<link rel="stylesheet" href="http://10.180.14.130:8980/Kostal-Web/static/common/common.css?V1.0-09122138">-->
<link rel="stylesheet" href="../static/style/information/layer.css" id="layuicss-skinlayercss">
<link rel="stylesheet" href="../static/style/information/jquery.strength.css">
<link rel="stylesheet" href="../static/style/information/userInfo.css">
</head><body class="hold-transition nobg">
<div class="wrapper">
<link rel="stylesheet" href="../static/style/information/cropper.css">
<div class="row cropper-wrapper ">
	<div class="col-xs-8">
		<div class="img-container">
			<img id="image" src={{ imageSrc }} class="cropper-hidden">
		</div>
	</div>
	<div class="col-xs-4 pl0">
		<div class="clearfix">
			<div class="img-preview preview-lg"></div>
			<div class="img-preview preview-md"></div>
			<div class="img-preview preview-sm"></div>
			<div class="img-preview preview-xs"></div>
		</div>
        <div class="clearfix mt20"></div>
		<div class="btn-group">
			<button type="button" class="btn btn-default" data-method="zoom" data-option="0.1" title="放大">
				<span class="fa fa-fw fa-search-plus"></span>
			</button>
			<button type="button" class="btn btn-default" data-method="zoom" data-option="-0.1" title="缩小">
				<span class="fa fa-fw fa-search-minus"></span>
			</button>
		</div>
		<div class="btn-group">
			<button type="button" class="btn btn-default" data-method="move" data-option="-10" data-second-option="0" title="向左移动">
				<span class="fa fa-fw fa-arrow-left"></span>
			</button>
			<button type="button" class="btn btn-default" data-method="move" data-option="10" data-second-option="0" title="向右移动">
				<span class="fa fa-fw fa-arrow-right"></span>
			</button>
			<button type="button" class="btn btn-default" data-method="move" data-option="0" data-second-option="-10" title="向上移动">
				<span class="fa fa-fw fa-arrow-up"></span>
			</button>
			<button type="button" class="btn btn-default" data-method="move" data-option="0" data-second-option="10" title="向下移动">
				<span class="fa fa-fw fa-arrow-down"></span>
			</button>
		</div>
		<div class="btn-group">
			<button type="button" class="btn btn-default" data-method="rotate" data-option="-45" title="逆时针旋转">
				<span class="fa fa-fw fa-rotate-left"></span>
			</button>
			<button type="button" class="btn btn-default" data-method="rotate" data-option="45" title="顺时针旋转">
				<span class="fa fa-fw fa-rotate-right"></span>
			</button>
		</div>
		<div class="btn-group">
			<button type="button" class="btn btn-default" data-method="scaleX" data-option="-1" title="水平反转">
				<span class="fa fa-fw fa-arrows-h"></span>
			</button>
			<button type="button" class="btn btn-default" data-method="scaleY" data-option="-1" title="左右反转">
				<span class="fa fa-fw fa-arrows-v"></span>
			</button>
		</div>
		<div class="btn-group">
			<label class="btn btn-info btn-upload" for="inputImage" title="{% trans 'Choose Image' %}">
				<input type="file" class="sr-only" id="inputImage" name="file" accept=".jpg,.jpeg,.png,.gif,.bmp">
				<span class="fa fa-fw fa-upload"></span> &nbsp;<b>{% trans "Choose Image" %}</b>
			</label>
        </div>
		<div class="btn-group hide">
			<button id="btnGetImageBase64" type="button" class="btn btn-default" data-method="getCroppedCanvas" title="Get image Base64">
				<span class="fa fa-fw fa-download"></span>
			</button>
        </div>
	</div>
</div>
</div>

<a id="scroll-up" href="#" class="btn btn-sm"><i class="fa fa-angle-double-up"></i></a>

<script src="../static/javascript/information/bootstrap.min.js"></script>
<script src="../static/javascript/information/select2.js"></script>
<script src="../static/javascript/information/select2.zh_CN.js"></script>
<script src="../static/javascript/information/layer.js"></script>
<script src="../static/javascript/information/WdatePicker.js"></script>
<script src="../static/javascript/information/jeesite.js"></script>
<!--<script src="../static/javascript/information/des.js"></script>-->
<script src="../static/javascript/information/cropper.js"></script>
{% if language == 'en' %}
<script src="../static/javascript/information/jeesite_en.js"></script>
<script src="../static/javascript/information/en.js"></script>
{% else %}
<script src="../static/javascript/information/zh_CN.js"></script>
<script src="../static/javascript/information/jeesite_zh_CN.js"></script>
{% endif %}
<script>
var options = {
	dragMode: 'move',
	aspectRatio: 1/1,
	autoCropArea: 1,
	preview: ".img-preview",
	ready: function(){
		$(window).resize();
	}
},
$image = $("#image").cropper(options),
URL = window.URL || window.webkitURL,
uploadedImageType = 'image/png',
uploadedImageURL, imageBase64;
$('.btn-group').on('click', '[data-method]', function () {
	var $this = $(this), data = $this.data(), result,
		cropper = $image.data('cropper'), cropped;
	if ($this.prop('disabled') || $this.hasClass('disabled')) {
		return;
	}
	if (cropper && data.method) {
		data = $.extend({}, data); // Clone a new one
		cropped = cropper.cropped;
		switch (data.method) {
		case 'rotate':
			if (cropped && options.viewMode > 0) {
				$image.cropper('clear');
			}
			break;
		case 'getCroppedCanvas':
			if (uploadedImageType === 'image/jpeg') {
				if (!data.option) {
					data.option = {};
				}
				data.option.fillColor = '#fff';
			}
			break;
		}
		result = $image.cropper(data.method, data.option, data.secondOption);
		switch (data.method) {
		case 'rotate':
			if (cropped && options.viewMode > 0) {
				$image.cropper('crop');
			}
			break;
		case 'scaleX':
		case 'scaleY':
			$(this).data('option', -data.option);
			break;
		case 'getCroppedCanvas':
			if (result) {
				imageBase64 = result.toDataURL(uploadedImageType);
			}
			break
		}
	}
});
$("#inputImage").change(function(){
	js.loading();
	var files = this.files, file;
	if (!$image.data('cropper')) {
		return;
	}
	if (files && files.length) {
		file = files[0];
		if (/^image\/\w+$/.test(file.type)) {
			uploadedImageType = file.type;
			uploadedImageURL = URL.createObjectURL(file);
			$image.cropper('destroy').attr('src', uploadedImageURL).cropper(options);
			$(this).val('');// 清理下，方便下次选择
		} else {
			js.showMessage('请选择一个图片文件。');
		}
	}
	$(this).blur();
	js.closeLoading();
<!--}).focus(function(){-->
	<!--js.loading();-->
<!--}).blur(function(){-->
	<!--js.closeLoading();-->
});
$(window).resize(function(){
	$('.img-container').height($(window).height()-50);
}).resize();
</script>