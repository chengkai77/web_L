<!DOCTYPE html>

<html translate="no">
<head>
    <meta charset="UTF-8">
    {% load i18n %}
    {% get_current_language as LANGUAGE_CODE %}
    <!--<meta name="viewport" content="width=device-width,initial-scale=1.0">-->
    <title>{% trans "ChocLead" %}</title>
    <link rel="stylesheet" type="text/css" href="../static/style/EasyUI/easyui.css">
    <link rel="stylesheet" type="text/css" href="../static/style/EasyUI/icon.css">
    <link href="../static/javascript/jvisio-flow/lib/fonts/font-awesome.min.css" rel="stylesheet">
    <link href="../static/javascript/jvisio-flow/lib/fonts/simple-line-icons.css" rel="stylesheet">
    <link href="../static/javascript/jvisio-flow/lib/bootstrap/bootstrap.min.css" rel="stylesheet">
    <link href="../static/javascript/jvisio-flow/lib/jqueryui/jquery-ui.css" rel="stylesheet">
    <link href="../static/javascript/jvisio-flow/jvisio.css" rel="stylesheet">
    <link href="../static/javascript/layer/default/layer.css" rel="stylesheet">
    <link href="../static/javascript/layer/default/layui.css" rel="stylesheet">
    <link href="../static/javascript/layer/default/layui2.css" rel="stylesheet">
    <link href="../static/style/dropdown/normalize.min.css" rel="stylesheet">
    <link href="../static/style/dropdown/style.css" rel="stylesheet">
    <link href="../static/style/ySelect.css" rel="stylesheet">
    <script>
        var tabs_index = 0;
        var name_json = {};
        var process_index = "";
        var div_json = {};
        var span_width_json = {};
        var span_width_list = new Array;
        var repaint_list = new Array;
        var div_selection_list = new Array;
        var div_status = {};
        var web_target_json = {};
        var c_args = '';
        var c_sap_id = '';
        var record_timer = "";
        var current_time = "";
        var control_tree = "";
        var excel_chart_range = [];
        var pivot_options = [];

        function layerMsg(message){
            layer.msg(message, {
                time: 2000,
            });
        }

        function getRatio(){
            var ratio=0;
            ratio=window.outerWidth/window.innerWidth;
<!--            var screen=window.screen;-->
<!--            var ua=navigator.userAgent.toLowerCase();-->
<!--            if(window.devicePixelRatio !== undefined){-->
<!--                ratio=window.devicePixelRatio;-->
<!--            }else if(~ua.indexOf('msie')){-->
<!--                if(screen.deviceXDPI && screen.logicalXDPI){-->
<!--                    ratio=screen.deviceXDPI/screen.logicalXDPI;-->
<!--                }-->
<!--            }else if(window.outerWidth !== undefined && window.innerWidth !== undefined){-->
<!--                ratio=window.outerWidth/window.innerWidth;-->
<!--            }-->
            if(ratio)
            {
                ratio=Math.round(ratio*100);
            }
            return ratio;
        }

        function layerHtml(html, auto_save = false){
            var ratio = parseInt(getRatio());
            var width = document.body.clientWidth;
            var left = (parseInt(width) - 300) + 'px';
            var tab_index = getActiveTab();
            var height = $("#process-area"+ tab_index.toString()).height() + 'px';
            var divId = $("#setting_element_id").val();
            var processType = $("#setting_process_type").val();
            var quick_btn = '';
            if (processType == "release"){
                newElement = '<a href="javascript:;" onclick="cancel('+"'"+divId+"'"+')"><i class="layui-icon layui-icon-close"></i></a>';
            }else{
                newElement = '<a href="javascript:;" onclick="save('+"'"+divId+"'"+')"><i class="layui-icon layui-icon-ok"></i></a><a href="javascript:;" onclick="cancel('+"'"+divId+"'"+')"><i class="layui-icon layui-icon-close"></i></a>';
            }
            // 把弹窗藏起来
            var offset_custom = '72px';
            if (auto_save) {
                offset_custom = '9999px';
                var index = layer.open({
                    type: 1,
                    id: 'settingPage',
                    title: '{% trans "Setting" %}',
                    closeBtn: 0,
                    offset: [offset_custom, left],
                    area: ['300px', height],
                    skin: 'property',
                    fixed: false,
                    content: html,
                    shade: 0,
                    shadeClose: false,
                    success: function(layero, index){
                        var div = $("#settingPage").nextAll(".layui-layer-setwin")[0];
                        if (typeof(div) == "undefined"){
                            $("#settingPage").after('<span class="layui-layer-setwin">' + newElement + '</span>');
                        }else{
                            div.innerHTML = newElement;
                        }
                    }
                });
                $("#setting_index").val(index);
            } else {
                var index = layer.open({
                    type: 1,
                    id: 'settingPage',
                    title: '{% trans "Setting" %}',
                    resize: true,
                    closeBtn: 0,
                    offset: [offset_custom, left],
                    area: ['300px', height],
                    skin: 'property',
                    fixed: false,
                    content: html,
                    shadeClose: false,
                    success: function(layero, index){
                        var div = $("#settingPage").nextAll(".layui-layer-setwin")[0];
                        if (typeof(div) == "undefined"){
                            $("#settingPage").after('<span class="layui-layer-setwin">' + newElement + '<a class="layui-layer-ico layui-layer-max" href="javascript:;"></a></span>');
                        }else{
                            div.innerHTML = newElement + '<a class="layui-layer-ico layui-layer-max" href="javascript:;"></a>';
                        }
                    }
                });
                $("#setting_index").val(index);
            }
        }

        function getActiveTab(){
            var select_tab = $('#tt').tabs('getSelected');
            var tab_index;
            var id = select_tab[0].id;
            if (id == "codes_area"){
                tab_index = 0;
            }else if(id == "process-area"){
                tab_index = '';
            }else{
                tab_index = parseInt(id.replace("process-area",""));
            }
            return tab_index;
        }

    //client_robot no connection warning
    function c_robot_warning(){
        layer.closeAll('loading');
        layer.alert('{% trans "Local robot program cannot connect..." %}', {
            title: '{% trans "Client Error" %}',
            skin: 'layui-layer-lan',
            closeBtn: 0,
            icon: 5,
            offset: 'auto',
            btn: ['{% trans "How to Start" %}', '{% trans "Cancel" %}'],
            btn1: function(index, layero) {
                layer.open({
                    type: 1,
                    title: false //不显示标题栏
                    ,
                    closeBtn: false,
                    area: '370px;',
                    shade: 0.8,
                    id: 'LAY_client_warning' //设定一个id，防止重复弹出
                    ,
                    btn: ['{% trans "Get it" %}'],
                    btnAlign: 'c',
                    moveType: 1 //拖拽模式，0或者1
                    ,
                    content: '<div style="padding: 50px; line-height: 22px; background-color: #393D49; color: #fff; font-weight: 300;">1. {% trans "Please keep the robot in the boot state" %}<br>2. {% trans "Click connect button to connect the server" %}<br>3. {% trans "Restart ChocLead.exe after exiting" %}</div>'
                });
            },
        });
    }

    //log off reminder
    function log_reminder(){
        layer.closeAll('loading');
        layer.alert('{% trans "Whether to kick out others" %}', {
            title: '{% trans "Log Warning" %}',
            skin: 'layui-layer-lan',
            closeBtn: 0,
            icon: 5,
            offset: 'auto',
            btn: ['Yes', 'No'],
            btn1: function(index, layero) {
                c_args = JSON.stringify({"action":"kick"});
                ws.onopen();
            },
            btn2: function(index, layero) {
                window.parent.logout();
            },
        });
    }

    //create websocket connection
    function createWs(){
        if (window.s) {
            window.s.close()
        }

        c_args = JSON.stringify({"action":"connect"});
        ws = new WebSocket("{{ server_address }}" + "/rpadesignstudio/");

        ws.onopen = function() {
            // Web Socket 已连接上，使用 send() 方法发送数据
            ws.send(c_args);
        };

        // 接收到服务器消息后的回调函数
        ws.onmessage = function(evt) {
            layer.closeAll('loading');
            var data = JSON.parse(evt.data);
            var action = data['action'];
            if (action == 'run'){
                var result = data['result'];
                if (result == "success") {
                    var printContent = data['print'];
                    if (printContent){
                        $('#control_area').html(printContent);
                        $('#cc').layout('expand', 'south');
                    }
                    layer.alert('{% trans "Run successfully" %}!', {
                        title: '{% trans "Info" %}',
                        skin: 'layui-layer-lan',
                        closeBtn: 1,
                        icon: 6,
                        offset: 'rb',
                        btn: false,
                    });
                } else {
                    var msg = data['msg'];
                    var divID = data['step'];
                    if (divID != "" && divID != null && typeof(divID) != "undefined"){
                        if (msg == "" || msg == null || typeof(msg) == "undefined") {
                            try {
                                gettext($("#"+divID)[0].innerText);
                            } catch(err) {
                                next;
                            }
                        }
                    }
                    var groupID = data['groupId'];
                    if (groupID == "" || groupID == null || typeof(groupID) == "undefined") {
                        try {
                            $("#" + divID).find(".jnode-box").eq(0).css("border", "3px solid #ac2925");
                        } catch(err) {
                            next;
                        }
                    } else {
                        try {
                            $("#" + divID).find(".jnode-box").eq(0).css("border", "3px solid #ac2925");
                            $("#group_id").val(groupID);
                        } catch(err) {
                            next;
                        }
                    }
                    var conso = gettext(data['conso']);
                    $('#control_area').html(conso);
                    $('#cc').layout('expand', 'south');
                    layer.alert(gettext(msg), {
                        title: '{% trans "Info" %}',
                        skin: 'layui-layer-lan',
                        closeBtn: 1,
                        icon: 5,
                        offset: 'rb',
                        btn: false,
                    });
                }
            }else if(action == 'web_target'){
                var status = data['status'];
                if (status == 'success') {
                    var tab_index = getActiveTab();
                    var browser = $("#browser_mode" + tab_index.toString()).val().replace(/\"/g,"").toLowerCase();
                    if (browser == "ie"){
                        $("#iframe").val(JSON.stringify(data['frame']));
                        var options = '';
                        if (data['tagName']){
                            $("#tag_name").val('"' + data['tagName'] + '"');
                            web_target_json.tagName = data['tagName'];
                            web_target_json.tag_sequence = data['tag_sequence'];
                        }
                        if (data['divId']){
                            options += '<option value =' + "'\"id" + "\"'" + ' selected = "selected">'+gettext("ID")+'</option>';
                            $("#element_name").val('"' + data['divId'] + '"');
                            $("#element_sequence").val(data['id_sequence']);
                            web_target_json.id = data['divId'];
                            web_target_json.id_sequence = data['id_sequence'];
                        }
                        if (data['name']){
                            if (options == '') {
                                options += '<option value =' + "'\"name" + "\"'" + ' selected = "selected">'+gettext("NAME")+'</option>';
                                $("#element_name").val('"' + name + '"');
                                $("#element_sequence").val(data['name_sequence']);
                            } else {
                                options += '<option value =' + "'\"name" + "\"'" + '>'+gettext("NAME")+'</option>';
                            }
                            web_target_json.name = data['name'];
                            web_target_json.name_sequence = data['name_sequence'];
                        }
                        if (data['className']){
                            if (options == '') {
                                options += '<option value =' + "'\"className" + "\"'" + ' selected = "selected">'+gettext("CLASS_NAME")+'</option>';
                                $("#element_name").val('"' + data['className'] + '"');
                                $("#element_sequence").val(data['class_sequence']);
                            } else {
                                options += '<option value =' + "'\"className" + "\"'" + '>'+gettext("CLASS_NAME")+'</option>';
                            }
                            web_target_json.className = data['className'];
                            web_target_json.class_sequence = data['class_sequence'];
                        }
                        if (data['linkText']){
                            if (options == '') {
                                options += '<option value =' + "'\"linkText" + "\"'" + ' selected = "selected">'+gettext("LINK_TEXT")+'</option>';
                                $("#element_name").val('"' + data['linkText'] + '"');
                                $("#element_sequence").val(data['link_sequence']);
                            } else {
                                options += '<option value =' + "'\"linkText" + "\"'" + '>'+gettext("LINK_TEXT")+'</option>';
                            }
                            web_target_json.linkText = data['linkText'];
                            web_target_json.link_sequence = data['link_sequence'];
                        }
                        if (data['xpath']){
                            if (options == '') {
                                options += '<option value =' + "'\"xpath" + "\"'" + ' selected = "selected">'+gettext("XPATH")+'</option>';
                                $("#element_name").val('"' + data['xpath'] + '"');
                                $("#element_sequence").val(0);
                            } else {
                                options += '<option value =' + "'\"xpath" + "\"'" + '>'+gettext("XPATH")+'</option>';
                            }
                            web_target_json.xpath = data['xpath'];
                        }
                        $("#method").html(options);
                    }else if (browser == "chrome"){
                        $("#iframe").val(JSON.stringify(data['frameLocation']));
                        var options = '';
                        if (data['tagName']){
                            $("#tag_name").val('"' + data['tagName'] + '"');
                        }
                        if (data['id']){
                            options += '<option value =' + "'\"id" + "\"'" + ' selected = "selected">'+gettext("ID")+'</option>';
                            $("#element_name").val('"' + data['id'] + '"');
                            $("#element_sequence").val(0);
                            web_target_json.id = data['id'];
                            web_target_json.id_sequence = 0;
                        }
                        if (data['linkText']){
                            if (options == '') {
                                options += '<option value =' + "'\"linkText" + "\"'" + ' selected = "selected">'+gettext("LINK_TEXT")+'</option>';
                                $("#element_name").val('"' + data['linkText'][0].replace("link=","") + '"');
                            } else {
                                options += '<option value =' + "'\"linkText" + "\"'" + '>'+gettext("LINK_TEXT")+'</option>';
                            }
                            web_target_json.linkText = data['linkText'][0].replace("link=","");
                        }
                        if (data['xPath']){
                            if (options == '') {
                                options += '<option value =' + "'\"xpath" + "\"'" + ' selected = "selected">'+gettext("XPATH")+'</option>';
                                $("#element_name").val('"' + data['xPath'] + '"');
                            } else {
                                options += '<option value =' + "'\"xpath" + "\"'" + '>'+gettext("XPATH")+'</option>';
                            }
                            web_target_json.xpath = data['xPath'];
                        }
                        if (data['css']){
                            if (options == '') {
                                options += '<option value =' + "'\"css" + "\"'" + ' selected = "selected">'+gettext("CSS")+'</option>';
                                $("#element_name").val('"' + data['css'] + '"');
                            } else {
                                options += '<option value =' + "'\"css" + "\"'" + '>'+gettext("CSS")+'</option>';
                            }
                            web_target_json.css = data['css'];
                        }
                        $("#method").html(options);
                    }
                } else {
                    var msg = data['msg'];
                    $('#control_area').html(msg);
                    $('#cc').layout('expand', 'south');
                    layer.alert('{% trans "Get element failed" %}!', {
                        title: '{% trans "Info" %}',
                        skin: 'layui-layer-lan',
                        closeBtn: 1,
                        icon: 5,
                        offset: 'rb',
                        btn: false,
                    });
                }
                document.body.style.cursor = "default";
            }else if(action == 'sap_target'){
                var sap_id = data['sap_id'];
                try {
                    $("#"+c_sap_id).val(sap_id);
                } catch(err) {
                    layer.msg('{% trans "Input sap id failed" %}!', {
                        time: 1000,
                        icon: 5,
                    });
                }
                document.body.style.cursor = "default";
            }else if(action == 'sap_record'){
                var result = data['result'];
                if (result == "error"){
                    var msg = data['msg'];
                    $('#control_area').html(msg);
                    $('#cc').layout('expand', 'south');
                }else{
                    var codes = data['record_code'];
                    var auto = data['auto'];
                    if (auto == 1){
                        drawRecordProcess(codes);
                    }else{
                        var html = '<div id="sap_record_widget" class="notice layui-text">';
                        for (var i=0;i<codes.length;i++){
                            html = html + codes[i] + "</br>";
                        }
                        html = html + "</div>";
                        layer.open({
                            type: 1,
                            btn: ['{% trans "Close" %}'],
                            skin: 'layui-layer-lan',
                            title: '{% trans "SAP Record View" %}',
                            anim: 2,
                            area: '600px',
                            shade: 0,
                            maxHeight: '400px',
                            content: html,
                            resize: true,
                            success: function(layero, index) {
                                $("#sap_record_widget").parent().css("background","#f2f2f2");
                            }
                        });
                    }
                }
            }else if(action == 'chrome_record'){
                var result = data['result'];
                if (result == "error"){
                    var msg = data['msg'];
                    $('#control_area').html(msg);
                    $('#cc').layout('expand', 'south');
                }else{
                    var codes = data['record_code'];
                    var auto = data['auto'];
                    if (auto == 1){
                        drawRecordProcess(codes);
                    }else{
                        var html = '<div id="sap_record_widget" class="notice layui-text">';
                        for (var i=0;i<codes.length;i++){
                            code_new = codes[i].split("__gettext_trans__")
                            for (var j=0;j<code_new.length;j++){
                                html = html + gettext(code_new[j])
                            }
                            html = html + "</br>";
                        }
                        html = html + "</div>";
                        layer.open({
                            type: 1,
                            btn: ['{% trans "Close" %}'],
                            skin: 'layui-layer-lan',
                            title: '{% trans "Chrome Record View" %}',
                            anim: 2,
                            area: '600px',
                            shade: 0,
                            maxHeight: '400px',
                            content: html,
                            resize: true,
                            success: function(layero, index) {
                                $("#sap_record_widget").parent().css("background","#f2f2f2");
                            }
                        });
                    }
                }
            }else if(action == 'web_crawl'){
                delete data["action"];
                $("#crawl_result").val(JSON.stringify(data));
            }else if(action == 'handle_target'){
                $("#control_handle").val('');
                var result = data['list'];
                //判断是否为general_getText
                var function_name = $("#function").val();
                if (function_name === "General_GetText"){
                    var alert_html = "";
                    ["Name","Text","Value","HelpText"].forEach(function (value) {
                        if (alert_html){
                            alert_html+="</br>";
                        }
                        alert_html+="<span style='color:#AC2925;font-weight:bold;'>"+gettext(value)+"</span></br>";
                        if(data[value.toLowerCase()] && data[value.toLowerCase()] != ""){
                            var ggt_value = data[value.toLowerCase()];
                        }else{
                            var ggt_value = "<span style='color:#009688;'>None</span>";
                        }
                        alert_html+=ggt_value;
                    })
                    layer.alert(alert_html, {
                        title: '{% trans "Text Type" %}',
                        skin: 'layui-layer-lan',
                        closeBtn: 1,
                        maxmin: true
                    });
                }

                var control_json = {};
                control_json.window_class = data['window_class'];
                control_json.window_name = data['window_name'];
                control_json.name = data['name'];
                control_json.class = data['class'];
                control_json.depth = data['depth'];
                <!--判断是否是JAVA动作-->
                var is_java_operation = false
                try {
                    java_object = JSON.parse(result.replace(/'/g, '"'))
                    is_java_operation = java_object["hwnd"].hasOwnProperty("java_app")
                } catch(err) {
                    console.log(err);
                }
                if (is_java_operation == true){
                    $("#control_h_show").val(JSON.stringify(java_object["hwnd"]).replace(/\"/g,"'"));
                    $("#control_handle").val(JSON.stringify(java_object["Nodes"]).replace(/\"/g,"'"));
                } else {
                    if (document.getElementById("chart_name")){
                        $("#chart_name").val("\"" + data['name'] + "\"");
                        $("#sheet_name").val("\"" + data['sheet_name'] + "\"");
                        try{
                            $("#selected_cells").val("\"" + data['selected_cells'][0] + "\"");
                            excel_chart_range = data['selected_cells'];
                        }catch(e){
                            $("#selected_cells").val("\"\"");
                        }
                        //根据系列名生成下拉框
                        var options = data["series_name"];
                        var select_html = "";
                        for (var i=0;i<options.length;i++){
                            select_html+="<option value=\"" + options[i] + "\">" + options[i] + "</option>";
                        }
                        document.getElementById("chart_series").innerHTML = select_html;
                    }else if(document.getElementById("excel_pivotTable_refresh")){
                        $("#chosen_sheet1").val("\"" + data['chosen_sheet1'] + "\"");
                        $("#data_range").val("\"" + data['pivot_range'] + "\"");
<!--                        $("#pivot_sheet").val("\"" + data['pivot_sheet'] + "\"");-->
                        $("#excel_pivotTable_refresh").val("\"" + data['pivot_table_name'] + "\"");
                        //动态更新excel设置图标数据源的系列下拉框
                        try{
                            var options = eval(data["pivot_table_filters_values"]);
                            var columns = eval(data["pivot_column_fields"]);
                            var rows = eval(data["pivot_row_fields"]);
                            var pages = eval(data["pivot_page_fields"]);
                        }catch(e){
                            var options = [];
                            var columns = [];
                            var rows = [];
                            var pages = [];
                        }
                        pivot_options = options;
                        if (options){
                            var select_html = "";
                            var select_html_columns = "";
                            var select_html_rows = "";
                            var select_html_pages = "";
                            var select_text = "";
                            var select_text_columns = "";
                            var select_text_rows = "";
                            var select_text_pages = "";
                            var option_html = "";
                            var option_html_columns = "";
                            var option_html_rows = "";
                            var option_html_pages = "";

                            for (var i=0;i<options.length;i++){
                                if (columns.indexOf(options[i])>-1){
                                    select_html_columns+='<div class="fs-option selected" data-value="" '+options[i]+' data-index="' +i+ '"><span class="fs-checkbox"><i></i></span><div class="fs-option-label">'+options[i]+'</div></div>';
                                    option_html_columns+='<option selected="selected">' + "\"" + options[i] + "\"" + '</option>';
                                    select_text_columns+=options[i];
                                    if(options[i]==columns.slice(-1)){
                                        select_text_columns = select_text_columns
                                    }else{
                                        select_text_columns = select_text_columns + ", ";
                                    }
                                }else{
                                    select_html_columns+='<div class="fs-option" data-value="" '+options[i]+' data-index="' +i+ '"><span class="fs-checkbox"><i></i></span><div class="fs-option-label">'+options[i]+'</div></div>';
                                }
                            }

                            for (var i=0;i<options.length;i++){
                                if (rows.indexOf(options[i])>-1){
                                    select_html_rows+='<div class="fs-option selected" data-value="" '+options[i]+' data-index="' +i+ '"><span class="fs-checkbox"><i></i></span><div class="fs-option-label">'+options[i]+'</div></div>';
                                    option_html_rows+='<option selected="selected">' + "\"" + options[i] + "\"" + '</option>';
                                    select_text_rows+=options[i];
                                    if(options[i]==rows.slice(-1)){
                                        select_text_rows = select_text_rows
                                    }else{
                                        select_text_rows = select_text_rows + ", ";
                                    }
                                }else{
                                    select_html_rows+='<div class="fs-option" data-value="" '+options[i]+' data-index="' +i+ '"><span class="fs-checkbox"><i></i></span><div class="fs-option-label">'+options[i]+'</div></div>';
                                }
                            }

                            for (var i=0;i<options.length;i++){
                                if (pages.indexOf(options[i])>-1){
                                    select_html_pages+='<div class="fs-option selected" data-value="" '+options[i]+' data-index="' +i+ '"><span class="fs-checkbox"><i></i></span><div class="fs-option-label">'+options[i]+'</div></div>';
                                    option_html_pages+='<option selected="selected">' + "\"" + options[i] + "\"" + '</option>';
                                    select_text_pages+=options[i];
                                    if(options[i]==pages.slice(-1)){
                                        select_text_pages = select_text_pages
                                    }else{
                                        select_text_pages = select_text_pages + ", ";
                                    }
                                }else{
                                    select_html_pages+='<div class="fs-option" data-value="" '+options[i]+' data-index="' +i+ '"><span class="fs-checkbox"><i></i></span><div class="fs-option-label">'+options[i]+'</div></div>';
                                }
                            }
                            document.getElementById("pivot_table_filters").innerHTML = option_html_pages;
                            document.getElementById("pivot_table_columns").innerHTML = option_html_columns;
                            document.getElementById("pivot_table_rows").innerHTML = option_html_rows;
                        }
                            let ySelect = document.getElementsByClassName("fs-options")[0];
                            let ySelect1 = document.getElementsByClassName("fs-options")[1];
                            let ySelect2 = document.getElementsByClassName("fs-options")[2];
                            ySelect.innerHTML = select_html_pages;
                            ySelect1.innerHTML = select_html_columns;
                            ySelect2.innerHTML = select_html_rows;
                            $("#pivot_table_filters_values").val(select_text_pages);
                            $("#pivot_table_columns_values").val(select_text_columns);
                            $("#pivot_table_rows_values").val(select_text_rows);
                        var saved_selected_values = data["pivot_table_filters_values"]
                        for (variant in data){
                            // 读取table_filters_values
                            if ("pivot_table_filters_values" == variant) {
                                $("#pivot_table_filters_values").text(saved_selected_values);
                            }
                        }
                        var selected_doms = $(".fs-option")
                        for (var i=0; i<selected_doms.length; i++) {
                            var selected_dom = selected_doms[i]
                            var selected_dom_value = selected_dom.lastChild.innerText
                            if (saved_selected_values.indexOf(selected_dom_value) < 0) {
                                selected_dom.classList.remove("selected")
                            }
                        }
                    }else{
                        $("#control_h_show").val(JSON.stringify(control_json));
                        $("#control_handle").val(result);
                    }
                }
                var width = data['width'];
                if (width){
                    var height = data['height'];
                    var offsetX = data['offsetX'];
                    var offsetY = data['offsetY'];
                    $("#image_width").val(width);
                    $("#image_height").val(height);
                    $("#offsetX").val(offsetX);
                    $("#offsetY").val(offsetY);
                }else{
                    $("#image_width").val(0);
                    $("#image_height").val(0);
                    $("#offsetX").val(0);
                    $("#offsetY").val(0);
                }
            }else if(action == 'icon_target'){
                var status = data['status'];
                if (status == "success"){
                    $("#control_handle").val('');
                    var img_json = {};
                    var code = data['img_data'];
                    img_json['code'] = code;
                    var short_code = code.substring(0, 10);
                    var path = "data:image/png;base64," + data['img_data'];
                    $("#img_screenshot").attr('src',path);
                    var maxWidth = 200; // 图片最大宽度
                    var maxHeight = 16;    // 图片最大高度
                    var width = data['width'];    // 图片实际宽度
                    var height = data['height'];  // 图片实际高度
                    var ratio = maxHeight/height;  // 缩放比例
                    // 检查缩放图片是否超宽
                    var newWidth = width*ratio;
                    if(newWidth > maxWidth){
                        $("#img_screenshot").css("width", maxWidth); // 设定实际显示宽度
                        $("#img_screenshot").css("height", maxHeight);  // 设定等比例缩放后的高度
                    }else{
                        $("#img_screenshot").css("width", newWidth);
                        $("#img_screenshot").css("height", maxHeight);
                    }
                    img_json['type'] = "icon_target";
                    $("#control_handle").val(JSON.stringify(img_json));
                    $("#control_h_show").val('"' + short_code + '"');
                    $("#image_width").val(width);
                    $("#image_height").val(height);
                    $("#offsetX").val(data['x_axis']);
                    $("#offsetY").val(data['y_axis']);
                }else if(status == "error"){
                    var msg = data['msg'];
                    $('#control_area').html(msg);
                    $('#cc').layout('expand', 'south');
                }
            }else if(action == 'icon_coordinate_target'){
                var status = data['status'];
                if (status == "success"){
                    $("#control_handle").val('');
                    var img_json = {};
                    var code = data['img_data'];
                    img_json['code'] = code;
                    var short_code = code.substring(0, 10);
                    var path = "data:image/png;base64," + data['img_data'];
                    $("#img_screenshot").attr('src',path);
                    var maxWidth = 200; // 图片最大宽度
                    var maxHeight = 16;    // 图片最大高度
                    var width = data['width'];    // 图片实际宽度
                    var height = data['height'];  // 图片实际高度
                    var ratio = maxHeight/height;  // 缩放比例
                    // 检查缩放图片是否超宽
                    var newWidth = width*ratio;
                    if(newWidth > maxWidth){
                        $("#img_screenshot").css("width", maxWidth); // 设定实际显示宽度
                        $("#img_screenshot").css("height", maxHeight);  // 设定等比例缩放后的高度
                    }else{
                        $("#img_screenshot").css("width", newWidth);
                        $("#img_screenshot").css("height", maxHeight);
                    }
                    img_json['type'] = "icon_coordinate_target";
                    $("#shot_coordinate_base64").val(JSON.stringify(img_json));
                    $("#shot_coordinate_base64_show").val('"' + short_code + '"');
                    $("#image_width").val(width);
                    $("#image_height").val(height);
                    $("#start_point_coordinates").val(data['start_coordinates']);
                    $("#end_point_coordinates").val(data['end_coordinates']);
                }else if(status == "error"){
                    var msg = data['msg'];
                    $('#control_area').html(msg);
                    $('#cc').layout('expand', 'south');
                }
            }else if(action == 'mouse_target'){
                var result = data['result'];
                if (result == "error"){
                    var msg = data['msg'];
                    $('#control_area').html(msg);
                    $('#cc').layout('expand', 'south');
                }else if(result == "success"){
                    var x = data['x'];
                    var y = data['y'];
                    var screen_scaling = data['ratio'];
                    var ele = document.getElementById("scroll_units");
                    if (ele){
                        $("#scroll_units").val(0 - y);
                    }else{
                        $("#x_axis").val(x);
                        $("#y_axis").val(y);
                        $("#screen_scaling").val(screen_scaling);
                    }
                }
            }else if(action == 'web_dragging_mouse_target'){
                var result = data['result'];
                if (result == "error"){
                    var msg = data['msg'];
                    $('#control_area').html(msg);
                    $('#cc').layout('expand', 'south');
                }else if(result == "success"){
                    var point_coordinates = data['point_coordinates'];
                    var screen_scaling = data['ratio'];
                    var ele = document.getElementById("scroll_units");
                    if (ele){
                        $("#scroll_units").val(0 - y);
                    }else{
                        $("#end_point_coordinates").val(point_coordinates);
                        $("#screen_scaling").val(screen_scaling);
                    }
                }
            }else if(action == 'get_connection'){
                 var result = data['result'];
                 if (result == "error"){
                    c_robot_warning();
                 }else if(result == "off-line"){
                    top.layer.msg('{% trans "The robot is currently offline.Please refresh the page and try again!" %}', {
                        icon: 2,
                        time: 5000
                    })
                 }else if(result == "busy"){
                    top.layer.msg('{% trans "The robot is currently busy.Please refresh the page and try again!" %}', {
                        icon: 2,
                        time: 5000
                    })
                 }
            }else if(action == 'exit'){
                 parent.window.location.href = "../logout/";
            }else if(action == 'commander'){
                 var result = data['result'];
                 var msg = data['msg'];
                 if (result == "error"){
                    top.layer.msg(msg, {
                        icon: 2,
                        time: 5000
                    })
                 }else if(result == "success"){
                    top.layer.msg(msg, {
                        icon: 1,
                        time: 5000
                    })
                 }
            }
        };
         <!--if (socket.readyState == WebSocket.OPEN) socket.onopen();-->
            window.s = ws;
        // 连接关闭后的回调函数
        ws.onclose = function() {
            ws = '';
            // 关闭 websocket
            if(quitbyself == false)
              c_robot_warning();
        };
         ws.onerror = function() {
            ws = '';
            // 关闭 websocket
            if(quitbyself == false)
              c_robot_warning();
        };
    }

    //left,right,mid function
    function left(mainStr,lngLen) {
        if (lngLen>0) {return mainStr.substring(0,lngLen)}
        else{return null}
    }

    function right(mainStr,lngLen) {
        if (mainStr.length-lngLen>=0 && mainStr.length>=0 && mainStr.length-lngLen<=mainStr.length) {
            return mainStr.substring(mainStr.length-lngLen,mainStr.length)}
        else{return null}
    }

    function mid(mainStr,starnum,endnum){
        if (mainStr.length>=0){
            return mainStr.substr(starnum,endnum)
        }else{return null}
    }

    //large picture
    function largePic(){
        var width = $("#image_width").val();
        var height = $("#image_height").val();
        var url = $("#img_screenshot")[0].src;
        layer.open({
            type: 1,
            title: false,
            closeBtn: 0,
            shadeClose: true,
            area: [width + 'px', height + 'px'], //宽高
            content: "<img src=" + url + " />"
        });
    }

    //open file
    function openFile(type) {
        $("#type").val(type);
        layer.open({
            type: 2,
            title: '{% trans "Files List" %}',
            skin: 'layui-layer-lan',
            //加上边框
            area: ['330px', '350px'],
            //宽高
            maxmin: true,
            content: '../openfile/?type=' + type,
            btn: ['{% trans "Yes" %}', '{% trans "No" %}', '{% trans "Delete" %}'],
            btn1: function(index, layero) {
                var tab_index = getActiveTab();
                var className = document.getElementsByClassName("layui-layer-btn0")[0].className;
                if (className.indexOf("disable") != -1) {
                    return false;
                }
                var iframeWin = window[layero.find('iframe')[0]['name']];
                var selectfile = iframeWin.getRow();
                if (selectfile.indexOf(".py") == -1) {
                    layer.msg(gettext('It is not allowed for folder!'));
                    return false;
                }
                var open_result = openCertainProcess(selectfile);
                changeSaveAsStatus("show");
                return open_result;
            },
            btn3: function(index, layero) {
                var className = document.getElementsByClassName("layui-layer-btn2")[0].className;
                if (className.indexOf("disable") != -1) {
                    return false;
                }
                var iframeWin = window[layero.find('iframe')[0]['name']];
                var selectfile = iframeWin.getDeleteRow();
                if (selectfile == "" || selectfile == null) {
                    return false;
                }
                layer.confirm(gettext('Are you sure to delete')+'?', {
                    title: '{% trans "Delete Confirmation" %}',
                    btn: ['{% trans "Yes" %}', '{% trans "No" %}']
                },
                function(index) {
                    $.ajax({
                        type: 'POST',
                        url: '../deleteprocess/',
                        dataType: 'json',
                        data: {
                            "selectfile": selectfile
                        },
                        beforeSend: function() {
                            layer.close(index);
                            layer.load(2);
                        },
                        success: function(data) {
                            layer.closeAll('loading');
                            var result = data['result'];
                            if (result == "success") {
                                layer.msg('{% trans "Delete successfully" %}!', {
                                    time: 1000,
                                    icon: 6,
                                });
                                iframeWin.clear();
                                iframeWin.FindData();
                            } else {
                                var msg = data['msg'];
                                layer.msg(gettext(msg), {
                                    time: 1000,
                                    icon: 5,
                                });
                            }
                        }
                    })
                });
                return false;
            },
            success: function(layero, index) {
                var btns = document.getElementsByClassName("layui-layer-btn0");
                if (type == "public") {
                    {% if 'Draw_Process.views_menu_file_open_public_yes' not in perms %}
                    $(".layui-layer-btn0").addClass("layui-disabled");
                    {% endif %}
                    {% if 'Draw_Process.views_menu_file_open_public_no' not in perms %}
                    $(".layui-layer-btn1").addClass("layui-disabled");
                    {% endif %}
                    {% if 'Draw_Process.views_menu_file_open_public_delete' not in perms %}
                    $(".layui-layer-btn2").addClass("layui-disabled");
                    {% endif %}
                } else if (type == "private") {
                    {% if 'Draw_Process.views_menu_file_open_private_yes' not in perms %}
                    $(".layui-layer-btn0").addClass("layui-disabled");
                    {% endif %}
                    {% if 'Draw_Process.views_menu_file_open_private_no' not in perms %}
                    $(".layui-layer-btn1").addClass("layui-disabled");
                    {% endif %}
                    {% if 'Draw_Process.views_menu_file_open_private_delete' not in perms %}
                    $(".layui-layer-btn2").addClass("layui-disabled");
                    {% endif %}
                } else if (type == "release") {
                    {% if 'Draw_Process.views_menu_file_open_release_yes' not in perms %}
                    $(".layui-layer-btn0").addClass("layui-disabled");
                    {% endif %}
                    {% if 'Draw_Process.views_menu_file_open_release_no' not in perms %}
                    $(".layui-layer-btn1").addClass("layui-disabled");
                    {% endif %}
                    {% if 'Draw_Process.views_menu_file_open_release_delete' not in perms %}
                    $(".layui-layer-btn2").addClass("layui-disabled");
                    {% endif %}
                }
            }
        });
    }

    //获取文件路径
    function getfilepath() {
        var param = {};
        $.ajax({
            type: 'POST',
            url: '../getfilepath/',
            dataType: 'json',
            data: param,
            beforeSend: function() {
                layer.load(2);
            },
            success: function(data) {
                layer.closeAll('loading');
                result = data['result'];
                path = data['filepath']
                if (result == "success") {
                    //var test=document.getElementsById('file_path');
                    // test.value =path;
                    $("#file_path").val(path);

                }
            },
        })
    }
    function isNumber(val) {
        var regPos = /^\d+(\.\d+)?$/; //非负浮点数
        var regNeg = /^(-(([0-9]+\.[0-9]*[1-9][0-9]*)|([0-9]*[1-9][0-9]*\.[0-9]+)|([0-9]*[1-9][0-9]*)))$/; //负浮点数
        if(regPos.test(val) || regNeg.test(val)) {
            return true;
            } else {
            return false;
            }
        }
    //save
    function save(divId, auto_save = false) {
        //excel数据透视表数据迁移
        if (document.getElementById("excel_pivotTable_refresh")){
            ["pivot_table_filters","pivot_table_columns","pivot_table_rows"].forEach(function (value) {
                var options_value = $("#"+value+"_values").val();
                var options = options_value.split(",");
                var option_html = "";
                for (var i=0;i<options.length;i++){
                    option_html+='<option selected="selected">' + options[i] + '</option>';
                }
                document.getElementById(value).innerHTML = option_html;
            })
        }
        //判断句柄属性结构是否展开，展开则进行保存
        var div = document.getElementById("h_control_tree");
        if (div){
            showTree();
        }
        //保存按钮，确认说显示流程描述（断线重连的问题）
        adjust(divId)
        var spans = $(".required-icon");
        for (var i=0;i<spans.length;i++){
            var span = spans[i];
            var div = span.parentElement;
            var inputs = div.getElementsByTagName("input");
            for (var j=0;j<inputs.length;j++){
                var input = inputs[j];
                var inputType = input.type;
                if (inputType != "checkbox"){
                    var value = input.value;
                    if (value == ""){
                        var id = input.id;
                        var setting = document.getElementById('settingPage');
                        var axis_y_up = $("#"+id).offset().top + $("#"+id).get(0).offsetHeight;
                        var axis_y_down = $("#"+id).offset().top - $("#"+id).get(0).offsetHeight;
                        var height = $('#settingPage').offset().top + $("#settingPage").get(0).offsetHeight;
                        if (axis_y_up > height){
                            $("#settingPage").scrollTop($("#settingPage").scrollTop() + axis_y_up - height + 10);
                        }else if (axis_y_down < $('#settingPage').offset().top){
                            $("#settingPage").scrollTop($("#settingPage").scrollTop() - ($('#settingPage').offset().top - axis_y_down));
                        }
                        layer.tips(gettext("Necessary Field"), '#'+id,{tips:[4,"#ff6969"]});
                        return false;
                    }
                }
            }
        }
        web_target_json = {};
        $("#iframe_list").text("");
        var div = document.getElementById(divId);
        var div_width = div.offsetWidth;
        var text = div.children[0].innerText;
        var param = getConnections();
        var variant = {};
        var public_variant = {};
        var properties = document.getElementsByName("property");
        param.divID = divId;
        var property_list = new Array;
        var chart_series_id = new Array;
        if (text == '{% trans "SAP_Text" %}' || text == '{% trans "SAP_Press" %}'){
            if ($("input[id*='element_name']").length > 1){
                var element_list = new Array;
                var content_list = new Array;
                for (var i = 0; i < properties.length; i++) {
                    var property_json = {};
                    property = properties[i];
                    id = property.id;
                    value = property.value;
                    property_json.id = id;
                    property_json.value = value;
                    if (id.indexOf("element_name") != -1){
                        element_list.push(value);
                    }else if (id.indexOf("send_content") != -1){
                        content_list.push(value);
                    }else{
                        property_list.push(property_json);
                    }
                }
                property_list.push({"id":"element_name","value":element_list});
                if ($("input[id*='send_content']").length > 0){
                    property_list.push({"id":"send_content","value":content_list});
                }
            }else{
                property_list = properties;
            }
        }else if (text == '{% trans "HCI_Input" %}'){
            if ($("input[id*='description']").length > 1){
                var element_list = new Array;
                var req_list = new Array;
                var pwd_list = new Array;
                var output_str = "";
                for (var i = 0; i < properties.length; i++) {
                    var property_json = {};
                    property = properties[i];
                    id = property.id;
                    value = property.value;
                    property_json.id = id;
                    property_json.value = value;
                    if (id.indexOf("description") != -1){
                        element_list.push(value);
                    }else if (id.indexOf("required_field") != -1){
                        req_list.push(value);
                    }else if (id.indexOf("password_format") != -1){
                        pwd_list.push(value);
                    }else if (id.indexOf("output") != -1){
                        if (output_str){
                            output_str = output_str + "," + value;
                        }else{
                            output_str = value;
                        }
                    }else{
                        property_list.push(property_json);
                    }
                }
                property_list.push({"id":"description","value":element_list});
                property_list.push({"id":"required_field","value":req_list});
                property_list.push({"id":"password_format","value":pwd_list});
                property_list.push({"id":"output","value":output_str});
            }else{
                property_list = properties;
            }
        }else if (text == '{% trans "Excel_ReadCell" %}' || text == '{% trans "Excel_WriteCells" %}'){
            if ($("input[id*='selected_cell']").length > 1){
                var list1 = new Array,list2 = new Array,output_str = "";
                for (var i = 0; i < properties.length; i++) {
                    var property_json = {};
                    property = properties[i];
                    id = property.id;
                    value = property.value;
                    property_json.id = id;
                    property_json.value = value;
                    if (id.indexOf("selected_cells") != -1){
                        list1.push(value);
                    }else if (id.indexOf("content") != -1){
                        list2.push(value);
                    }else if (id.indexOf("selected_cell") != -1){
                        list1.push(value);
                    }else if (id.indexOf("decimal_digits") != -1){
                        list2.push(value);
                    }else if (id.indexOf("output") != -1){
                        if (output_str){
                            output_str = output_str + "," + value;
                        }else{
                            output_str = value;
                        }
                    }else{
                        property_list.push(property_json);
                    }
                }
                if (document.getElementById("selected_cells")){
                    property_list.push({"id":"selected_cells","value":list1});
                    property_list.push({"id":"content","value":list2});
                }else{
                    property_list.push({"id":"selected_cell","value":list1});
                    property_list.push({"id":"decimal_digits","value":list2});
                    property_list.push({"id":"output","value":output_str});
                }
            }else{
                property_list = properties;
            }
        }else if (text == '{% trans "Excel_SortCells" %}'){
            if ($("input[id*='sort_column']").length > 1){
                var list1 = new Array,list2 = new Array,output_str = "";
                for (var i = 0; i < properties.length; i++) {
                    var property_json = {};
                    property = properties[i];
                    id = property.id;
                    value = property.value;
                    property_json.id = id;
                    property_json.value = value;
                    if (id.indexOf("sort_column") != -1){
                        list1.push(value);
                    }else if (id.indexOf("order_method") != -1){
                        list2.push(value);
                    }else{
                        property_list.push(property_json);
                    }
                }
                if (document.getElementById("sort_column")){
                    property_list.push({"id":"sort_column","value":list1});
                    property_list.push({"id":"order_method","value":list2});
                }
            }else{
                property_list = properties;
            }
        }else if (text == '{% trans "Excel_UpdateChartSeriesData" %}'){
            if ($("input[id*='selected_cells']").length > 1){
                var element_list = new Array;
                var chart_series_list = new Array;
                for (var i = 0; i < properties.length; i++) {
                    var property_json = {};
                    property = properties[i];
                    id = property.id;
                    value = property.value;
                    property_json.id = id;
                    property_json.value = value;
                    if (id.indexOf("chart_series") != -1){
                        chart_series_list.push(value);
                        chart_series_id.push(id);
                    }else if (id.indexOf("selected_cells") != -1){
                        element_list.push(value);
                    }else{
                        property_list.push(property_json);
                    }
                }
                property_list.push({"id":"chart_series","value":chart_series_list});
                property_list.push({"id":"selected_cells","value":element_list});
            }else{
                property_list = properties;
            }
        }else{
            property_list = properties;
        }
        for (var i = 0; i < property_list.length; i++) {
            property = property_list[i];
            id = property.id;
            value = property.value;
            if (id == "nodeNo" || id == "lastNode" || id == "nextNode" || id == "name" || id == "input" || id == "output" || id == "function") {
                if (id == "name"){
                    name_json[divId] = value;
                }
                param[id] = value;
            } else {
                variant[id] = value;
            }
        }
        //检查是否为Excel设置图表数据源，如果是则增加图表系列值
        if (text == '{% trans "Excel_UpdateChartSeriesData" %}'){
            var alloptions = $("#chart_series option");
            var option_list = [],chart_series_options=[];
            for (var i=0;i<alloptions.length;i++){
                option_list.push("\"" + alloptions[i].innerText + "\"");
            }
            chart_series_options[0] = option_list;
            chart_series_id.forEach(function (value) {
                var index = $("#"+value).prop("selectedIndex")
                if (typeof(index) != "undefined" && index >= 0){
                    try{
                        var ele_index = value.replace("chart_series","");
                        excel_chart_range[index] = $("#selected_cells"+ele_index).val().replace(/(^")|("$)/g,'');
                    }catch(err){}
                }
            })
            chart_series_options[1] = excel_chart_range;
            variant["chart_series_options"] = chart_series_options;
            excel_chart_range = [];
            var chart_series_transfer = [];
            if (variant["chart_series"]){
                try{
                    variant["chart_series"].forEach(function (value) {
                        chart_series_transfer.push("\"" + value + "\"");
                    })
                    variant["chart_series"] = chart_series_transfer;
                }catch(e){
                    variant["chart_series"] = "\"" + variant["chart_series"] + "\"";
                }
            }
            <!--variant["chart_series"] = "\"" + variant["chart_series"] + "\"";-->
        }

        $("input:checkbox").each(function() {
            if (this.checked == true) {
                thisid_judge = this.id.replace("sb", "")
                if (thisid_judge != ""){
                    if (!isNumber(thisid_judge)){
                        var checkbox_name = this.name;
                        var span_text = this.parentElement.children[1].getAttribute("name");
                        public_variant[checkbox_name] = span_text;
                        }
                }
            }
        });
        var tab_index = getActiveTab();
        if (tab_index == ''){tab_index = 0};


        // 下拉多选框
        if (text == "Read_Mail" || text == "读取邮件"){
            console.log($("#out_result").ySelectedGetValues());
            variant['out_result'] = "\"" + $("#out_result").ySelectedGetValues() + "\"";
        }else if(text == '{% trans "Excel_PivotTable" %}'){
            variant['pivot_table_filters'] = "\"" + $("#pivot_table_filters").ySelectedGetValues() + "\"";
            variant['pivot_table_columns'] = "\"" + $("#pivot_table_columns").ySelectedGetValues() + "\"";
            variant['pivot_table_rows'] = "\"" + $("#pivot_table_rows").ySelectedGetValues() + "\"";
            variant["pivot_options"] = pivot_options;
<!--            pivot_options = [];-->
        }
        param['variant'] = JSON.stringify(variant);
        param['public_variant'] = JSON.stringify(public_variant);
        param['div_width'] = div_width;
        param['tab'] = tab_index;
        // 增加output变量的命名判断，基于python的变量逻辑
        // abc_xyz：合法
        // HelloWorld：合法
        // abc：合法
        // xyz#abc：不合法，标识符中不允许出现#号
        // abc1：合法
        // 1abc：不合法，标识符不允许数字开头
        // a：合法
        console.log(param['output'])
        // 不考虑User_Input，因为里面支持逗号分隔变量
        if (param['function'] != "User_Input" && param['function'] != "HCI_Input" && param['function'] != "Picture_Shot_Web" && param['function'] != "Excel_ReadCell" && param['function'] != "Excel_WriteCells") {
            if (param['output'] != undefined) {
                if (param['output'] != "") {
                    var output_pattern = /^[A-Za-z]+[_A-Za-z0-9]*$/
                    var python_key_words = ['False','None','True','and','as','assert','break','class','continue','def','del','elif','else','except','finally','for','from','global','if','import','in','is','lambda','nonlocal','not','or','pass','raise','return','try','while','With','yield']
                    var is_match_python_key_words = $.inArray(param['output'], python_key_words);
                    // console.log(output_pattern.test(param['output']))
                    // console.log(is_match_python_key_words)
                    if (!output_pattern.test(param['output']) || is_match_python_key_words >= 0) {
                        layer.msg('{% trans "Please check the variant name of output" %}!', {
                            time: 1000,
                            icon: 5,
                        });
                        return false;
                    }
                }
            }
        }
        // 判断是否需要把密码加密
        try {
            secret_key_path = JSON.parse(param['variant'])["secret_key_path"]
        } catch(err) {
        }
        if (param['function'] == "Set_Password" && secret_key_path != "\"\"") {
            $.ajax({
                type: 'POST',
                url: '../savepasswordvariant/',
                dataType: 'json',
                data: param,
                beforeSend: function() {
                    if (!auto_save) {
                        layer.load(2);
                    }
                },
                success: function(data) {
                    if (!auto_save) {
                        layer.closeAll('loading');
                    }
                    result = data['result'];
                    if (result == "success") {
                        if (!auto_save) {
                            layer.msg('{% trans "Save Successfully" %}!', {
                                time: 1000,
                                icon: 6,
                            });
                        }
                        var div = document.getElementById(divId).children[0];
                        var className = div.className;
                        var color = "";
                        if (className.indexOf("bdc-success") != -1){
                          color = "#4cae4c";
                        }else if(className.indexOf("bdc-primary") != -1){
                          color = "#122b40";
                        }else if(className.indexOf("bdc-warning") != -1){
                          color = "#4F6228";
                        }else if(className.indexOf("bdc-danger") != -1){
                          color = "#ac2925";
                        }else if(className.indexOf("bdc-wait") != -1){
                          color = "#215967";
                        }else if(className.indexOf("bdc-process") != -1){
                          color = "#92D050";
                        }
                        $("#"+divId).find(".jnode-box").eq(0).css("border","3px solid #d58512");
                        try {
                            process_background_color_rgb = JSON.parse(param.variant)["process_background_color"];
                            rgb_color = process_background_color_rgb.substring(1, process_background_color_rgb.length - 1)
                            rgb_color = "rgb(" + rgb_color + ")"
                            $("#"+divId).find(".jnode-box").eq(0).css("background", rgb_color);
                        } catch(err){
                            $("#"+divId).find(".jnode-box").eq(0).css("background",color);
                        }
                        div_status[divId] = 'saved';
                        var index = $("#setting_index").val();
                        layer.close(index);
                    } else {
                        $('#control_area').html(result);
                        $('#cc').layout('expand', 'south');
                        layer.msg('{% trans "Save Failed" %}!', {
                            time: 1000,
                            icon: 5,
                        });
                    }
                },
            });
        } else {
            $.ajax({
                type: 'POST',
                url: '../savevariant/',
                dataType: 'json',
                data: param,
                beforeSend: function() {
                    if (!auto_save) {
                        layer.load(2);
                    }
                },
                success: function(data) {
                    if (!auto_save) {
                        layer.closeAll('loading');
                    }
                    result = data['result'];
                    if (result == "success") {
                        if (!auto_save) {
                            layer.msg('{% trans "Save Successfully" %}!', {
                                time: 1000,
                                icon: 6,
                            });
                        }
                        var div = document.getElementById(divId).children[0];
                        var className = div.className;
                        var color = "";
                        if (className.indexOf("bdc-success") != -1){
                          color = "#4cae4c";
                        }else if(className.indexOf("bdc-primary") != -1){
                          color = "#122b40";
                        }else if(className.indexOf("bdc-warning") != -1){
                          color = "#4F6228";
                        }else if(className.indexOf("bdc-danger") != -1){
                          color = "#ac2925";
                        }else if(className.indexOf("bdc-wait") != -1){
                          color = "#215967";
                        }else if(className.indexOf("bdc-process") != -1){
                          color = "#92D050";
                        }
                        $("#"+divId).find(".jnode-box").eq(0).css("border","3px solid #d58512");
                        try {
                            process_background_color_rgb = JSON.parse(param.variant)["process_background_color"];
                            rgb_color = process_background_color_rgb.substring(1, process_background_color_rgb.length - 1)
                            rgb_color = "rgb(" + rgb_color + ")"
                            $("#"+divId).find(".jnode-box").eq(0).css("background", rgb_color);
                        } catch(err){
                            $("#"+divId).find(".jnode-box").eq(0).css("background",color);
                        }
                        div_status[divId] = 'saved';
                        var index = $("#setting_index").val();
                        layer.close(index);
                    } else {
                        $('#control_area').html(result);
                        $('#cc').layout('expand', 'south');
                        layer.msg('{% trans "Save Failed" %}!', {
                            time: 1000,
                            icon: 5,
                        });
                    }
                },
            });
        }
    }

    //cancel
    function cancel(divId){
        var index = $("#setting_index").val();
        layer.close(index);
        web_target_json = {};
        $("#iframe_list").text("");
        var div = document.getElementById(divId).children[0];
        var className = div.className;
        var color = "";
        if (className.indexOf("bdc-success") != -1){
          color = "#4cae4c";
        }else if(className.indexOf("bdc-primary") != -1){
          color = "#122b40";
        }else if(className.indexOf("bdc-warning") != -1){
          color = "#4F6228";
        }else if(className.indexOf("bdc-danger") != -1){
          color = "#ac2925";
        }else if(className.indexOf("bdc-wait") != -1){
          color = "#215967";
        }else if(className.indexOf("bdc-process") != -1){
          color = "#92D050";
        }
        $("#"+divId).find(".jnode-box").eq(0).css("background",color);
        var status = div_status[divId];
        if (status == 'saved'){
            $("#"+divId).find(".jnode-box").eq(0).css("border-color","#d58512");
        }else{
            $("#"+divId).find(".jnode-box").eq(0).css("border-color",color);
        }
        // 判断 循环赋值颜色
        try {
            process_background_color_rgb = $("#process_background_color")[0].value;
            rgb_color = process_background_color_rgb.substring(1, process_background_color_rgb.length - 1)
            rgb_color = "rgb(" + rgb_color + ")"
            $("#"+divId).find(".jnode-box").eq(0).css("background", rgb_color);
        } catch(err){

        }
        var param = {};
        param.divID = divId;
        $.ajax({
          type:'POST',
          url:'../getname/',
          dataType:'json',
          data:param,
          beforeSend:function(){
            layer.load(2);
          },
          success:function(data){
            layer.closeAll('loading');
            var name = data.name;
            if (name != "" && name != null){
                var label = document.getElementsByName(divId)[0];
                if (typeof(label) != "undefined"){
                  label.innerText = name;
                  label.style.display = "block";
                }
            }else{
                var label = document.getElementsByName(divId)[0];
                if (typeof(label) != "undefined"){
                  label.innerText = name;
                  label.style.display = "none";
                }
            }
          },
        })
    }

    //rearrangement
    function rearrangement() {
        var tab_index = getActiveTab();
        if (parseInt(tab_index) == 0){
            layer.msg('{% trans "Not allowed in view codes" %}!', {
                offset: 't',
            });
            return false;
        }
        var main_height = $("#diagramContainer-main" + tab_index).height();
        var fontSize = parseInt($("#font_size" + tab_index.toString()).val());
        var qtys = parseInt((main_height - 18) / (fontSize * 5 + 40));
        var connections = getConnections();
        var len = connections.length + 1;
        var tab_index = getActiveTab();
        var startID = connections.startID;
        var width = 0;
        var id_list = new Array;
        var ini_top = 20;
        var ini_height = fontSize * 5 + 40;
        var ini_left = 20;
        var direction1 = "BottomCenter";
        var direction2 = "TopCenter";
        var lastID = "";
        var con_list = []
        if (len == 1) {
            return false;
        }
        for (var i = 0; i < len; i++) {
            var con_json = {};
            var divs_json = {};
            var div = document.getElementById(startID);
            try {
                var div_width = div.offsetWidth;
            } catch {
                var test = '';
            }
            var border = $("#" + startID).children(":first").css('border');
            if (width < div_width) {
                width = div_width;
            }
            divs_json.id = startID;
            con_json.id = startID;
            con_json.direction1 = direction1;
            con_json.direction2 = direction2;
            try{
                divs_json.jnode = div.children[0].innerText;
            }catch{
                layerMsg(gettext("Incorrect Flow"));
                return false;
            }
            divs_json.jnodeClass = div.children[0].className;
            divs_json.jnodeHtml = div.children[0].innerHTML;
            divs_json.width = div_width;
            divs_json.border = border;
            id_list.push(divs_json);
            if ((i + 1) % qtys == 0 || i == len - 1) {
                if ((i + 1) % qtys == 0) {
                    con_json.direction1 = "RightMiddle";
                    con_json.direction2 = "LeftMiddle";
                }
                for (var j = 0; j < id_list.length; j++) {
                    var dataObj = {};
                    var div_id = id_list[j].id;
                    var class_name = id_list[j].jnodeClass;
                    if (class_name.indexOf("jnode-diamond") != -1) {
                        ini_top = ini_top - 15;
                    }
                    dataObj.left = parseFloat(ini_left + (width - id_list[j].width) / 2);
                    dataObj.top = parseFloat(ini_top);
                    ini_top = ini_top + ini_height;
                    if (class_name.indexOf("jnode-diamond") != -1) {
                        ini_top = ini_top + 15;
                    }
                    var div = document.getElementById(div_id);
                    jsPlumb.setPosition(div, dataObj);
                    jsPlumb.detachAllConnections(div_id); //删除divID所有连接线
                    jsPlumb.removeAllEndpoints(div_id); //刪除divID所有端點
                    addPoints(div_id);
                }
                if (ini_height == fontSize * 5 + 40) {
                    direction1 = "TopCenter";
                    direction2 = "BottomCenter";
                    ini_top = (fontSize * 5 + 40) * qtys - fontSize * 5 - 20;
                    ini_height = -(fontSize * 5 + 40);
                    ini_left = ini_left + width + 20;
                    id_list = new Array;
                    j = 0;
                } else {
                    direction1 = "BottomCenter";
                    direction2 = "TopCenter";
                    ini_top = 20;
                    ini_height = fontSize * 5 + 40;
                    ini_left = ini_left + width + 20;
                    id_list = new Array;
                    j = 0;
                }
            }
            con_list.push(con_json);
            startID = connections[startID];
        }
        for (i = 0; i < len - 1; i++) {
            var id1 = con_list[i].id;
            var div = document.getElementById(id1);
            $("#left").val(div.offsetLeft);
            $("#top").val(div.offsetTop);
            $("#width").val(div.offsetWidth);
            var id2 = con_list[i + 1].id;
            var next_div = document.getElementById(id2);
            $("#next_left").val(next_div.offsetLeft);
            $("#next_top").val(next_div.offsetTop);
            $("#next_width").val(next_div.offsetWidth);
            var direction1 = con_list[i].direction1;
            var direction2 = con_list[i].direction2;
            $("#next").val("no");
            var label_value = connections[id1+"name"];
            if (label_value == "" || label_value == null || typeof(label_value) == "undefined") {
                var isVisible = false;
                label_value = "";
            } else {
                var isVisible = true;
            }
            addConnection(id1,id2,direction1,direction2,label_value,isVisible)
        }
        adjSeq();
        $("#arrange").val("");
    }

    //change save as button status
    function changeSaveAsStatus(status){
        if (status == "show"){
            $("#saveAsBtn")[0].dataset.options = "name:'save',iconCls:'icon-go-save'";
            $("#saveAsBtn").removeClass(" menu-item-disabled");
        }else{
            $("#saveAsBtn")[0].dataset.options = "name:'save',iconCls:'icon-go-save',disabled:true";
            $("#saveAsBtn").addClass(" menu-item-disabled");
        }
    }

    //change tab title
    function changeTabTitle(filepath, tab_index){
        var showed_paths = filepath.split("\\");
        var showed_path = "";
        var type = "";
        var select_type = filepath.split("\\")[0];
        if (select_type == "public") {
            showed_path = "Public"
            for (var i = 1; i < showed_paths.length; i++) {
                showed_path = showed_path + "\\" + showed_paths[i];
            }
            type = 'public';
        } else if (select_type == "release") {
            showed_path = "Release"
            for (var i = 1; i < showed_paths.length; i++) {
                showed_path = showed_path + "\\" + showed_paths[i];
            }
            type = 'release';
        } else {
            showed_path = "Private"
            for (var i = 1; i < showed_paths.length; i++) {
                showed_path = showed_path + "\\" + showed_paths[i];
            }
            type = 'private';
        }
        showed_path = showed_path.replace(".py", "");
        var file_paths = showed_path.split('\\');
        var file_name = file_paths[file_paths.length - 1];
        var exist_tabs = $("#tt").tabs('tabs');
        var title_list = new Array;
        var tab_title = file_name;
        var select_tab = $('.tabs-selected').text();
        for (var i = 0; i < exist_tabs.length; i++) {
            var exist_title = exist_tabs[i].panel('options').title;
            title_list.push(exist_title)
        }
        $('#tt').tabs("select", select_tab);
        var result = title_list.includes(tab_title);
        var ini_num = 2;
        while (result == true) {
            tab_title = file_name + ' (' + ini_num + ')';
            result = title_list.includes(tab_title);
            ini_num += 1;
        }
        $("#tt").tabs('getSelected').panel('options').title = tab_title;
        $(".tabs-selected").find("span:eq(0)")[0].innerText = tab_title;
        $('#file_path_label' + tab_index.toString()).text(showed_path);
        $("#selectfile" + tab_index.toString()).val(filepath);
        changeSaveAsStatus("show");
    }

    //save process
    function saveProcess(type) {
        $("#type").val(type);
        var btn = "";
        if (type != "release") {
            layer.open({
                type: 2,
                title: '{% trans "Files List" %}',
                skin: 'layui-layer-lan',
                //加上边框
                area: ['330px', '350px'],
                //宽高
                maxmin: true,
                content: '../openfile/?type=' + type,
                btn: ['{% trans "Save" %}', '{% trans "Cancel" %}', '{% trans "New Folder" %}'],
                btn1: function(index, layero) {
                    var className = document.getElementsByClassName("layui-layer-btn0")[0].className;
                    if (className.indexOf("disable") != -1) {
                        return false;
                    }
                    var body = layer.getChildFrame('body', index);
                    var pass = body.find("#text").val().replace(/(^\s*)|(\s*$)/g, "");//替换字符串最后的空格
                    var pattern = new RegExp("[^a-zA-Z0-9\_\u4e00-\u9fa5\s ]","i");
                    var illegal = pattern.test(pass);
                    if (illegal == true) {
                        layer.msg(gettext('File name contains illegal characters!'));
                        return false;
                    }
                    if (pass == null || pass == "") {
                        layer.msg(gettext('Please input your file name!'));
                        return false;
                    } else {
                        var filepath = "";
                        var iframeWin = window[layero.find('iframe')[0]['name']];
                        var selectfile = iframeWin.getRow();
                        var folder = selectfile;
                        if (selectfile.indexOf(".py") > 0) {
                            var files = selectfile.split("\\");
                            filepath = files[0];
                            for (var i = 1; i < files.length - 1; i++) {
                                filepath = filepath + "\\" + files[i];
                            }
                            folder = filepath;
                            filepath = filepath + "\\" + pass + ".py";
                        } else {
                            filepath = selectfile + "\\" + pass + ".py";
                        }
                        if (folder == ""){
                            layer.msg(gettext('Files are not allowed to be saved at this level!'));
                            return false;
                        }else{
                            var folder_list = folder.split("\\");
                            var folder_type = folder_list[0];
                            if (folder_type == "release" || folder_type == "public"){
                                if (folder_list.length < 4){
                                    layer.msg(gettext('Files are not allowed to be saved at this level!'));
                                    return false;
                                }
                            }
                        }
                        var param = getConnections();
                        // 增加保存的基本条件，如果没有完整的一个条流程，无法保存。
                        start_text = param["startID"] + "text";
                        start_confirm_text = param[start_text]
                        var end_text = ""
                        for (var key in param) {
                            if (param[key] == "End"){
                                end_text = "End"
                            }
                        }
                        if (start_confirm_text != "Start" || end_text != "End"){
                            layer.msg(gettext("Saving with errors! You have not created a complete process."), {
                                time: 3000,
                                icon: 5,
                            });
                            return
                        }

                        param.name = filepath;
                        param.type = "file";
                        $.ajax({
                            type: 'POST',
                            url: '../filejudge/',
                            dataType: 'json',
                            data: param,
                            success: function(data) {
                                var result = data['result'];
                                if (result == true) {
                                    var message = data['msg'];
                                    if (message == "success") {
                                        layer.confirm('{% trans "Are you sure to overwrite" %}?', {
                                            title: "{% trans "Overwrite Confirmation" %}",
                                            btn: ['{% trans "Yes" %}', '{% trans "No" %}']
                                        },
                                        function(index) {
                                            layer.close(index);
                                            var connections = getConnections();
                                            var list = new Array;
                                            var tab_index = getActiveTab();
                                            var childs = $('#process-area'+ tab_index.toString()).find('.jnode-box');
                                            for (var i = 0; i < childs.length; i++) {
                                                var json = {};
                                                var child = childs[i];
                                                json.id = child.parentElement.id;
                                                try {
                                                    json.jnodeClass = child.className.replace("jnode-box ", "");
                                                } catch(err) {
                                                    continue;
                                                }
                                                if (json.jnodeClass.indexOf("bdc-success") != -1) {
                                                    json.jnode = "start"
                                                } else if (json.jnodeClass.indexOf("bdc-danger") != -1 || json.jnodeClass.indexOf("bdc-wait") != -1) {
                                                    json.jnode = "end"
                                                } else if (json.jnodeClass.indexOf("bdc-warning") != -1) {
                                                    json.jnode = "judge"
                                                } else {
                                                    json.jnode = "task"
                                                }
                                                json.jnodeHtml = child.innerHTML;
                                                json.left = child.parentElement.offsetLeft;
                                                json.top = child.parentElement.offsetTop;
                                                json_2_str = JSON.stringify(json);
                                                list.push(json_2_str);
                                            }
                                            connections.type = $("#type").val();
                                            connections.name = filepath;
                                            connections.html = list;
                                            $.ajax({
                                                type: 'POST',
                                                url: '../saveprocess/',
                                                dataType: 'json',
                                                data: connections,
                                                beforeSend: function() {
                                                    layer.load(2);
                                                },
                                                success: function(data) {
                                                    layer.closeAll('loading');
                                                    var result = data['result'];
                                                    var used_list = data['used_list'];
                                                    if (result == "success") {
                                                        if (used_list.length == 0) {
                                                            layer.msg('{% trans "Saved successfully" %}!', {
                                                                time: 3000,
                                                                icon: 6,
                                                            });
                                                        } else {
                                                            var content = '<div style="padding: 50px; line-height: 22px; background-color: #393D49; color: #fff; font-weight: 300;">{% trans "Save successfully, this process is used in below process" %}!<br><br>'
                                                            for (var j = 0; j < used_list.length; j++) {
                                                                content = content + used_list[j] + '<br>';
                                                            }
                                                            content = content + '</div>';
                                                            layer.open({
                                                                type: 1,
                                                                title: false //不显示标题栏
                                                                ,
                                                                closeBtn: false,
                                                                area: '400px;',
                                                                shade: 0.8,
                                                                id: 'Releated Process' //设定一个id，防止重复弹出
                                                                ,
                                                                btn: ['Get it'],
                                                                btnAlign: 'c',
                                                                moveType: 1 //拖拽模式，0或者1
                                                                ,
                                                                content: content
                                                            })
                                                        }
                                                    } else {
                                                        layer.msg('{% trans "Saved successfully,but some error with your process" %}!', {
                                                            time: 3000,
                                                            icon: 5,
                                                        });
                                                        var conso = data['error'];
                                                        $('#control_area').html(conso);
                                                        $('#cc').layout('expand', 'south');
                                                    }
                                                    var currentPath = $("#selectfile" + tab_index.toString()).val();
                                                    if (filepath != currentPath){
                                                        changeTabTitle(filepath, tab_index);
                                                    }
                                                },
                                            });
                                        })
                                    } else {
                                        layer.msg(gettext(message), {
                                            time: 3000,
                                            icon: 5,
                                        });
                                    }
                                } else {
                                    layer.close(index);
                                    var connections = getConnections();
                                    var tab_index = getActiveTab();
                                    var childs = $('#process-area'+ tab_index.toString()).find('.jnode-box');
                                    var list = new Array;
                                    for (var i = 0; i < childs.length; i++) {
                                        var json = {};
                                        var child = childs[i];
                                        json.id = child.parentElement.id;
                                        try {
                                            json.jnodeClass = child.className.replace("jnode-box ", "");
                                        } catch(err) {
                                            continue;
                                        }
                                        if (json.jnodeClass.indexOf("bdc-success") != -1) {
                                            json.jnode = "start"
                                        } else if (json.jnodeClass.indexOf("bdc-danger") != -1 || json.jnodeClass.indexOf("bdc-wait") != -1) {
                                            json.jnode = "end"
                                        } else if (json.jnodeClass.indexOf("bdc-warning") != -1) {
                                            json.jnode = "judge"
                                        } else {
                                            json.jnode = "task"
                                        }
                                        json.jnodeHtml = child.innerHTML;
                                        json.left = child.parentElement.offsetLeft;
                                        json.top = child.parentElement.offsetTop;
                                        json_2_str = JSON.stringify(json);
                                        list.push(json_2_str);
                                    }
                                    connections.type = $("#type").val();
                                    connections.name = filepath;
                                    connections.html = list;
                                    $.ajax({
                                        type: 'POST',
                                        url: '../saveprocess/',
                                        dataType: 'json',
                                        data: connections,
                                        beforeSend: function() {
                                            layer.load(2);
                                        },
                                        success: function(data) {
                                            layer.closeAll('loading');
                                            var result = data['result'];
                                            if (result == "success") {
                                                layer.msg('{% trans "Saved successfully" %}!', {
                                                    time: 3000,
                                                    icon: 6,
                                                });
                                            } else {
                                                var message = data['msg'];
                                                layer.msg(gettext(message), {
                                                    time: 3000,
                                                    icon: 5,
                                                });
                                                var conso = data['error'];
                                                $('#control_area').html(conso);
                                                $('#cc').layout('expand', 'south');
                                            }
                                            var currentPath = $("#selectfile" + tab_index.toString()).val();
                                            if (filepath != currentPath){
                                                changeTabTitle(filepath, tab_index);
                                            }
                                        },
                                    });
                                }
                            }
                        })
                    }
                },
                btn3: function(index, layero) {
                    var className = document.getElementsByClassName("layui-layer-btn2")[0].className;
                    if (className.indexOf("disable") != -1) {
                        return false;
                    }
                    var body = layer.getChildFrame('body', index);
                    var pass = body.find("#text").val();
                    if (pass == null || pass == "") {
                        layer.msg(gettext('Please input your folder name!'));
                        return false;
                    } else {
                        var filepath = "";
                        var iframeWin = window[layero.find('iframe')[0]['name']];
                        var selectfile = iframeWin.getRow();
                        var folder = selectfile;
                        if (selectfile.indexOf(".py") > 0) {
                            var files = selectfile.split("\\");
                            filepath = files[0];
                            for (var i = 1; i < files.length - 1; i++) {
                                filepath = filepath + "\\" + files[i];
                            }
                            folder = filepath;
                            filepath = filepath + "\\" + pass;
                        } else {
                            filepath = selectfile + "\\" + pass;
                        }
                        if (folder == ""){
                            layer.msg(gettext('Folders are not allowed to be created at this level!'));
                            return false;
                        }else{
                            var folder_list = folder.split("\\");
                            var folder_type = folder_list[0];
                            if (folder_type == "release" || folder_type == "public"){
                                if (folder_list.length < 4){
                                    layer.msg(gettext('Folders are not allowed to be created at this level!'));
                                    return false;
                                }
                            }
                        }
                        param = {
                            "name": filepath,
                            "type": "folder"
                        };
                        $.ajax({
                            type: 'POST',
                            url: '../createfolder/',
                            dataType: 'json',
                            data: param,
                            success: function(data) {
                                var result = data['result'];
                                if (result == "success") {
                                    layer.msg('{% trans "Create folder successfully" %}!', {
                                        time: 1000,
                                        icon: 6,
                                    });
                                    iframeWin.setSelect();
                                    iframeWin.FindData();
                                } else {
                                    layer.msg('{% trans "Create folder failed" %}!', {
                                        time: 1000,
                                        icon: 5,
                                    });
                                    var msg = data['msg'];
                                    $('#control_area').html(msg);
                                    $('#cc').layout('expand', 'south');
                                }
                            }
                        })
                    }
                    return false;
                },
                success: function(layero, index) {
                    var btns = document.getElementsByClassName("layui-layer-btn0");
                }
            })
        } else {
            var index = layer.open({
                type: 2,
                title: '{% trans "Release Process" %}',
                skin: 'layui-layer-lan',
                //加上边框
                area: ['330px', '350px'],
                //宽高
                maxmin: true,
                content: '../releasefile/',
                btn: ['{% trans "Release Process" %}', '{% trans "Cancel" %}', '{% trans "New Folder" %}'],
                btn1: function(index, layero) {
                    var className = document.getElementsByClassName("layui-layer-btn0")[0].className;
                    if (className.indexOf("disable") != -1) {
                        return false;
                    }
                    var body = layer.getChildFrame('body', index);
                    var selected_path = body.find("#selected_path").val();
                    var selected_file = body.find("#selected_file").val();
                    if (selected_path == null || selected_path == "") {
                        layer.msg(gettext('Please choose release file first!'));
                        return false;
                    } else {
                        var folder = body.find("#selected_folder").val();
                        var folder_list = folder.split("\\");
                        var folder_type = folder_list[0];
                        if (folder_list.length < 4){
                            layer.msg(gettext('Folders are not allowed to be created at this level!'));
                            return false;
                        }
                        var iframeWin = window[layero.find('iframe')[0]['name']];
                        var filepath = folder + "\\" + selected_file + ".py";
                        param = {
                            "org_file": selected_path,
                            "new_folder": folder,
                            "copy_file": filepath,
                            "copy": "no"
                        };
                        $.ajax({
                            type: 'POST',
                            url: '../releasecopy/',
                            dataType: 'json',
                            data: param,
                            beforeSend: function() {
                                layer.load(2);
                            },
                            success: function(data) {
                                layer.closeAll('loading');
                                var result = data['result'];
                                if (result == true) {
                                    layer.confirm('{% trans "Are you sure to overwrite" %}?', {
                                        title: '{% trans "Overwrite Confirmation" %}',
                                        btn: ['{% trans "Yes" %}', '{% trans "No" %}']
                                    },
                                    function(index) {
                                        param = {
                                            "org_file": selected_path,
                                            "new_folder": folder,
                                            "copy_file": filepath,
                                            "copy": "yes"
                                        };
                                        $.ajax({
                                            type: 'POST',
                                            url: '../releasecopy/',
                                            dataType: 'json',
                                            data: param,
                                            beforeSend: function() {
                                                layer.load(2);
                                            },
                                            success: function(data) {
                                                layer.closeAll('loading');
                                                var operation = data['operation'];
                                                if (operation == "success") {
                                                    layer.msg('{% trans "Release process successfully" %}!', {
                                                        time: 3000,
                                                        icon: 6,
                                                    });
                                                    iframeWin.reload('tree2');
                                                } else {
                                                    layer.msg('{% trans "Release process failed" %}!', {
                                                        time: 3000,
                                                        icon: 5,
                                                    });
                                                }
                                            }
                                        })
                                    })
                                } else {
                                    var operation = data['operation'];
                                    if (operation == "success") {
                                        layer.msg('{% trans "Release process successfully" %}!', {
                                            time: 3000,
                                            icon: 6,
                                        });
                                        iframeWin.reload('tree2');
                                    } else {
                                        layer.msg('{% trans "Release process failed" %}!', {
                                            time: 3000,
                                            icon: 5,
                                        });
                                    }
                                }
                            }
                        })
                    }
                    return false;
                },
                btn3: function(index, layero) {
                    var className = document.getElementsByClassName("layui-layer-btn2")[0].className;
                    if (className.indexOf("disable") != -1) {
                        return false;
                    }
                    var body = layer.getChildFrame('body', index);
                    var folder_name = body.find("#new_folder").val();
                    if (folder_name == null || folder_name == "") {
                        return false;
                    } else {
                        var folder = body.find("#selected_folder").val();
                        var folder_list = folder.split("\\");
                        var folder_type = folder_list[0];
                        if (folder_list.length < 4){
                            layer.msg(gettext('Folders are not allowed to be created at this level!'));
                            return false;
                        }
                        var iframeWin = window[layero.find('iframe')[0]['name']];
                        var filepath = folder + "\\" + folder_name;
                        param = {
                            "name": filepath,
                            "type": "folder"
                        };
                        $.ajax({
                            type: 'POST',
                            url: '../releasejudge/',
                            dataType: 'json',
                            data: param,
                            success: function(data) {
                                var result = data['result'];
                                if (result == true) {
                                    layer.msg('{% trans "The folder already exists" %}!', {
                                        time: 2000
                                    });
                                } else {
                                    var operation = data['operation'];
                                    if (operation == "success") {
                                        layer.msg('{% trans "Create folder successfully" %}!', {
                                            time: 1000,
                                            icon: 6,
                                        });
                                        iframeWin.reload('tree2');
                                    } else {
                                        layer.msg('{% trans "Create folder failed" %}!', {
                                            time: 1000,
                                            icon: 5,
                                        });
                                    }
                                }
                            }
                        })
                    }
                    return false;
                },
                success: function(layero, index) {

                }
            });
            layer.full(index);
        }
    }

    function clean(){
        var tab_index = getActiveTab();
        if (parseInt(tab_index) == 0){
            layer.msg('{% trans "Not allowed in view codes" %}!', {
                offset: 't',
            });
            return false;
        }
        var divs = $('#process-area'+ tab_index.toString()).find('.jnode-box');
        if (divs.length > 0){
            layer.confirm('{% trans "Are you sure to clear this tab without saving" %}?', {
                title:'{% trans "Confirmation" %}',
                btn: ['{% trans "Yes" %}', '{% trans "No" %}'],
                btn1:function(tab_index){
                    layer.close(tab_index);
                    only_clean();
                },
                btn2:function(tab_index,layero){
                    layer.close(tab_index);
                }
            });
        }else{
            only_clean();
        }
    }

    //clear
    function only_clean() {
        $("#group_id").val("");
        $("#current_browser").text("");
        var tab_index = getActiveTab();
        $("#selectfile" + tab_index.toString()).val("");
        layer.load(2);
        var divs = $('#process-area'+ tab_index.toString()).find('.jnode-box');
        for (var i = 0; i < divs.length; i++) {
            var div = divs[i];
            div.parentElement.remove();
            try {
                var id = div.parentElement.id;
                jsPlumb.detachAllConnections(id);//删除divID所有连接线
                jsPlumb.removeAllEndpoints(id);//删除divID所有端点
                var index = span_width_list.indexOf(id);
                span_width_list.splice(index, 1);
                delete span_width_json[id];
                var index2 = div_selection_list.indexOf(id);
                if (index2 > -1){
                    div_selection_list.splice(index2, 1);
                    delete div_json[id];
                }
                delete name_json[id];
            } catch(err) {
                next;
            }
        }
        var svgs = $('#diagramContainer-main'+ tab_index.toString()).find("svg");
        for (var j=0;j<svgs.length;j++){
          var svg = svgs[j];
          svg.remove();
        }
        $('#file_path_label'+ tab_index.toString()).text('');
        $("#selectfile" + tab_index.toString()).val('');
        var currTab = $('#tt').tabs('getSelected');
        var tab_title = "";
        if (tab_index == ""){
            tab_title = "{% trans 'Flow' %}";
        }else{
            tab_title = "{% trans 'Flow' %}" + tab_index;
        }
        $('#tt').tabs('update',{tab:currTab,options:{title:tab_title}});
        $('#tt').tabs("select", tab_title);
        layer.closeAll('loading');
        if (tab_index == ''){tab_index = 0};
        $.ajax({
            type: 'POST',
            url: '../deleteaction/',
            dataType: 'json',
            data: {"tab":tab_index},
            success: function(data) {
                var result = data['result'];
                reloadJS("jvisio","../static/javascript/jvisio-flow/jvisio-index2.js");
            },
        });
        changeSaveAsStatus("disable");
    }

    //book
    function book(ip) {
        var index = layer.open({
            type: 2,
            title: '{% trans "Choose Timing Method" %}',
            skin: 'layui-layer-lan',
            area: ['650px', '600px'],
            maxmin: true,
            content: '../booktask/?ip=' + ip,
        });
        layer.full(index);
    }

    //check whether saved each step
    function variant_check(){
        var tab_index = getActiveTab();
        if (parseInt(tab_index) == 0){
            tab_index = process_index;
        }
        var divs = $('#process-area'+ tab_index.toString()).find('.jnode-box');
        var divId = "",startText = "";
        // 增加逻辑只检查在完整连线中的流程
        var connections = getConnections();
        for (var i=0;i<divs.length;i++){
            var div = divs[i];
            var id = div.parentElement.id;
            // 增加逻辑只检查在完整连线中的流程
            is_find = connections[id]
            if (is_find == undefined) {
                continue;
            }
            var obj = document.getElementById(id);
            if(obj){
                startText = obj.firstElementChild.firstElementChild.id || obj.innerText;
                if (startText != "" && startText != "null" && typeof(startText) != "undefined"){
                    if (startText != "Start" && startText != "End"){
                        var color =  $("#"+id).find(".jnode-box").eq(0).css("border-color");
                        if (color != "rgb(213, 133, 18)"){
                            if (color == "rgb(172, 41, 37)"){
                                $("#" + id).find(".jnode-box").eq(0).css("border", "3px solid #d58512");
                                return true;
                            }else{
                                try {
                                    $("#" + id).find(".jnode-box").eq(0).css("border", "3px solid #ac2925");
                                } catch(err) {
                                    console.log(err);
                                }
                                $('#control_area').html(gettext("Each step must be saved before running!") + "<br>" + gettext("Please check step:") + obj.innerText);
                                $('#cc').layout('expand', 'south');
                                return false;
                            }
                        }
                    }
                }
            }
        }
        return true;
    }

    //before run
    function before_run(ip) {
        //variant save check
        if (variant_check()){
            layer.load(2);
            var run_ip = ip;
            var connections = getConnections();
            // 增加保存的基本条件，如果没有完整的一个条流程，无法执行。
            start_text = connections["startID"] + "text";
            start_confirm_text = connections[start_text]
            var end_text = ""
            for (var key in connections) {
                if (connections[key] == "End"){
                    end_text = "End"
                }
            }
            if (start_confirm_text != "Start" || end_text != "End"){
                layer.msg(gettext("Run with errors! You have not created a complete process."), {
                    time: 3000,
                    icon: 5,
                });
                layer.closeAll('loading');
                return
            }
            var browser_input = connections['browser_input'];
            var browser_length = browser_input.length;
            $.ajax({
                type: 'POST',
                url: '../saveconnection/',
                dataType: 'json',
                data: connections,
                success: function(data) {
                    if (data == "system exit"){
                        parent.window.location.href = "../logout/";
                    }
                    var result = data.result;
                    if (result == "success") {
                        if (browser_length > 0) {
                            $.ajax({
                                type: 'POST',
                                url: '../getvars/',
                                dataType: 'json',
                                data: {
                                    "variant": browser_input
                                },
                                success: function(data) {
                                    var length = data.vars;
                                    var max_length = data.var_max_length;
                                    var height = '0px';
                                    if (length == 1) {
                                        height = '130px';
                                    } else if (length >= 2 && length < 6) {
                                        height = (60 + length * 70).toString() + 'px';
                                    } else if (length >= 6) {
                                        height = '480px';
                                    }
                                    layer.open({
                                        type: 2,
                                        title: '{% trans "Variants" %}',
                                        skin: 'layui-layer-lan',
                                        area: [max_length*20 + 220 +'px', height],
                                        content: '../browseradd/',
                                        btn: ['{% trans "Yes" %}', '{% trans "No" %}'],
                                        btn1: function(index, layero) {
                                            var iframeWin = window[layero.find('iframe')[0]['name']];
                                            var variant_list = []
                                            var variant_json = {};
                                            for (var i = 0; i < browser_input.length; i++) {
                                                var id = browser_input[i];
                                                var divs = iframeWin.document.getElementsByName(id);
                                                var value = "";
                                                for (var j = 0; j < divs.length; j++) {
                                                    var div = divs[j];
                                                    if (j != 0) {
                                                        value = value + "," + div.value;
                                                    } else {
                                                        value = value + div.value;
                                                    }
                                                }
                                                variant_json[id] = value;
                                                variant_list.push(id);
                                            };
                                            layer.close(index);
                                            variant_json.variant = variant_list;
                                            $.ajax({
                                                type: 'POST',
                                                url: '../changevariant/',
                                                dataType: 'json',
                                                data: variant_json,
                                                success: function(data) {
                                                    var result = data.result;
                                                    if (result == "success") {
                                                        run(run_ip);
                                                    } else {
                                                        layer.alert('{% trans "Update Variants Failed!" %}', {
                                                            title: '{% trans "Error Message" %}',
                                                            skin: 'layui-layer-lan',
                                                            closeBtn: 1,
                                                            icon: 5,
                                                            offset: 'rb',
                                                            btn: false,
                                                        });
                                                        return "failed";
                                                    }
                                                }
                                            });
                                        },
                                        btn2: function(index, layero) {
                                            layer.close(index);
                                            layer.closeAll('loading');
                                            return "cancel";
                                        },
                                    })
                                }
                            })
                        } else {
                            run(run_ip);
                        }
                    } else {
                        layer.closeAll('loading');
                        layer.alert('{% trans "Incorrect connection" %}!', {
                            title: '{% trans "Failed Process" %}',
                            skin: 'layui-layer-lan',
                            closeBtn: 1,
                            icon: 5,
                            offset: 'rb',
                            btn: false,
                        });
                    }
                }
            })
        }
    }

    //run
    function run(ip) {
        $('#control_area').html('');
        $("#group_id").val("");
        var connections = getConnections();
        if (connections.length == 0){
            layer.closeAll('loading');
            return false;
        }
        var user_ip = "";
        if (ip == "fix") {
            layer.prompt({
                btn: ['{% trans "Yes" %}', '{% trans "No" %}'],
                title: '{% trans "Please input your ip address" %}',
                formType: 3,
                btn2: function(index, layero) {
                    layer.closeAll('loading');
                },
            },
            function(pass, index) {
                layer.close(index);
                user_ip = pass;
            })
        } else {
            if (ip == "own") {
                user_ip = "{{ip}}";
            }
        }
        var tab_index = getActiveTab();
        var selectfile = $('#file_path_label' + tab_index.toString()).text();
        var port = "{{ port }}";
        var url = "http://127.0.0.1:" + port;
        if (ws == '') {
            try {
                $.ajax({
                    url: url,
                    type: 'post',
                    dataType: 'json',
                    data: {},
                    success: function(data) {
                        var result = data['result'];
                        if (result == "success") {
                            var mc = data["mac"];
                            var uuid = data["uuid"];
                            createWs();
                            setTimeout(function(){
                                c_args = JSON.stringify({"action":"run","connections":JSON.stringify(connections),"selectfile":selectfile,"mc":mc,"uuid":uuid});
                                layer.load(2);
                                ws.onopen();
                            },2000);
                        }
                    },
                    error: function (xhr, textStatus, errorThrown) {
                        var mc = "";
                        var uuid = "";
                        c_args = JSON.stringify({"action":"run","connections":JSON.stringify(connections),"selectfile":selectfile,"mc":mc,"uuid":uuid});
                        createWs();
　　　　            }
                });
            } catch {
                c_robot_warning();
            }
        } else {
            $.ajax({
                url: url,
                type: 'post',
                dataType: 'json',
                data: {},
                success: function(data) {
                    var result = data['result'];
                    if (result == "success") {
                        var mc = data["mac"];
                        var uuid = data["uuid"];
                        c_args = JSON.stringify({"action":"run","connections":JSON.stringify(connections),"selectfile":selectfile,"mc":mc,"uuid":uuid});
                        layer.load(2);
                        ws.onopen();
                    }
                },
                error: function (xhr, textStatus, errorThrown) {
                    var mc = "";
                    var uuid = "";
                    c_args = JSON.stringify({"action":"run","connections":JSON.stringify(connections),"selectfile":selectfile,"mc":mc,"uuid":uuid});
                    layer.load(2);
                    ws.onopen();
　　　　        }
            });
        }
    }

    //target
    function target() {
        document.body.style.cursor = "pointer";
        current_ip = "{{ip}}";
        var event = window.event || arguments[0];
        var obj = event.srcElement;
        var children = obj.parentElement.children;
        var inputObj = children[children.length - 1];
        c_sap_id = inputObj.id;
        if ($("#element_name").length > 0) {
            if (ws == ''){
                try{
                    c_args = JSON.stringify({"action":"sap_target"});
                    createWs();
                }catch{
                    c_robot_warning();
                }
            }else{
                c_args = JSON.stringify({"action":"sap_target"});
                layer.load(2);
                ws.onopen();
            }
        } else {
            layer.msg('{% trans "Can not find sap id field" %}!', {
                time: 1000,
                icon: 5,
            });
            document.body.style.cursor = "default";
        }
    }

    //browser_change
    function browser_change() {
        var tab_index = getActiveTab();
        $("#browser_mode" + tab_index.toString()).val($("#browser").val());
        var browser_des = "Current browser: " + $("#browser").find("option:selected").text();
        $("#current_browser" + tab_index.toString()).text(gettext(browser_des));
        if ($("#browser").val().replace(/\"/g,"") == "ie" && $("#browser_path").val().replace(/\"/g,"") == ""){
            $("#browser_path").val("\"C:\\Program Files\\Internet Explorer\\iexplore.exe\"");
        }
    }

    //web_target
    function web_target() {
        document.body.style.cursor = "pointer";
        $("#element_name").val("");
        current_ip = "{{ip}}";
        web_target_json = {};
        url = 'http://' + current_ip + ':8080/webtar';
        if ($("#element_name").length > 0) {
            if (ws == ''){
                try{
                    createWs();
                }catch{
                    c_robot_warning();
                }
            }else{
                layer.load(2);
                layer.msg('{% trans "Please choose your webpage" %}!' + '</br>' + '{% trans "Chrome eg: ctrl+1 for page1" %}', {
                    offset: 't',
                });
                var tab_index = getActiveTab();
                var browser_mode = $("#browser_mode" + tab_index.toString()).val().replace(/\"/g,"");
                var sleepSeconds = parseInt($("#delay").val());
                if (typeof(sleepSeconds) == "undefined" || sleepSeconds == ""){
                    sleepSeconds = 0;
                }
                c_args = JSON.stringify({"action":"web_target","browser":browser_mode,"delay":sleepSeconds});
                ws.onopen();
            }
        } else {
            layer.closeAll('loading');
            layer.msg('{% trans "No connection" %}!', {
                time: 1000,
                icon: 5,
            });
            document.body.style.cursor = "default";
        }
    }

    //web_crawl
    function web_crawl() {
        document.body.style.cursor = "pointer";
        if (ws == ''){
            try{
                createWs();
            }catch{
                c_robot_warning();
            }
        }else{
            var tab_index = getActiveTab();
            var browser_mode = $("#browser_mode" + tab_index.toString()).val().replace(/\"/g,"");
            c_args = JSON.stringify({"action":"web_crawl","browser":browser_mode});
            ws.onopen();
        }
    }

    //web_tar_change
    function web_tar_change(ele) {
        var id = ele.id;
        var value = $("#method").val().replace(/"/g,"");
        if (JSON.stringify(web_target_json) != "{}"){
            if (value == "id" || value == "ID"){
                $("#element_name").val('"' + web_target_json.id + '"');
                if (JSON.stringify(web_target_json).indexOf("id_sequence") != -1){$("#element_sequence").val(web_target_json.id_sequence);}
            }else if(value == "name" || value == "NAME"){
                $("#element_name").val('"' + web_target_json.name + '"');
                if (JSON.stringify(web_target_json).indexOf("name_sequence") != -1){$("#element_sequence").val(web_target_json.name_sequence);}
            }else if(value == "className" || value == "CLASS_NAME"){
                $("#element_name").val('"' + web_target_json.className + '"');
                if (JSON.stringify(web_target_json).indexOf("class_sequence") != -1){$("#element_sequence").val(web_target_json.class_sequence);}
            }else if(value == "xpath" || value == "XPAHT"){
                $("#element_name").val('"' + web_target_json.xpath + '"');
                if (JSON.stringify(web_target_json).indexOf("class_sequence") != -1){$("#element_sequence").val(0);}
            }else if(value == "linkText" || value == "LINK_TEXT"){
                $("#element_name").val('"' + web_target_json.linkText + '"');
                if (JSON.stringify(web_target_json).indexOf("link_sequence") != -1){$("#element_sequence").val(web_target_json.link_sequence);}
            }else if(value == "css" || value == "CSS"){
                $("#element_name").val('"' + web_target_json.css + '"');
            }
        }else{
            if (id == "method"){
                if (value == "ID"){
                    $("#element_name").val('"' + web_target_json.id + '"');
                    $("#way").val("id");
                }else if(value == "NAME"){
                    $("#element_name").val('"' + web_target_json.name + '"');
                    $("#way").val("id");
                }else if(value == "CLASS_NAME"){
                    $("#element_name").val('"' + web_target_json.className + '"');
                    $("#way").val("id");
                }else if(value == "XPATH"){
                    $("#element_name").val('"' + web_target_json.xpath + '"');
                    $("#way").val("id");
                }else if(value == "LINK_TEXT"){
                    $("#element_name").val('"' + web_target_json.text + '"');
                    $("#way").val("id");
                }else if(value == "CSS"){
                    $("#element_name").val('"' + web_target_json.css + '"');
                    $("#way").val("id");
                }
            }else{
                if (value == "name" || value == "NAME"){
                    $("#element_name").val('"' + web_target_json.name + '"');
                    $("#element_sequence").val(web_target_json.name_item);
                    $("#method").val("tagName");
                }else if(value == "class_name" || value == "CLASS_NAME"){
                    $("#element_name").val('"' + web_target_json.className + '"');
                    $("#element_sequence").val(web_target_json.className_item);
                    $("#method").val("tagName");
                }else if(value == "tag_name" || value == "TAG_NAME"){
                    $("#element_name").val('"' + web_target_json.tagName + '"');
                    $("#element_sequence").val(web_target_json.tagName_item);
                    $("#method").val("tagName");
                }
            }
        }
    }

    function sleep(delay){
      var start = new Date().getTime();
      while (new Date().getTime() < start + delay);
    }

    //general_target
    function general_target() {
        document.body.style.cursor = "pointer";
        if (ws == ''){
            try{
                createWs();
            }catch{
                c_robot_warning();
            }
        }else{
            var display = $("#find_method").val();
            var sleepSeconds = parseInt($("#delay").val());
            if (display == '1'){
                var position = $("#mouse_position").val();
                c_args = JSON.stringify({"action":"icon_target","position":position,"delay":sleepSeconds});
                ws.onopen();
            }else{
                var div = document.getElementById("h_control_tree");
                if (div){
                    showTree();
                }
                if (sleepSeconds > 0){
                    sleep(sleepSeconds * 1000);
                }
                c_args = JSON.stringify({"action":"handle_target"});
                ws.onopen();
            }
        }
    }

    function Picture_Shot_handle_target() {
        document.body.style.cursor = "pointer";
        if (ws == ''){
            try{
                createWs();
            }catch{
                c_robot_warning();
            }
        }else{
            var sleepSeconds = parseInt($("#delay").val());
            if (sleepSeconds > 0){
                sleep(sleepSeconds * 1000);
            }
            c_args = JSON.stringify({"action":"handle_target"});
            ws.onopen();
        }
    }

    function Picture_Shot_Coordinate_target() {
        document.body.style.cursor = "pointer";
        if (ws == ''){
            try{
                createWs();
            }catch{
                c_robot_warning();
            }
        }else{
            var display = $("#find_method").val();
            var sleepSeconds = parseInt($("#delay").val());
            var position = $("#mouse_position").val();
            c_args = JSON.stringify({"action":"icon_coordinate_target","position":position,"delay":sleepSeconds});
            ws.onopen();
        }
    }


    //mouse_target
    function mouse_target() {
        document.body.style.cursor = "pointer";
        if (ws == ''){
            try{
                createWs();
            }catch{
                c_robot_warning();
            }
        }else{
            var method = $("#move_type").val();
            if (method == undefined){
                var dragType = $("#drag_type").val();
                if (dragType == undefined){
                    method = "scroll";
                }else{
                    method = dragType;
                }
            }
            c_args = JSON.stringify({"action":"mouse_target","method":method});
            ws.onopen();
        }
    }

    //mouse_target
    function web_dragging_mouse_target() {
        document.body.style.cursor = "pointer";
        if (ws == ''){
            try{
                createWs();
            }catch{
                c_robot_warning();
            }
        }else{
            var method = $("#move_type").val();
            if (method == undefined){
                var dragType = $("#drag_type").val();
                if (dragType == undefined){
                    method = "scroll";
                }else{
                    method = dragType;
                }
            }
            c_args = JSON.stringify({"action":"web_dragging_mouse_target","method":method});
            ws.onopen();
        }
    }

    //elementsChange
    function elementsChange() {
        var display = $("#find_method").val();
        if (display == '1'){
            $("#img_screenshot").show();
            $("#img_position").css('display','block');
            $("#match_rate").css('display','block');
        }else{
            $("#img_screenshot").hide()
            $("#img_position").css('display','none');
            $("#match_rate").css('display','none');
        }
    }
    //tableOptions()
    function tableOptions() {
        var display = $("#table_chosen").val().replace(/\"/g,"");
        if (display == 'refresh'){
            $("#excel_pivotTable_refresh").parent().show();
            $("#table_start").parent().hide();
            $("#pivotremind").parent().hide();

        }else{
            $("#excel_pivotTable_refresh").parent().hide()
            $("#table_start").parent().show()
            $("#pivotremind").parent().show()

        }
    }

    function elementsChange_Conditional_Format() {
        var display = $("#highlight_cell_rules").val();
        if (display == '0' || display == '1' ||  display == '3'){
            $("#img_number1").show();
            $("#img_text").hide();
            $("#img_minimum").hide();
            $("#img_maxmum").hide();
            $("#img_date").hide();
            $("#img_characteristics").hide();
            $("#item_selection_rules").attr("disabled",true);
        }else if(display == '2'){
            $("#img_number1").hide();
             $("#img_minimum").show();
            $("#img_maxmum").show();
            $("#img_text").hide();
            $("#img_date").hide();
            $("#img_characteristics").hide();
            $("#item_selection_rules").attr("disabled",true);
        }else if(display == '1000'){
            $("#img_number1").hide();
            $("#img_minimum").hide();
            $("#img_maxmum").hide();
            $("#img_text").hide();
            $("#img_date").hide();
            $("#img_characteristics").hide();
            $("#item_selection_rules").attr("disabled",false);
        }else if(display == '4'){
            $("#img_text").show();
            $("#img_number1").hide();
            $("#img_minimum").hide();
            $("#img_maxmum").hide();
            $("#img_date").hide();
            $("#img_characteristics").hide();
            $("#item_selection_rules").attr("disabled",true);
        }else if(display == '5'){
            $("#img_date").show();
            $("#img_text").hide();
            $("#img_number1").hide();
            $("#img_minimum").hide();
            $("#img_maxmum").hide();
            $("#img_characteristics").hide();
            $("#item_selection_rules").attr("disabled",true);
        }else if(display == '6'){
            $("#img_characteristics").show();
            $("#img_text").hide();
            $("#img_number1").hide();
            $("#img_minimum").hide();
            $("#img_maxmum").hide();
            $("#img_date").hide();
            $("#item_selection_rules").attr("disabled",true);
        }
    }

    function elementsChange_Item_Selection_Rules() {
        var display = $("#item_selection_rules").val();
        if (display == '0' || display == '1' ||  display == '3' || display == '2'){
            $("#img_number1").show();
            $("#img_minimum").hide();
            $("#img_maxmum").hide();
            $("#img_text").hide();
            $("#img_date").hide();
            $("#img_characteristics").hide();
            $("#highlight_cell_rules").attr("disabled",true);
        }else if(display == '1000'){
            $("#img_number1").hide();
            $("#img_minimum").hide();
            $("#img_maxmum").hide();
            $("#img_text").hide();
            $("#img_date").hide();
            $("#img_characteristics").hide();
            $("#highlight_cell_rules").attr("disabled",false);
        }else if(display == '4' || display == '5'){
            $("#img_number1").hide();
            $("#img_minimum").hide();
            $("#img_maxmum").hide();
            $("#img_text").hide();
            $("#img_date").hide();
            $("#img_characteristics").hide();
            $("#highlight_cell_rules").attr("disabled",true);
        }
    }

    function elementsChange_Parse_Other() {
        var display = $("#symbol").val();
        if (display == '1'){
            $("#img_respectively").show();
        }else{
            $("#img_respectively").hide();
        }
    }

    function elementsChange_Picture_Shot_Coordinate() {
        var display = $("#find_method").val();
        if (display == '1'){
            $("#img_screenshot").show();
            $("#Picture_Shot_Coordinate_save_path_display").css('display','none');
            $("#Picture_Shot_Coordinate_output_display").css('display','block');
        }else{
            $("#img_screenshot").show();
            $("#Picture_Shot_Coordinate_save_path_display").css('display','block');
            $("#Picture_Shot_Coordinate_output_display").css('display','none');
        }
    }

    function elementsChange_Picture_Shot_Handle() {
        var display = $("#find_method").val();
        if (display == '1'){
            $("#img_screenshot").show();
            $("#Picture_Shot_Handle_save_path_display").css('display','none');
            $("#Picture_Shot_Handle_output_display").css('display','block');
        }else{
            $("#img_screenshot").show();
            $("#Picture_Shot_Handle_save_path_display").css('display','block');
            $("#Picture_Shot_Handle_output_display").css('display','none');
        }
    }

    function elementsChange_Picture_Shot_Web() {
        var display = $("#find_method").val();
        if (display == '1'){
            $("#Picture_Shot_Web_save_path_display").css('display','none');
<!--            $("#Picture_Shot_Web_output_display").css('display','block');-->
        }else{
            $("#Picture_Shot_Web_save_path_display").css('display','block');
<!--            $("#Picture_Shot_Web_output_display").css('display','none');-->
        }
     }

    function elementsChange_OCR() {
        var display = $("#find_method").val();
        if (display == '1'){
            $("#OCR_img_path_display").css('display','none');
            $("#OCR_input_picture_codes_display").css('display','block');

        }else{
            $("#OCR_imgpath_display").css('display','block');
            $("#OCR_input_picture_codes_display").css('display','none');

        }
     }


    function elementsChange_Verification_Code_Recognition() {
        var display = $("#find_method").val();
        if (display == '1'){
            $("#Verification_Code_Recognition_input_picture_codes_display").css('display','block');
            $("#Verification_Code_Recognition_img_path_display").css('display','none');

        }else{
            $("#Verification_Code_Recognition_input_picture_codes_display").css('display','none');
            $("#Verification_Code_Recognition_img_path_display").css('display','block');


        }
     }

    function elementsChange_Verification_Code_Recognition_vcode_type() {
        var display = $("#vcode_type").val();
        var arr1 = ["22","27"]
        var arr2 = ["29","33","53"]
        var arr3 = ["1003","11","16","66"]
        if ( arr1.includes(display) ){
            $("#Verification_Code_Recognition_pic_coordinates_input_display").css('display','block');

        }else if( arr2.includes(display) ){
            $("#Verification_Code_Recognition_pic_coordinates_input_display").css('display','none');

        }else if( arr3.includes(display) ){
            $("#Verification_Code_Recognition_pic_coordinates_input_display").css('display','none');

        }
    }

    function elementsChange_Web_Dragging() {
        var display = $("#dragging_method").val();
        var arr1 = ['"along x-axis"','"along y-axis"']
        if ( arr1.includes(display) ){
            $("#Web_Dragging_dragging_distance_display").css('display','block');

        }else if(display == '"along x-axis&y-axis"'){
            $("#Web_Dragging_dragging_distance_display").css('display','none');

        }
     }

    //reload JS
    function reloadJS(id, newJS) {
        var oldjs = null;
        var t = null;
        var oldjs = document.getElementById(id);
        if (oldjs) oldjs.parentNode.removeChild(oldjs);
        var scriptObj = document.createElement("script");
        scriptObj.src = newJS;
        scriptObj.type = "text/javascript";
        scriptObj.id = id;
        document.getElementsByTagName("head")[0].appendChild(scriptObj);
    }

    //change label
    function labelChange(id1, id2) {
        var labels = document.getElementsByClassName("_jsPlumb_overlay");
        var text1 = document.getElementById(id1).innerText;
        var div = document.getElementById(id2);
        var text2 = document.getElementById(id2).innerText;
        var text = text1 + "->" + text2;
        for (var i = 0; i < labels.length; i++) {
            var label = labels[i];
            var labelText = label.innerText;
            if (labelText == text) {
                label.setAttribute('name', id2);
                break;
            }
        }
    }

    //adjust
    function adjust(divId) {
        var div = document.getElementById(divId);
        var name = $("#name").val();
        var new_name = name.replace(/([^\u0000-\u00FF])/g,"  ");
        while (new_name.length > 32){
            name = name.substring(0, name.length-1);
            new_name = name.replace(/([^\u0000-\u00FF])/g,"  ");
        }
        $("#name").val(name);
        try{
            var option = {};
            option.target = divId;
            var con = jsPlumb.getConnections(option,"");
            var label = con[0].getOverlays(divId)[1];
            if (name != "" && name != null) {
                var label_name = name;
                if (new_name.length > 16){
                    var first_line = name.substring(0,Math.round(name.length / 2));
                    var second_line = name.substring(Math.round(name.length / 2),name.length);
                    label_name = first_line + "<br>" + second_line;
                    label.addClass("label-branch");
                }else{
                    label.removeClass("label-branch");
                }
                label.setLabel(label_name);
                label.setVisible(true);
            } else {
                label.setLabel("");
                label.setVisible(false);
            }
        }catch(e){
            console.log(e);
        }
    }

    //change
    function change(variant) {
        var id = variant.id;
        var i = variant['children'][1]['children'][0];
        var i_class = i['className'];
        if (i_class == "fa fa-chevron-up") {
            i.className = "fa fa-chevron-down";
            var classname = id + " show";
            var classname2 = id + " hide";
            var elements = document.getElementsByClassName(classname);
            for (var i in elements) {
                var element = elements[i];
                element.className = classname2;
            }
        } else {
            i.className = "fa fa-chevron-up";
        }
    }

    function judgeConnection(sourceId,targetId){
        var num = 0;
        var startDiv = document.getElementById(targetId);
        if (startDiv){
            var startText = startDiv.firstElementChild.firstElementChild.id || startDiv.innerText;
            if (startText == "" || startText == "null" || typeof(startText) == "undefined"){
                startText = startDiv.innerText;
            }
            startText = startText.replace(/\ +/g,"");
            startText = startText.replace(/[\r\n]/g,"");
            if (startText == "{% trans 'Start' %}" || startText == "Start"){
                num = 1
            }
        }
        var endDiv = document.getElementById(sourceId);
        if (endDiv){
            var endText = endDiv.firstElementChild.firstElementChild.id || endDiv.innerText;
            if (endText == "" || endText == "null" || typeof(endText) == "undefined"){
                endText = endText.innerText;
            }
            endText = endText.replace(/\ +/g,"");
            endText = endText.replace(/[\r\n]/g,"");
            if (endText == "{% trans 'End' %}" || endText == "End"){
                num = 1
            }
        }
        if (num == 0){
            var option = {};
            option.source = sourceId;
            var con = jsPlumb.getConnections(option,"");
            num = con.length;
        }
        if (num == 0){
            var option1 = {};
            option1.target = targetId;
            var con1 = jsPlumb.getConnections(option1,"");
            num = con1.length;
        }
        return num;
    }

    function getId(Name,curId){
        var connections = jsPlumb.getAllConnections();
        var tab_index = getActiveTab();
        if (parseInt(tab_index) == 0){
            tab_index = process_index;
        }
        var divs = $('#process-area'+ tab_index.toString()).find('.jnode-box');
        var divId = "",startText = "";
        for (var i=0;i<divs.length;i++){
            var div = divs[i];
            var id = div.parentElement.id;
            if (id == curId){
                continue;
            }
            var obj = document.getElementById(id);
            if(obj){
                startText = obj.firstElementChild.firstElementChild.id || obj.innerText;
                if (startText == "" || startText == "null" || typeof(startText) == "undefined"){
                   startText = startDiv.innerText;
                }
                startText = startText.replace(/\ +/g,"");
                startText = startText.replace(/[\r\n]/g,"");
                if (startText == Name){
                    divId = id;
                    break;
                }
            }
        }
        return divId;
    }

    function getConnections(){
        var connections = jsPlumb.getAllConnections();
        var tab_index = getActiveTab();
        if (parseInt(tab_index) == 0){
            tab_index = process_index;
        }
        var divs = $('#process-area'+ tab_index.toString()).find('.jnode-box');
        var div_list = new Array;
        for (var i=0;i<divs.length;i++){
            var div = divs[i];
            var id = div.parentElement.id;
            var obj = document.getElementById(id);
            if(obj){
                div_list.push(id);
            }
        }
        var json = {};
        var json2 = {};
        var startID = "",nextID = "",startText = "",endText = "",lastText = "";
        var tab_connections = new Array;
        for(var i=0;i<div_list.length;i++){
            var a = div_list[i];
            var startDiv = document.getElementById(a);
            if (startDiv){
                startText = startDiv.firstElementChild.firstElementChild.id || startDiv.innerText;
                if (startText == "" || startText == "null" || typeof(startText) == "undefined"){
                   startText = startDiv.innerText;
                }
                startText = startText.replace(/\ +/g,"");
                startText = startText.replace(/[\r\n]/g,"");
                var div_name = startDiv.children[0].children[0].getAttribute("name");
                if (div_name == null || typeof(div_name) == "undefined"){
                    div_name = "";
                }
                if (startText == "{% trans 'Start' %}" || startText == "Start"){
                    startID = a;
                    break;
                }
            }else{
                continue;
            }
        }
        json['startID'] = startID;
        var b = 0;
        var i = 0;
        var browser_input = [];
        while (b == 0 && startID != ""){
            var option = {};
            option.source = startID;
            var con = jsPlumb.getConnections(option,"");
            if (con.length > 0){
                nextID = con[0].targetId;
                var endDiv = document.getElementById(nextID);
                var endText = endDiv.firstElementChild.firstElementChild.id || endDiv.innerText;
                if (endText == "" || endText == "null" || typeof(endText) == "undefined"){
                    endText = endDiv.innerText;
                }
                var label = con[0].getOverlays(startID)[1].getLabel();
                json[startID+"name"] = label;
            }else{
                if (endText != "{% trans 'End' %}" && endText != "End"){
                    b = 1;
                }else{
                    json[nextID+"nodeNo"] = parseInt(i+1);
                    json[nextID+"text"] = "End";
                    json[startID+"lastNode"] = lastText;
                }
                break;
            }
            if (endText == "{% trans 'User_Input' %}" || endText == "User_Input"){
                browser_input.push(nextID);
            }
            var startDiv = document.getElementById(startID);
            var div_name = startDiv.children[0].children[0].getAttribute("name");
            if (div_name == null || typeof(div_name) == "undefined"){
                div_name = "";
            }
            json[startID+"source_type"] = con[0].endpoints[0].anchor.type;
            json[startID+"target_type"] = con[0].endpoints[1].anchor.type;
            json[startID+"text"] = startText;
            json[startID+"div_name"] = div_name;
            json[startID] = nextID;
            json[startID+"nextNode"] = endText;
            json[nextID+"lastNode"] = lastText;
            json[startID+"nodeNo"] = parseInt(i+1);
            json[nextID+"nodeNo"] = parseInt(i+2);
            startID = nextID;
            lastText = startText;
            startText = endText;
            i = i + 1;
        }
        if (tab_index == ''){tab_index = 0};
        json['tab'] = tab_index;
        json['length'] = i;
        json['version'] = '2.0';
        json['browser_input'] = browser_input;
        return json;
    }

    //quickSaving
    function quickSaving(status) {
        var tab_index = getActiveTab();
        if (parseInt(tab_index) == 0){
            layer.msg('{% trans "Not allowed in view codes" %}!', {
                offset: 't',
            });
            return false;
        }
        var param = getConnections();
        // 增加保存的基本条件，如果没有完整的一个条流程，无法保存。
        start_text = param["startID"] + "text";
        start_confirm_text = param[start_text]
        var end_text = ""
        for (var key in param) {
            if (param[key] == "End"){
                end_text = "End"
            }
        }
        if (start_confirm_text != "Start" || end_text != "End"){
            layer.msg(gettext("Saving with errors! You have not created a complete process."), {
                time: 3000,
                icon: 5,
            });
            return
        }
        var private_folder = '',public_folder = '';
        {% if 'Draw_Process.views_menu_file_save_private' in perms %}
        private_folder = 'yes';
        {% endif %}
        {% if 'Draw_Process.views_menu_file_save_public' in perms %}
        public_folder = 'yes';
        {% endif %}
        if (status == 'saveAs'){
            var btnClass = $("#saveAsBtn").attr('class');
            if (btnClass.indexOf("menu-item-disabled") != -1){
                return false;
            }
            if (private_folder == '' && public_folder == ''){
                layer.msg('{% trans "You do not have the authorization" %}!')
            }else if(private_folder == 'yes' && public_folder == ''){
                saveProcess('private');
            }else if(private_folder == '' && public_folder == 'yes'){
                saveProcess('public');
            }else{
                layer.msg('{% trans "Please choose folder to save" %}', {
                    time: 20000, //20s后自动关闭
                    btn: ['{% trans "Cancel" %}', '{% trans "Public" %}', '{% trans "Private" %}'],
                    btn2: function(index, layero) {
                        saveProcess('public');
                    },
                    btn3: function(index, layero) {
                        saveProcess('private');
                    },
                });
            }
        }else{
            var select_file = $("#selectfile" + tab_index.toString()).val();
            if (select_file.substring(0, 7) == "release"){
                layer.msg('{% trans "Release file can not be saved directly" %}!')
                return false;
            }
            if (select_file == "" || select_file == null || typeof(select_file) == "undefined"){
                if (private_folder == '' && public_folder == ''){
                    layer.msg('{% trans "You do not have the authorization" %}!')
                }else if(private_folder == 'yes' && public_folder == ''){
                    saveProcess('private');
                }else if(private_folder == '' && public_folder == 'yes'){
                    saveProcess('public');
                }else{
                    layer.msg('{% trans "Please choose folder to save" %}', {
                        time: 20000, //20s后自动关闭
                        btn: ['{% trans "Cancel" %}', '{% trans "Public" %}', '{% trans "Private" %}'],
                        btn2: function(index, layero) {
                            saveProcess('public');
                        },
                        btn3: function(index, layero) {
                            saveProcess('private');
                        },
                    });
                }
            }else{
                param.name = $("#selectfile" + tab_index.toString()).val();
                param.type = "file";
                $.ajax({
                    type: 'POST',
                    url: '../filejudge/',
                    dataType: 'json',
                    data: param,
                    success: function(data) {
                        var result = data['result'];
                        if (result == true) {
                            var message = data['msg'];
                            if (message == "success") {
                                layer.confirm('{% trans "Are you sure to overwrite" %}?', {
                                    title: '{% trans "Overwrite Confirmation" %}',
                                    btn: ['{% trans "Yes" %}', '{% trans "No" %}']
                                },
                                function(index) {
                                    layer.close(index);
                                    var tab_index = getActiveTab();
                                    var list = new Array;
                                    var connections = getConnections();
                                    var childs = $('#process-area'+ tab_index.toString()).find('.jnode-box');
                                    for (var i = 0; i < childs.length; i++) {
                                        var json = {};
                                        var child = childs[i];
                                        json.id = child.parentElement.id;
                                        try {
                                            json.jnodeClass = child.className.replace("jnode-box ", "");
                                        } catch(err) {
                                            continue;
                                        }
                                        if (json.jnodeClass.indexOf("bdc-success") != -1) {
                                            json.jnode = "start"
                                        } else if (json.jnodeClass.indexOf("bdc-danger") != -1 || json.jnodeClass.indexOf("bdc-wait") != -1) {
                                            json.jnode = "end"
                                        } else if (json.jnodeClass.indexOf("bdc-warning") != -1) {
                                            json.jnode = "judge"
                                        } else {
                                            json.jnode = "task"
                                        }
                                        json.jnodeHtml = child.innerHTML;
                                        json.left = child.parentElement.offsetLeft;
                                        json.top = child.parentElement.offsetTop;
                                        json_2_str = JSON.stringify(json);
                                        list.push(json_2_str);
                                    }
                                    connections.name = $("#selectfile"+tab_index.toString()).val();
                                    connections.html = list;
                                    $.ajax({
                                        type: 'POST',
                                        url: '../saveprocess/',
                                        dataType: 'json',
                                        data: connections,
                                        beforeSend: function() {
                                            layer.load(2);
                                        },
                                        success: function(data) {
                                            layer.closeAll('loading');
                                            var result = data['result'];
                                            var used_list = data['used_list'];
                                            if (result == "success") {
                                                if (used_list.length == 0) {
                                                    layer.msg('{% trans "Saved successfully" %}!', {
                                                        time: 3000,
                                                        icon: 6,
                                                    });
                                                } else {
                                                    var content = '<div style="padding: 50px; line-height: 22px; background-color: #393D49; color: #fff; font-weight: 300;">{% trans "Save successfully, this process is used in below process" %}!<br><br>'
                                                    for (var j = 0; j < used_list.length; j++) {
                                                        content = content + used_list[j] + '<br>';
                                                    }
                                                    content = content + '</div>';
                                                    layer.open({
                                                        type: 1,
                                                        title: false,
                                                        closeBtn: false,
                                                        area: '400px;',
                                                        shade: 0.8,
                                                        id: 'Releated Process',
                                                        btn: ['Get it'],
                                                        btnAlign: 'c',
                                                        moveType: 1 //拖拽模式，0或者1
                                                        ,
                                                        content: content
                                                    })
                                                }
                                            } else {
                                                layer.msg('{% trans "Saved successfully,but some error with your process" %}!', {
                                                    time: 3000,
                                                    icon: 5,
                                                });
                                                var conso = data['error'];
                                                $('#control_area').html(conso);
                                                $('#cc').layout('expand', 'south');
                                            }
                                        },
                                    });
                                })
                            } else {
                                layer.msg(gettext(message), {
                                    time: 3000,
                                    icon: 5,
                                });
                            }
                        }
                    }
                })
            }
        }
    }
   var quitbyself = false;
    window.onbeforeunload=function(){
        quitbyself = true;
        c_args = JSON.stringify({"action":"quit"});
        ws.onopen();
    }

    window.onload = function(e) {
        quitbyself = false;
        e = e || window.event;
        var start_drag = "";
        $('#tt').tabs("select", "{% trans 'Flow' %}");
        // startX, startY 为鼠标点击时初始坐标
        // diffX, diffY 为鼠标初始坐标与 box 左上角坐标之差，用于拖动
        var startX, startY, diffX, diffY, copyX, copyY;
        // 是否拖动，初始为 false
        var dragging = false;
        // 鼠标按下
        document.ondblclick = function(e) {
            startX = e.pageX;
            startY = e.pageY;
            var tab_index = getActiveTab();
            var areaId = "#diagramContainer-main" + tab_index;
            var adj_top = $(areaId).offset().top;
            var adj_left = $(areaId).offset().left;
            if(e.target.id.match(/diagramContainer-main/)) {
                var active_box = document.createElement("div");
                active_box.id = "active_box";
                active_box.className = "box";
                startX = parseFloat(startX + $(areaId).scrollLeft() - adj_left);
                startY = parseFloat(startY + $(areaId).scrollTop() - adj_top);
                active_box.style.top = startY + 'px';
                active_box.style.left = startX + 'px';
                var tab_index = getActiveTab();
                $("#diagramContainer-main"+tab_index).append(active_box);
                active_box = null;
            }
        }
        document.onclick = function(e) {
            if(e.target.tagName.match(/SPAN/)) {
                if (e.target.parentElement.className.indexOf("jnode-box") != -1){
                    var background = e.target.parentElement.style.backgroundColor;
                    if (background == "rgb(95, 184, 120)"){
                        var id = e.target.parentElement.parentElement.id;
                        var org_color = div_json[id];
                        var div = $("#"+id);
                        $(div).children(":first").css({"background-color":org_color});
                        delete div_json[id];
                        var index = div_selection_list.indexOf(id);
                        div_selection_list.splice(index, 1)
                    }else if(div_json.hasOwnProperty(id)){
                        delete div_json[id];
                        var index = div_selection_list.indexOf(id);
                        div_selection_list.splice(index, 1)
                    }
                }
            }else if(e.target.tagName.match(/DIV/)){
                if (e.target.className.indexOf("jnode-box") != -1){
                    var background = e.target.style.backgroundColor;
                    if (background == "rgb(95, 184, 120)"){
                        var id = e.target.parentElement.id;
                        var org_color = div_json[id];
                        var div = $("#"+id);
                        $(div).children(":first").css({"background-color":org_color});
                        delete div_json[id];
                        var index = div_selection_list.indexOf(id);
                        div_selection_list.splice(index, 1)
                    }
                }
            }
        }
        document.onmousedown = function(e) {
            if(document.getElementById("active_box") !== null) {
                start_drag = "";
                var ab = document.getElementById("active_box");
                var tab_index = getActiveTab();
                var areaId = "#diagramContainer-main" + tab_index;
                var exist_select_isture = -1
                for (var i=0;i<div_selection_list.length;i++) {
                    var val = div_selection_list[i];
                    var areaId_Inner = "#diagramContainer-main" + tab_index;
                    var div_length = $(areaId_Inner + " div[id='" + val + "']").length;
                    if (div_length > 0){
                        exist_select_isture = -1
                    }else{
                        exist_select_isture = 0
                        break;
                    }
                }
                var control = document.getElementById("diagramContainer-main" + tab_index);
                var abx1 = ab.offsetLeft;
                var aby1 = ab.offsetTop;
                var abx2 = abx1 + ab.offsetWidth;
                var aby2 = aby1 + ab.offsetHeight;
                ab.removeAttribute("id");
                ab.parentNode.removeChild(ab);
                var divs = $('#process-area'+ tab_index.toString()).find('.jnode-box');
                for (var i=0;i<divs.length;i++){
                    var div = divs[i].parentElement;
                    if ($.inArray(div.id,div_selection_list) == -1){
                        var innerText = div.firstElementChild.firstElementChild.id || div.innerText;
                        if (innerText != "Start" && innerText != "End"){
                            var divx1 = div.offsetLeft;
                            var divy1 = div.offsetTop;
                            var divx2 = divx1 + div.offsetWidth;
                            var divy2 = divy1 + div.offsetHeight;
                            if (exist_select_isture == -1){
                                if(abx1 < divx1 && abx2 > divx1){
                                    if(aby1 < divy1 && aby2 > divy1){
                                        var background = $(div).children(":first").css("background-color");
                                        var className = div.firstElementChild.className;
                                        if (className.indexOf("bdc-process") == -1 && className.indexOf("bdc-group") == -1){
                                            div_selection_list.push(div.id);
                                            var jnodeHtml = div.firstElementChild.innerHTML;
                                            div_json[div.id] = background;
                                            div_json[div.id + "className"] = className;
                                            div_json[div.id + "jnodeHtml"] = jnodeHtml;
                                            div.children[0].style.background = "#5FB878";
                                        }
                                    }else if(aby1 < divy2 && aby2 > divy2){
                                        var background = $(div).children(":first").css("background-color");
                                        var className = div.firstElementChild.className;
                                        if (className.indexOf("bdc-process") == -1 && className.indexOf("bdc-group") == -1){
                                            div_selection_list.push(div.id);
                                            var jnodeHtml = div.firstElementChild.innerHTML;
                                            div_json[div.id] = background;
                                            div_json[div.id + "className"] = className;
                                            div_json[div.id + "jnodeHtml"] = jnodeHtml;
                                            div.children[0].style.background = "#5FB878";
                                        }
                                    }
                                }else if(abx1 < divx2 && abx2 > divx2){
                                    if(aby1 < divy1 && aby2 > divy1){
                                        var background = $(div).children(":first").css("background-color");
                                        var className = div.firstElementChild.className;
                                        if (className.indexOf("bdc-process") == -1 && className.indexOf("bdc-group") == -1){
                                            div_selection_list.push(div.id);
                                            var jnodeHtml = div.firstElementChild.innerHTML;
                                            div_json[div.id] = background;
                                            div_json[div.id + "className"] = className;
                                            div_json[div.id + "jnodeHtml"] = jnodeHtml;
                                            div.children[0].style.background = "#5FB878";
                                        }
                                    }else if(aby1 < divy2 && aby2 > divy2){
                                        var background = $(div).children(":first").css("background-color");
                                        var className = div.firstElementChild.className;
                                        if (className.indexOf("bdc-process") == -1 && className.indexOf("bdc-group") == -1){
                                            div_selection_list.push(div.id);
                                            var jnodeHtml = div.firstElementChild.innerHTML;
                                            div_json[div.id] = background;
                                            div_json[div.id + "className"] = className;
                                            div_json[div.id + "jnodeHtml"] = jnodeHtml;
                                            div.children[0].style.background = "#5FB878";
                                        }
                                    }
                                }
                             }else{
                                layer.msg(gettext("Select by double click with errors! You can not select modules across tabs,Please return to the last tab page."), {
                                time: 3000,
                                icon: 5,
                                });
                                return
                             }
                        }
                    }
                }
            }else{
                if(e.target.tagName.match(/SPAN/)) {
                    if (e.target.parentElement.className.indexOf("jnode-box") != -1){
                        var select_json_2_str = JSON.stringify(div_selection_list);
                        if (select_json_2_str.indexOf(e.target.parentElement.parentElement.id) != -1 && div_selection_list.length > 0){
                           start_drag = "yes";
                           moveId = e.target.parentElement.parentElement.id;
                           var move_div = document.getElementById(moveId);
                           moveX = parseInt(move_div.style.left.replace("px",""));
                           moveY = parseInt(move_div.style.top.replace("px",""));
                        }else{
                           start_drag = "";
                        }
                    }
                }else if(e.target.tagName.match(/DIV/)){
                    if (e.target.className.indexOf("jnode-box") != -1){
                        var select_json_2_str = JSON.stringify(div_selection_list);
                        if (select_json_2_str.indexOf(e.target.parentElement.id) != -1 && div_selection_list.length > 0){
                           start_drag = "yes";
                           moveId = e.target.parentElement.id;
                           var move_div = document.getElementById(moveId);
                           moveX = parseInt(move_div.style.left.replace("px",""));
                           moveY = parseInt(move_div.style.top.replace("px",""));
                        }else{
                           start_drag = "";
                        }
                    }
                }else{
                    start_drag = "";
                }
            }
        };
<!--        // 记录上一次鼠标移动的位置-->
<!--        var last_mouse_move_flag=[0,0];-->
        // 鼠标移动
        document.onmousemove = function(e) {
            try{
                var tab_index = getActiveTab();
                var areaId = "#diagramContainer-main" + tab_index;
                var adj_top = $(areaId).offset().top;
                var adj_left = $(areaId).offset().left;
                copyX = parseInt(e.pageX + $(areaId).scrollLeft() - adj_left);
                copyY = parseInt(e.pageY + $(areaId).scrollTop() - adj_top);
                if(document.getElementById("active_box") !== null) {
                    var ab = document.getElementById("active_box");
                    if (copyX > startX){
                        ab.style.width = copyX - startX + 'px';
                    }else{
                        ab.style.left = copyX + 'px';
                        ab.style.width = startX - copyX + 'px';
                    }
                    if (copyY > startY){
                        ab.style.height = copyY - startY + 'px';
                    }else{
                        ab.style.top = copyY + 'px';
                        ab.style.height = startY - copyY + 'px';
                    }
                }else{
                    if (start_drag == "yes"){
                        var select_json_2_str = JSON.stringify(div_selection_list);
                        var move_div = document.getElementById(moveId);
                        try{
                            var newX = parseInt(move_div.style.left.replace("px",""));
                            var newY = parseInt(move_div.style.top.replace("px",""));
                            if (newX == moveX && newY == moveY){
                                start_drag == "";
                            }else{
                                // 拖动太快不给操作
<!--                                if (Math.abs(last_mouse_move_flag[0] - e.clientX) > 20 || Math.abs(last_mouse_move_flag[1] - e.clientY) > 20) {-->
<!--                                    return false-->
<!--                                }-->
                                // 计算最上方的位置, 移动顶部检查
                                // 计算最左方的位置, 移动左边检查
                                var max_top = 0
                                var max_left = 0
                                for (var i=1;i<div_selection_list.length;i++) {
                                    var elId_next = div_selection_list[i];
                                    var top_next = parseInt($('#' + elId_next).css('top').replace("px",""));
                                    var left_next = parseInt($('#' + elId_next).css('left').replace("px",""));
                                    // 计算top
                                    if (max_top == 0){
                                        var elId = div_selection_list[i-1];
                                        var top = parseInt($('#' + elId).css('top').replace("px",""));
                                        if (top_next < top) {
                                            max_top = top_next
                                        } else {
                                            max_top = top
                                        }
                                    } else {
                                        if (top_next < max_top) {
                                            max_top = top_next
                                        }
                                    }
                                    // 计算left
                                    if (max_left == 0){
                                        var elId = div_selection_list[i-1];
                                        var left = parseInt($('#' + elId).css('left').replace("px",""));
                                        if (left_next < left) {
                                            max_left = left_next
                                        } else {
                                            max_left = left
                                        }
                                    } else {
                                        if (left_next < max_left) {
                                            max_left = left_next
                                        }
                                    }
                                }
                                // 不给拖出顶部和左边区域
                                if ((max_top < 10 && newY < moveY) || (max_left < 10 && newX < moveX)) {
                                    return false;
                                }
                                for (var i=0;i<div_selection_list.length;i++){
                                    var div_id = div_selection_list[i];
                                    if (div_id != moveId){
                                        var div = document.getElementById(div_id);
                                        try{
                                            div.style.left = (parseInt(div.style.left.replace("px","")) + parseInt(move_div.style.left.replace("px","")) - moveX).toString() + "px";
                                            div.style.top = (parseInt(div.style.top.replace("px","")) + parseInt(move_div.style.top.replace("px","")) - moveY).toString() + "px";
                                        }catch{
                                            continue;
                                        }
                                    }
                                }
                                moveX = parseInt(move_div.style.left.replace("px",""));
                                moveY = parseInt(move_div.style.top.replace("px",""));
                                $("#repaintAll").val("no");
                                if (div_selection_list.length > 1){
                                    jsPlumb.repaintEverything();
                                }
                            }
                        }catch{
                            return false;
                        }
                    }
                }
            }catch{
                return false;
            }
<!--            last_mouse_move_flag[0] = e.clientX-->
<!--            last_mouse_move_flag[1] = e.clientY-->
        };
        // 鼠标抬起
        document.onmouseup = function(e) {
            // 禁止拖动
            dragging = false;
            $("#repaintAll").val("yes");
            start_drag = "";
            if(document.getElementById("active_box") !== null) {
                var ab = document.getElementById("active_box");
                ab.removeAttribute("id");
                ab.parentNode.removeChild(ab);
            }
        };
        $(document).unbind('keydown').bind('keydown', function(e){
            if(e.keyCode  == 46){
                var divs_adj_list = new Array;
                var delete_div_list = new Array;
                var tab_index = getActiveTab();
                for (var i=0;i<div_selection_list.length;i++) {
                    var val = div_selection_list[i];
                    var areaId = "#diagramContainer-main" + tab_index;
                    var div_length = $(areaId + " div[id='" + val + "']").length;
                    if (div_length > 0){
                        jsPlumb.removeAllEndpoints(val);
                        var div = $("#"+val);
                        div.remove();
                        delete div_json[val];
                        delete_div_list.push(val);
                    }else{
                        divs_adj_list = divs_adj_list[i];
                    }
                }
                div_selection_list = divs_adj_list;
                if (tab_index == ''){tab_index = 0};
                $.ajax({
                    type:'POST',
                    url:'../batchdelete/',
                    dataType:'json',
                    data:{"delete_list":JSON.stringify(delete_div_list),"tab":tab_index},
                    success:function(data){
                        var result = data['result'];
                        if (result != "success"){
                            layer.msg("{% trans "Batch delete failed" %}!", {
                                time: 3000,
                            });
                            var conso = data['msg'];
                            $('#control_area').html(conso);
                            $('#cc').layout('expand', 'south');
                        }
                    }
                })
		    }else if(e.ctrlKey && e.keyCode  == 86) {
		        var copy_mode = $("#copy_mode").val();
		        if (copy_mode == "" || copy_mode == null || typeof(copy_mode) == "undefined"){
		            copy_mode = "no"
		        }
                var select_json = JSON.stringify(div_json);
                if (select_json != "{}" && select_json != "" && typeof(select_json) != "undefined"){
                    var copy_list = new Array;
                    var div_top = 60;
                    var n = 0;
                    var offsetLeft = 0,offsetTop = 0;
                    <!--var new_div_selection_list = [];-->
                    <!--var new_div_json = {};-->
                    for(var i=0;i<div_selection_list.length;i++){
                        var div_id = div_selection_list[i];
                        if(document.getElementById(div_id)){
                            var left = document.getElementById(div_id).offsetLeft || parseInt(document.getElementById(div_id).style.left.replace("px",""));
                            var top = document.getElementById(div_id).offsetTop || parseInt(document.getElementById(div_id).style.top.replace("px",""));
                            if (left < offsetLeft || offsetLeft == 0){
                                offsetLeft = left;
                            }
                            if(top < offsetTop || offsetTop == 0){
                                offsetTop = top;
                            }
                        }
                    }
                    var id_json = {};
                    for(var i=0;i<div_selection_list.length;i++){
                        copy_json = {};
                        var div_id = div_selection_list[i];
                        var tab_index = getActiveTab();
                        if(document.getElementById(div_id)){
                            // 这里还原颜色
                            $("#"+div_id).children(":first").css({"background-color":div_json[div_id]});
<!--                            $("#"+div_id).children(":first").css({"background-color":""});                            -->
                        }
                        var className = div_json[div_id+"className"];
                        var jnode_html = div_json[div_id+"jnodeHtml"];
                        var jnode = "";
                        if (className.indexOf("bdc-success") != -1){
                            jnode = "start";
                        }else if(className.indexOf("bdc-primary") != -1){
                            jnode = "task";
                        }else if(className.indexOf("bdc-warning") != -1){
                            jnode = "judge";
                        }else if(className.indexOf("bdc-danger") != -1){
                            jnode = "end";
                        }else if(className.indexOf("bdc-wait") != -1){
                            jnode = "wait";
                        }else if(className.indexOf("bdc-process") != -1){
                            jnode = "task";
                        }
                        var dataObj = {};
                        dataObj.id = uuid.v1();
                        <!--new_div_selection_list.push(dataObj.id);-->
                        id_json[div_id] = dataObj.id;
                        dataObj.jnode = jnode;
                        dataObj.jnodeClass = className;
                        dataObj.jnodeHtml = jnode_html;
                        var background = $("#"+div_id).children(":first").css("background-color");
                        <!--new_div_json[dataObj.id] = background;-->
                        <!--new_div_json[dataObj.id + "className"] = className;-->
                        <!--new_div_json[dataObj.id + "jnodeHtml"] = jnode_html;-->
                        var org_left = document.getElementById(div_id).offsetLeft || parseInt(document.getElementById(div_id).style.left.replace("px",""));
                        var org_top = document.getElementById(div_id).offsetTop || parseInt(document.getElementById(div_id).style.top.replace("px",""));
                        dataObj.left = Math.max(parseFloat(copyX) + org_left - offsetLeft,0);
                        dataObj.top = Math.max(parseFloat(copyY) + org_top - offsetTop,0);
                        var targetHtml = Mustache.render($("#jnode-template").html(), dataObj);
                        $("#diagramContainer-main" + tab_index).append(targetHtml);
                        jsPlumb.draggable(dataObj.id, {containment: 'parent'});
                        <!--$("#" + dataObj.id).find(".jnode-box").eq(0).css("background-color", "#5FB878");-->
                        visioConfig.baseArchors.forEach(function (key) {
                            jsPlumb.addEndpoint(
                                dataObj.id,
                                {
                                    anchors: key,
                                    connectorOverlays: [
                                        ["Arrow", {width: 10, length: 10, location: 1, id: "arrow",visible: "false"}],
                                        ["Label", {id: "myLabel", cssClass: "connectorLabel flow-span",visible: "false", events:{
                                            "click":function (label, evt) {
                                            console.log("clicked on label for connection",label.component);
                                            }
                                        }}]
                                    ]
                                },
                                visioConfig.hollowCircle);
                            });
                        $("#"+dataObj.id).on("mouseenter", ".jnode-box", function () {
                            var left = 10,top = 18,right = 10,top=33;
                            var backgroundColor = $(this).css("background-color");
                            var className = this.className || "";
                            if (backgroundColor == "rgb(146, 208, 80)" && className.indexOf("jnode-judge") == -1){
                                var divWidth = $(this).width()/2 - 3;
                                $(this).append('<i class="fa fa-trash-o" style="position:absolute;color:#fff;left:'+left+'px;top:'+top+'px;z-index:12;"/>');
                                $(this).append('<i class="fa fa-cog" style="position:absolute;color:#fff;right:'+right+'px;top:'+top+'px;z-index:12;"/>');
                                $(this).append('<i class="icon-refresh" style="position:absolute;color:#fff;left:'+divWidth+'px;top:'+4+'px;z-index:12;"/>');
                            }else if(backgroundColor == "rgb(128, 128, 128)" && className.indexOf("jnode-judge") == -1){
                                $(this).append('<i class="fa fa-trash-o" style="position:absolute;color:#fff;left:'+left+'px;top:'+top+'px;z-index:12;"/>');
                                $(this).append('<i class="fa fa-cogs" style="position:absolute;color:#fff;right:'+right+'px;top:'+top+'px;z-index:12;"/>');
                            }else{
                                $(this).append('<i class="fa fa-trash-o" style="position:absolute;color:#fff;left:'+left+'px;top:'+top+'px;z-index:12;"/>');
                                $(this).append('<i class="fa fa-cog" style="position:absolute;color:#fff;right:'+right+'px;top:'+top+'px;z-index:12;"/>');
                            }
                        }).on("mouseleave", ".jnode-box", function () {
                            $(".fa-trash-o").remove();
                            $(".fa-cog").remove();
                            $(".fa-cogs").remove();
                            $(".icon-refresh").remove();
                        }).on("mousedown", ".jnode-box", function () {
                            var div = $(this);
                            var text = div[0].children[0].innerText;
                            var new_text = text.replace(/ /g,"-");
                            $(this)[0].children[0].innerText = new_text;
                        }).on("mouseup", ".jnode-box", function () {
                            var div = $(this);
                            var text = div[0].children[0].innerText;
                            var new_text = text.replace(/-/g," ");
                            $(this)[0].children[0].innerText = new_text;
                        }).on("click", ".fa-trash-o", function () {
                            var id = $(this).parent()[0].parentElement.id;
				            deleteDiv(id);
                        }).on("click", ".fa-cog", function () {
                            var parent_div = $(this).parent()[0];
                            var id = parent_div.parentElement.id;
                            setting(id);
                        }).on("click", ".fa-cogs", function () {
                            var parent_div = $(this).parent()[0];
                            var id = parent_div.parentElement.id;
                            ungroup(id);
                        }).on("click", ".icon-refresh", function () {
                            var id = $(this).parent()[0].parentElement.id;
				            showInsertProcess(id);
                        }).on("dblclick", ".jnode-box",function(){
                            var id = $(this).parent()[0].id;
				            dblClickDiv(id);
                        });
                        n = n + 1;
                        copy_json[dataObj.id] = div_id;
                        copy_list.push(JSON.stringify(copy_json));
                        var color =  $("#"+div_id).find(".jnode-box").eq(0).css("border-color");
                        if (color == "rgb(213, 133, 18)"){
                            $("#" + dataObj.id).find(".jnode-box").eq(0).css("border", "3px solid #d58512");
                            name_json[dataObj.id] = name_json[div_id];
                            }else if (color == "rgb(172, 41, 37)"){
                                $("#" + dataObj.id).find(".jnode-box").eq(0).css("border", "3px solid #d58512");
                                name_json[dataObj.id] = name_json[div_id];
                            }
                        }
                    for(var i=0;i<div_selection_list.length;i++){
                        var div_id = div_selection_list[i];
                        var option1 = {};
                        var sourceId = "";
                        option1.source = div_id;
                        var con1 = jsPlumb.getConnections(option1,"");
                        if (con1.length > 0){
                            targetId = con1[0].targetId;
                            var newTargetId = id_json[targetId];
                            if (div_selection_list.indexOf(targetId) != -1){
                                var newSourceId = id_json[div_id];
                                addConnection(newSourceId,newTargetId,con1[0].endpoints[0].anchor.type,con1[0].endpoints[1].anchor.type,"",false);
                            }
                        }
                    }
                    div_json = {};
                    div_selection_list = [];
                }
                var tab = getActiveTab();if(tab == ''){tab = 0};
                $.ajax({
                    type:'POST',
                    url:'../creatediv/',
                    dataType:'json',
                    data:{"copy_list":JSON.stringify(copy_list),"copy_mode":copy_mode,"tab":tab},
                    success:function(data){
                        var result = data['result'];
                        if (result != "success"){
                            layer.msg("{% trans "Create variant failed" %}!", {
                                time: 3000,
                            });
                        }
                    }
                })
<!--                div_json = {};-->
<!--                div_selection_list = [];-->
<!--                $("#copy_mode").val("");-->
<!--                取消ctrlC-->
<!--		    }else if(e.ctrlKey && e.keyCode  == 67) {-->
<!--		        $("#copy_mode").val("yes");-->
<!--		        var select_json = JSON.stringify(div_json);-->
<!--                if (select_json != "{}" && select_json != "" && typeof(select_json) != "undefined"){-->
<!--                    var copy_list = new Array;-->
<!--                    var div_top = 60;-->
<!--                    var n = 0;-->
<!--                    var tab_index = getActiveTab();-->
<!--                    var areaId = "#diagramContainer-main" + tab_index;-->
<!--                    for(var i=0;i<div_selection_list.length;i++){-->
<!--                        copy_list.push(div_selection_list[i]);-->
<!--                    }-->
<!--                    $.ajax({-->
<!--                        type:'POST',-->
<!--                        url:'../savediv/',-->
<!--                        dataType:'json',-->
<!--                        data:{"copy_list":JSON.stringify(copy_list)},-->
<!--                        success:function(data){-->
<!--                            var result = data['result'];-->
<!--                            if (result != "success"){-->
<!--                                layer.msg("{% trans "Save steps failed" %}!", {-->
<!--                                    time: 3000,-->
<!--                                });-->
<!--                            }else{-->
<!--                                layer.msg("{% trans "Save steps successfully" %}!", {-->
<!--                                    time: 2000,-->
<!--                                });-->
<!--                            }-->
<!--                        }-->
<!--                    })-->
<!--                }else{-->
<!--                    $("#copy_mode").val("");-->
<!--                }-->
		    }else if(e.altKey && e.keyCode  == 83) {
                quickSaving('save');
		    }
		})
    };

    function adjScr(cur_size){
        var tab_index = getActiveTab();
        if (parseInt(tab_index) == 0){
            layer.msg('{% trans "Not allowed in view codes" %}!', {
                offset: 't',
            });
            return false;
        }
        var org_size = parseInt($('#screen_size' + tab_index.toString()).val());
        if (cur_size != org_size){
            $('#screen_size' + tab_index.toString()).val(cur_size);
            $('#slider_input' + tab_index.toString()).text(cur_size+'%');
            var message = 'Screen Size: ' + cur_size.toString() + "%";
            layer.msg(gettext(message), {
                offset: 't',
            });
            adjScreen(org_size,cur_size);
            var slider = layui.slider;
            var ins3 = slider.render({
                elem: '#slide' + tab_index.toString(),
                step: 10,
                showstep: true,
                value: cur_size,
                min: 70,
                max: 120,
                tips: false,
                change: function(vals) {
                    var tab_index = getActiveTab();
                    var org_size = parseInt($('#screen_size' + tab_index.toString()).val());
                    if (vals != org_size) {
                        $('#screen_size' + tab_index.toString()).val(vals);
                        $('#slider_input' + tab_index.toString()).text(vals + '%');
                        var message = 'Screen Size: ' + vals.toString() + "%";
                        layer.msg(gettext(message), {
                            offset: 't',
                        });
                        adjScreen(org_size, vals);
                    }
                }
            })
        }
    }

    function adjScreen(org_size,cur_size){
        var tab_index = getActiveTab();
        var fontSize,lineHeight,iconLeft,iconTop,iconRight;
        if (cur_size == 70){
            fontSize = 7;
            lineHeight = 30;
            iconLeft = 4;
            iconTop = 23;
            iconRight = 4;
        }else if(cur_size == 80){
            fontSize = 8;
            lineHeight = 35;
            iconLeft = 7;
            iconTop = 26.5;
            iconRight = 7;
        }else if(cur_size == 90){
            fontSize = 9;
            lineHeight = 40;
            iconLeft = 9;
            iconTop = 30;
            iconRight = 9;
        }else if(cur_size == 100){
            fontSize = 10;
            lineHeight = 45;
            iconLeft = 10;
            iconTop = 33;
            iconRight = 10;
        }else if(cur_size == 110){
            fontSize = 11;
            lineHeight = 50;
            iconLeft = 11;
            iconTop = 36.5;
            iconRight = 11;
        }else if(cur_size == 120){
            fontSize = 12
            lineHeight = 55;
            iconLeft = 12;
            iconTop = 39;
            iconRight = 12;
        }
        $("#line_height" + tab_index.toString()).val(lineHeight);
        $("#font_size" + tab_index.toString()).val(fontSize);
        $("#icon_left" + tab_index.toString()).val(iconLeft);
        $("#icon_right" + tab_index.toString()).val(iconRight);
        $("#icon_top" + tab_index.toString()).val(iconTop);
        $("#screen_adjust").val("yes");
        var connections = jsPlumb.getAllConnections();
        var divs = $('#process-area'+ tab_index.toString()).find('.jnode-box');
        var div_list = new Array;
        repaint_list = new Array;
        for (var i=0;i<divs.length;i++){
            var div = divs[i];
            var id = div.parentElement.id;
            div_list.push(id);
            repaint_list.push(id);
            var find_span = span_width_list.includes(id);
            if (find_span == false && org_size == 100){
                span_width_list.push(id);
                var className = div.className;
                if (className.indexOf('judge') != -1){
                    span_width_json[id] = div.offsetWidth;
                }else{
                    span_width_json[id] = parseFloat(div.getBoundingClientRect().width.toFixed(2)) + 0.01;
                }
            }
            if (cur_size == 100){
                div.style.width  = span_width_json[id] + 'px';
                div.style.height = '50px';
            }else{
                div.style.width  = div.offsetWidth / org_size * cur_size + 'px';
                div.style.height  = div.offsetHeight / org_size * cur_size + 'px';
            }
            div.style.fontSize = fontSize + 'pt';
            div.style.lineHeight = lineHeight + 'px';
            var timestamp = "" + (new Date()).getTime();
        }
        $("#repaint").val("yes");
        jsPlumb.repaintEverything();
        $("#repaint").val("no");
        for(var i in connections){
            try{
                var id1 = connections[i].sourceId;
                var result = div_list.includes(id1);
                if (result == true){
                    var id2 = connections[i].targetId;
                    var direction1 = connections[i].endpoints[0].anchor.type;
                    var direction2 = connections[i].endpoints[1].anchor.type;
                    var jp = connections[i];
                    var e = event || (event = window.event);
                    jp.fire('mouseout', jp, e);
                }
            }catch(err){
                try{
                    next;
                }catch(err){
                    console.log(err);
                }
            }
        }
        $("#screen_adjust").val("no");
    }
    function robot(type){
        ip = "{{ ip }}";
        $.ajax({
            type: 'POST',
            url: '../dorobot/',
            dataType: 'json',
            data: {'type':type,'ip':ip},
            beforeSend: function() {
                layer.load(2);
            },
            success:function(data){
                layer.closeAll('loading');
                var msg = data['msg'];
                if (msg.indexOf('failed') != -1){
                    layer.alert(msg, {
                        title: '{% trans "Info" %}',
                        skin: 'layui-layer-lan',
                        closeBtn: 1,
                        icon: 5,
                        offset: 'rb',
                        btn: false,
                    });
                }else if(msg.indexOf('successfully') != -1){
                    layer.alert(msg, {
                        title: '{% trans "Info" %}',
                        skin: 'layui-layer-lan',
                        closeBtn: 1,
                        icon: 6,
                        offset: 'rb',
                        btn: false,
                    });
                }else if(msg == 'Startup errors!'){
                    var error = data['error'];
                    $('#control_area').html(error);
                    $('#cc').layout('expand','south');
                    layer.alert(gettext(msg), {
                        title: '{% trans "Info" %}',
                        skin: 'layui-layer-lan',
                        closeBtn: 1,
                        icon: 5,
                        offset: 'rb',
                        btn: false,
                    });
                }else if(msg == "It's already the latest version!"){
                    layer.alert(gettext(msg), {
                        title: '{% trans "Info" %}',
                        skin: 'layui-layer-lan',
                        closeBtn: 1,
                        icon: 8,
                        offset: 'rb',
                        btn: false,
                    });
                }
            }
        })
    }

    function batchInf(mode){
        var content = '';
        if (mode == 'inf'){
            layer.open({
                type: 1,
                title: false,
                closeBtn: 0,
                area: ['310px','100px'],
                scrollbar: false,
                content: '<div class="layui-form-item" style="margin-top:5px;">'
                        +'<div class="layui-inline">'
                        +'<label class="layui-form-label">Message: </label>'
                        +'<div class="layui-input-inline">'
                        +'<input id="batch_message" name="batch_message" lay-verify="required|phone" autocomplete="off" class="layui-input">'
                        +'</div></div></div>',
                btn: ['save','cancel'],
                btn1: function(index, layero){
                    layer.close(index);
                    content = $("#batch_message").val();
                    if (content != null && content != '' && typeof(content) != 'undefined'){
                        batchUpgrade(mode,content);
                    }
                },
            })
        }
    }

    function batchUpgrade(mode,content){
        var boxWidth = $(top.window).width() - 100;
        var boxHeight = $(top.window).height() - 100;
        boxWidth = boxWidth < 350 ? 350:boxWidth;
        boxHeight = boxHeight < 250 ? 250:boxHeight;
        layer.open({
            type: 2,
            title: '{% trans "Choose batch upgrade users" %}',
            area: [boxWidth+'px', boxHeight+'px'],
            maxmin: true,
            content: '../batchupgrade/',
            btn: ['{% trans "Submit" %}', '{% trans "Cancel" %}'],
            btn1: function(index, layero) {
                var win = window[layero.find('iframe')[0]['name']];
                var selection = win.getSelection();
                var ip_list = new Array;
                for (var i=0;i<selection.length;i++){
                    ip_list.push(selection[i]['ip_address']);
                }
                $.ajax({
                    type: 'POST',
                    url: '../upgradepush/',
                    dataType: 'json',
                    data: {'ip_list':ip_list,'mode':mode,'content':content},
                    beforeSend: function() {
                        layer.load(2);
                    },
                    success:function(data){
                        layer.closeAll('loading');
                        var result = data['result'];
                        if (result == 'success'){
                            layer.msg('{% trans "Push message successful!" %}', {
                              offset: 't',
                            });
                        }
                    }
                })
            }
        });
    }

    function showInfo(message,step){
        var adj_msg = gettext(message);
        adj_msg = adj_msg.replace(/;/g,"<br>");
        adj_msg = adj_msg.replace(/；/g,"<br>");
        layer.tips('<div style="max-height:100px;overflow-x:hidden;overflow-y:auto;">'+adj_msg+'</div>',$("#settingPage #" + step ),{
<!--        layer.tips('<div style="max-height:100px;overflow-x:hidden;overflow-y:auto;">'+adj_msg+'</div>',"#"+step,{-->
            tips:[4, '#3c8dbc'],
            shadeClose: true,
            shade: 0.1,
            time: 20000
        });
    }

    function develop(){
        layer.msg('{% trans "in development..." %}');
    }

    function commander(){
        var index = layer.open({
            type: 2,
            title: "Commander",
            content: "../commanderpage/",
            area: ['320px', '195px'],
            maxmin: true,
        });
        layer.full(index);
    }

    function showMenu(menu){
        $("#"+menu).show();
    }

    function record(type){
        layer.open({
          type: 1,
          skin: 'layui-layer-lan',
          closeBtn: 0, //不显示关闭按钮
          id: 'record_window',
          title: false,
          anim: 2,
          area: ['260px', '50px'],
          shadeClose: true,
          offset: 'rt',
          content: '<form class="layui-form" action="" lay-filter="recorderForm"><button type="button" class="layui-btn layui-btn-sm" style="margin:10px;" onclick="startRecord('+"'"+type+"'"+')"><i class="icon-control-play"></i></button><button type="button" class="layui-btn layui-btn-danger layui-btn-sm" style="margin:10px 10px 10px 0px;" onclick="cancelRecord('+"'"+type+"'"+')"><i class="icon-control-pause"></i></button><input type="checkbox" id="recordAuto" title="'+gettext("Auto Draw") + '" lay-filter="autoConnect" checked><span id="record_clock">00:00:00</span></form>',
          success: function () {
            var form = layui.form;
            form.render("checkbox");
            $("#recordAuto").next().children("i").remove();
          },
          end: function (){
            clearInterval(record_timer);
            layer.closeAll('load');
          }
        });
    }

    function clock(){
        var new_date = new Date(); //新建一个日期对象，默认现在的时间
	    var difftime = (new_date - current_time)/1000; //计算时间差,并把毫秒转换成秒
   	    var hours = parseInt(difftime/3600);    // 小时 60*60 总小时数-过去的小时数=现在的小时数
   	    if(hours.toString().length < 2){hours = "0" + hours;}
   	    var minutes = parseInt(difftime%3600/60); // 分钟 -(day*24) 以60秒为一整份 取余 剩下秒数 秒数/60 就是分钟数
   	    if(minutes.toString().length < 2){minutes = "0" + minutes;}
   	    var seconds = parseInt(difftime%60);
   	    if(seconds.toString().length < 2){seconds = "0" + seconds;}
        $("#record_clock").text(hours + ":" + minutes + ":" + seconds);
    }

    function startRecord(type){
        layer.closeAll('load');
        current_time = new Date();
        record_timer = self.setInterval("clock()",1000);
        var auto = 1;
        if ($("#recordAuto").next()[0].className.indexOf("checked") == -1){
            auto = 0;
        }
        if (type == "sap"){
            if (ws == '') {
                try {
                    c_args = JSON.stringify({"action":"sap_record","record":1,"auto":auto});
                    createWs();
                } catch {
                    c_robot_warning();
                }
            } else {
                c_args = JSON.stringify({"action":"sap_record","record":1,"auto":auto});
                ws.onopen();
            }
        }else if (type == "chrome"){
            if (ws == '') {
                try {
                    c_args = JSON.stringify({"action":"chrome_record","record":1,"auto":auto});
                    createWs();
                } catch {
                    c_robot_warning();
                }
            } else {
                c_args = JSON.stringify({"action":"chrome_record","record":1,"auto":auto});
                ws.onopen();
            }
        }
    }

    function cancelRecord(type){
        var auto = 1;
        if ($("#recordAuto").next()[0].className.indexOf("checked") == -1){
            auto = 0;
        }
        layer.close(layer.index);
        if (type == "sap"){
            if (ws == '') {
                try {
                    c_args = JSON.stringify({"action":"sap_record","record":0,"auto":auto});
                    createWs();
                } catch {
                    c_robot_warning();
                }
            } else {
                c_args = JSON.stringify({"action":"sap_record","record":0,"auto":auto});
                layer.load(2);
                ws.onopen();
            }
        }else if (type == "chrome"){
            if (ws == '') {
                try {
                    c_args = JSON.stringify({"action":"chrome_record","record":0,"auto":auto});
                    createWs();
                } catch {
                    c_robot_warning();
                }
            } else {
                c_args = JSON.stringify({"action":"chrome_record","record":0,"auto":auto});
                layer.load(2);
                ws.onopen();
            }
        }
    }

    function doResize(){
        var ele = document.getElementById("settingPage");
        if (ele){
            var div = ele.parentElement;
            var width = document.body.clientWidth;
            var left = (parseInt(width) - 300) + 'px';
            div.style.left = left;
        }
    }

    function add_item(type){
        if (type == "sap"){
            var i = 1;
            var findElement = true;
            while (findElement == true){
                var elementName = "element_name" + i;
                var element = document.getElementById(elementName);
                if (element){
                    i = i + 1;
                }else{
                    findElement = false;
                }
            }
            var addHtml = "";
            var nameElement = document.getElementById("element_name").parentElement;
            var nameEle = document.createElement("div");
            nameEle.className = "property-div";
            nameEle.innerHTML = nameElement.innerHTML.replace(/element_name/g,"element_name"+i);
            var sapActiveElement = document.getElementById("sap_active").parentElement;
            var parentElement = sapActiveElement.parentNode;
            parentElement.insertBefore(nameEle, sapActiveElement);
            if (document.getElementById("send_content")){
                var contentElement = document.getElementById("send_content").parentElement;
                var contentEle = document.createElement("div");
                contentEle.className = "property-div";
                contentEle.innerHTML = contentElement.innerHTML.replace(/send_content/g,"send_content"+i);
                parentElement.insertBefore(contentEle, sapActiveElement);
            }
        }else if(type == "hci"){
            var i = 1;
            var findElement = true;
            while (findElement == true){
                var elementName = "description" + i;
                var element = document.getElementById(elementName);
                if (element){
                    i = i + 1;
                }else{
                    findElement = false;
                }
            }
            var addHtml = "";
            var nameElement = document.getElementById("description").parentElement;
            var nameEle = document.createElement("div");
            nameEle.className = "property-div";
            nameEle.innerHTML = nameElement.innerHTML.replace(/description/g,"description"+i);
            var reqElement = document.getElementById("required_field").parentElement;
            var reqEle = document.createElement("div");
            reqEle.className = "property-div";
            reqEle.innerHTML = reqElement.innerHTML.replace(/required_field/g,"required_field"+i);
            var pwdElement = document.getElementById("password_format").parentElement;
            var pwdEle = document.createElement("div");
            pwdEle.className = "property-div";
            pwdEle.innerHTML = pwdElement.innerHTML.replace(/password_format/g,"password_format"+i);
            var outputElement = document.getElementById("output").parentElement;
            var outputEle = document.createElement("div");
            outputEle.className = "property-div";
            outputEle.innerHTML = outputElement.innerHTML.replace(/output/g,"output"+i);
            var output;
            if (i == 1){
                output = $("#output").parent();
            }else{
                output = $("#output"+(i-1)).parent();
            }
            output.after(outputEle);
            output.after(pwdEle);
            output.after(reqEle);
            output.after(nameEle);
        }else if(type == "excel"){
            var i = 1;
            var findElement = true;
            while (findElement == true){
                if (document.getElementById("decimal_digits")){
                    var elementName = "selected_cell" + i;
                }else if(document.getElementById("order_method")){
                    var elementName = "sort_column" + i;
                }else{
                    var elementName = "selected_cells" + i;
                }
                var element = document.getElementById(elementName);
                if (element){
                    i = i + 1;
                }else{
                    findElement = false;
                }
            }
            var id1,id2,excel_mode;
            if (document.getElementById("decimal_digits")){
                id1 = "selected_cell";
                id2 = "decimal_digits";
                excel_mode = "read";
            }else if (document.getElementById("chart_series")){
                id1 = "chart_series";
                id2 = "selected_cells";
                excel_mode = "updatechartseriesdata";
            }else if (document.getElementById("sort_column")){
                id1 = "sort_column";
                id2 = "order_method";
                excel_mode = "sortcells";
            }else{
                id1 = "selected_cells";
                id2 = "content";
                excel_mode = "write";
            }
            var rangeElement = document.getElementById(id1).parentElement;
            var rangeEle = document.createElement("div");
            rangeEle.className = "property-div";
            if (excel_mode == "read"){
                rangeEle.innerHTML = rangeElement.innerHTML.replace(/selected_cell/g,id1+i);
            }else if(excel_mode == "updatechartseriesdata"){
                rangeEle.innerHTML = rangeElement.innerHTML.replace(/chart_series/g,id1+i);
            }else if(excel_mode == "sortcells"){
                rangeEle.innerHTML = rangeElement.innerHTML.replace(/sort_column/g,id1+i);
            }else{
                rangeEle.innerHTML = rangeElement.innerHTML.replace(/selected_cells/g,id1+i);
            }
            var contentElement = document.getElementById(id2).parentElement;
            var contentEle = document.createElement("div");
            contentEle.className = "property-div";
            if (excel_mode == "read"){
                contentEle.innerHTML = contentElement.innerHTML.replace(/decimal_digits/g,id2+i);
            }else if(excel_mode == "updatechartseriesdata"){
                contentEle.innerHTML = contentElement.innerHTML.replace(/selected_cells/g,id2+i);
            }else if(excel_mode == "sortcells"){
                contentEle.innerHTML = contentElement.innerHTML.replace(/order_method/g,id2+i);
            }else{
                contentEle.innerHTML = contentElement.innerHTML.replace(/content/g,id2+i);
            }
            $("#excel_active").parent().before(rangeEle);
            $("#excel_active").parent().before(contentEle);
            if (excel_mode == "read"){
                var outputElement = document.getElementById("output").parentElement;
                var outputEle = document.createElement("div");
                outputEle.className = "property-div";
                outputEle.innerHTML = outputElement.innerHTML.replace(/output/g,"output"+i);
                $("#excel_active").parent().before(outputEle);
            }
        }
    }

    function del_item(type){
        if (type == "sap"){
            var event = window.event || arguments[0];
            var obj = event.srcElement;
            var children = obj.parentElement.children;
            var inputObj = children[children.length - 1];
            var id = inputObj.id;
            if (id == "element_name"){
                layer.msg('{% trans "At least one element!" %}', {
                  offset: 't',
                });
                return false;
            }else{
                $("#"+id).parent().remove();
                if (document.getElementById("send_content")){
                    $("#"+id.replace("element_name","send_content")).parent().remove();
                }
            }
        }else if(type == "hci"){
            var event = window.event || arguments[0];
            var obj = event.srcElement;
            var children = obj.parentElement.children;
            var inputObj = children[children.length - 1];
            var id = inputObj.id;
            if (id == "description"){
                layer.msg('{% trans "At least one element!" %}', {
                  offset: 't',
                });
                return false;
            }else{
                $("#"+id).parent().remove();
                $("#"+id.replace("description","required_field")).parent().remove();
                $("#"+id.replace("description","password_format")).parent().remove();
                $("#"+id.replace("description","output")).parent().remove();
            }
        }else if(type == "excel"){
            var event = window.event || arguments[0];
            var obj = event.srcElement;
            var children = obj.parentElement.children;
            var inputObj = children[children.length - 1];
            var id = inputObj.id;
            var id1,id2;
            if (document.getElementById("decimal_digits")){
                id1 = "selected_cell";
                id2 = "decimal_digits";
            }else if (document.getElementById("chart_series")){
                id1 = "chart_series";
                id2 = "selected_cells";
            }else if (document.getElementById("order_method")){
                id1 = "sort_column";
                id2 = "order_method";
            }else{
                id1 = "selected_cells";
                id2 = "content";
            }
            if (id == id1){
                layer.msg('{% trans "At least one element!" %}', {
                  offset: 't',
                });
                return false;
            }else{
                $("#"+id).parent().remove();
                $("#"+id.replace(id1,id2)).parent().remove();
                $("#"+id.replace(id1,"output")).parent().remove();
            }
        }
    }

    function send_mail_verification(){
        var email_verification_type = $("#email_verification_type").val().replace(/\"/g,"");
        if (email_verification_type == "no-passwd"){
            document.getElementById("send_mail_password_display").style.display = "none";
            document.getElementById("send_smtp_server_display").style.display = "block";
            document.getElementById("send_server_port_display").style.display = "block";
            document.getElementById("send_ssl_display").style.display = "block";
        }else if(email_verification_type == "no-passwd-outlook"){
            document.getElementById("send_mail_password_display").style.display = "none";
            document.getElementById("send_smtp_server_display").style.display = "none";
            document.getElementById("send_server_port_display").style.display = "none";
            document.getElementById("send_ssl_display").style.display = "none";
        }else{
            document.getElementById("send_mail_password_display").style.display = "block";
            document.getElementById("send_smtp_server_display").style.display = "block";
            document.getElementById("send_server_port_display").style.display = "block";
            document.getElementById("send_ssl_display").style.display = "block";
        }
    }

    function read_mail_verification(){
        var email_verification_type = $("#email_verification_type").val().replace(/\"/g,"");
        if (email_verification_type == "no-passwd"){
            document.getElementById("read_mail_password_display").style.display = "none";
            document.getElementById("read_mail_pop3_display").style.display = "none";
            document.getElementById("read_mail_folder_display").style.display = "block";
            document.getElementById("read_mail_unreadstatus_display").style.display = "block";
        }else{
            document.getElementById("read_mail_password_display").style.display = "block";
            document.getElementById("read_mail_pop3_display").style.display = "block";
            document.getElementById("read_mail_folder_display").style.display = "none";
            document.getElementById("read_mail_unreadstatus_display").style.display = "none";
        }
    }

    function change_smtp(){
        var email_account = $("#email_account").val().replace(/\"/g,"");
        var ssl = $("#ssl_true").val().replace(/\"/g,"");
        if (email_account.indexOf("@163.com") != -1){
            $("#smtp_server").val('"smtp.163.com"');
            if (ssl == "true"){
                $("#server_port").val('"465"');
            }else{
                $("#server_port").val('"25"');
            }
        }else if(email_account.indexOf("@126.com") != -1){
            $("#smtp_server").val('"smtp.126.com"');
            if (ssl == "true"){
                $("#server_port").val('"465"');
            }else{
                $("#server_port").val('"25"');
            }
        }else if(email_account.indexOf("@qq.com") != -1){
            $("#smtp_server").val('"smtp.qq.com"');
            if (ssl == "true"){
                $("#server_port").val('"465"');
            }else{
                $("#server_port").val('"25"');
            }
        }else if(email_account.indexOf("@foxmail.com") != -1){
            $("#smtp_server").val('"smtp.foxmail.com"');
            $("#server_port").val('"25"');
        }else if(email_account.indexOf("@gmail.com") != -1){
            $("#smtp_server").val('"smtp.gmail.com"');
            if (ssl == "true"){
                $("#server_port").val('"465"');
            }else{
                $("#server_port").val('"25"');
            }
        }else if(email_account.indexOf("@sina.com") != -1){
            $("#smtp_server").val('"smtp.sina.com"');
            $("#server_port").val('"25"');
        }else if(email_account.indexOf("@sohu.com") != -1){
            $("#smtp_server").val('"sohu.sina.com"');
            $("#server_port").val('"25"');
        }else if(email_account.indexOf("@yahoo.com.cn") != -1){
            $("#smtp_server").val('"smtp.mail.yahoo.cn"');
            if (ssl == "true"){
                $("#server_port").val('"465"');
            }else{
                $("#server_port").val('"25"');
            }
        }else if(email_account.indexOf("@yahoo.com") != -1){
            $("#smtp_server").val('"smtp.mail.yahoo.com"');
            if (ssl == "true"){
                $("#server_port").val('"587"');
            }else{
                $("#server_port").val('"25"');
            }
        }
    }
  </script>
    <style>
    .box {
        border:2px solid blue;
        width: 0px;
        height: 0px;
        position: absolute;
        opacity: 0.5;
    }
    .panel-title {
        margin-top: 0;
        margin-bottom: 0;
        font-size: 14px;
        color: inherit;
        font: 14px Helvetica Neue,Helvetica,PingFang SC,Tahoma,Arial,sans-serif;
    }
    .layui-nav {
        background: #EFF4FE;
        color: #212121 !important;
    }
    .layui-nav .layui-nav-item a {
        color: #212121 !important;
    }
    .layui-nav-tree .layui-nav-item a {
        height: 32px;
        line-height: 32px;
    }
    .rapMenu {
        border-bottom-color: #BED5F3;
        border-bottom-style: solid;
        border-bottom-width: 1px;
    }
    .layui-nav-itemed>.layui-nav-child {
        background-color: #fff !important;
    }
    .layui-nav-tree .layui-nav-item dd:hover {
        background: #FFEEAC;
    }
    .layui-nav .layui-nav-item .navigation a:hover {
        background: #FFEEAC;
    }
    .layui-nav-tree .layui-nav-item .rpaMenu:hover {
        background: #FFEEAC;
    }
    .layui-nav-tree .layui-nav-child dd.layui-this, .layui-nav-tree .layui-nav-child dd.layui-this a, .layui-nav-tree .layui-this, .layui-nav-tree .layui-this>a, .layui-nav-tree .layui-this>a:hover {
        background-color: #fff;
    }
    .functionMenu {
        margin-left: 5px;
        height: 32px;
        display: inline-block;
        text-align: center;
        font-size: 13px;
        font-weight: 700;
        line-height: 32px;
        vertical-align:middle;
    }
    .panel-body {
        padding: 0px;
    }
    body .layui-layer-setmybg .layui-layer-content{background-color:  #c00; color: #fff;}
    .flow-span {
        display:block;
        overflow: hidden;
        text-overflow:ellipsis;
        white-space: nowrap;
    }
    .slider-label{
        background-color: #f5f5f5;
        color: #d2d2d2!important;
        border-color: #f5f5f5!important;
        width: fit-content;
        font-size: 12px;
        line-height: 12px;
        font-weight: 400;
        margin-bottom: 0px;
        margin-left: 15px;
    }
    .dl-c3.layui-nav-child {padding-left: 15px; box-sizing: border-box;}
	.dl-c4.layui-nav-child {padding-left: 15px; box-sizing: border-box;}
	.panel {
        margin-bottom: 0px;
    }
    .menu-panel {
        height: 32px;
        width: 100%;
    }
    .property {
        background: #d9edf7 !important;
        border-color: #d9edf7 !important;
        padding: 0px 5px;
    }
    .property-div {
        margin-bottom: 10px;
    }
    .property-div> i {
        color: #3c8dbc;
        display: inline-block;
        width: 15px;
        float: none;
        position: static;
        text-align: center;
        opacity: .85;
        -webkit-transition: all .12s;
        -o-transition: all .12s;
        transition: all .12s;
        margin: 0 0 2px 3px;
        vertical-align: middle;
        cursor: pointer;
        font-size: 14px;
    }
    .property-div> i.fa-pencil {
        color: #69aa46;
    }
    .property-input {
        width: 100%;
        height: 25px;
        border: 1px solid #ccc;
        border-radius: 3px;
    }
    .property-input-div {
        width: 100%;
        height: 25px;
    }
    input::-webkit-input-placeholder{
        color: #CFCFCF;
    }
    input::-moz-placeholder{   /* Mozilla Firefox 19+ */
        color: #CFCFCF;
    }
    input:-moz-placeholder{    /* Mozilla Firefox 4 to 18 */
        color: #CFCFCF;
    }
    input:-ms-input-placeholder{  /* Internet Explorer 10-11 */
        color: #CFCFCF;
    }

    input:focus {
      border-color: #6b9cde;
      box-shadow: 0 0 3px 0 #95b8e7;
    }
    body .property .layui-layer-title{
        background: #d9edf7 !important;
        border-color: #d9edf7;
        text-align: center;
        font-size: 16px;
        height: 40px;
        margin-left: 30px;
    }
    .layui-table-header{border-color: #ffffff;}
    .layui-table-view{margin:0 !important;border-color: #ffffff;}
    .selected_tab {
        color: rgb(213, 133, 18);
    }
    .layui-table-cell{
        height:24px !important;
     }
     .layui-none {
        display: none;
     }
     .panel-icon, .panel-tool {
        top: 40%;
    }
    .notice {
        width: 100%;
        height: 100%;
        padding: 5px 20px 20px 20px;
        line-height: 30px;
        font-size: 16px;
        font-weight: 300;
        background-color: #f2f2f2;
    }
    .layui-text {
        color: #666;
    }
    .required-icon {
        color: #e02222;
        font-weight: 700;
    }
    .picker {
        width: 15px;
        height: 15px;
        cursor: pointer;
        display: inline-block;
        vertical-align: middle;
        margin: 0 0 2px 3px;
        border-radius:5px;
    }
    .connectorLabel {
        text-align: center;
    }
    .label-branch {
        height: 40px !important;
    }
    .search-adj {
        width: 100% !important;
    }
    .hide_label {
        z-index: 4;
    }
    .layui-form-switch {
        height: 18px;
        line-height: 18px;
        min-width: 15px;
        margin-top: 0px;
    }
    .layui-form-switch i {
        top: 1px;
        width: 15px;
        height: 15px;
        border-radius: 16px;
    }
    .layui-form-checkbox {
        padding-right: 0px !important;
    }
    .layui-tree-entry .layui-icon-edit {
        display: none;
    }
    </style>
</head>
<body onresize="doResize()">
<input id="language" value="{{ language }}" style="display:none;"/>
<input id="start_1" style="display:none;"/>
<input id="x" style="display:none;"/>
<input id="y" style="display:none;"/>
<input id="move" style="display:none;"/>
<input id="left" style="display:none;"/>
<input id="top" style="display:none;"/>
<input id="width" style="display:none;"/>
<input id="next_left" style="display:none;"/>
<input id="next_top" style="display:none;"/>
<input id="next_width" style="display:none;"/>
<input id="arrange" style="display:none;"/>
<input id="next" style="display:none;"/>
<input id="type" style="display:none;"/>
<input id="group_id" style="display:none;"/>
<input id="copy_mode" style="display:none;"/>
<input id="screen_adjust" style="display:none;" value="no"/>
<input id="new_page_tab" style="display:none;" value="no"/>
<input id="setting_index" style="display:none;" value="no"/>
<input id="setting_element_id" style="display:none;" value="no"/>
<input id="setting_process_type" style="display:none;" value="no"/>
<input id="repaint" style="display:none;" value="no"/>
<input id="repaintAll" style="display:none;" value="yes"/>
<div id="cc" class="easyui-layout" style="width:100%;height:900px;" data-options="fit:true">
    <div data-options="region:'north',border:false" style="height:36px;">
        <div class="easyui-panel menu-panel" style="border-bottom:1px solid #BED5F3">
            {% if 'Draw_Process.views_menu_file' in perms %}<a href="#" class="easyui-menubutton" data-options="menu:'#mm1',iconCls:'icon-folder-go'" style="height:100%;" onclick="showMenu('mm1')">{% trans "File" %}</a>{% endif %}
            {% if 'Draw_Process.views_menu_execute' in perms %}<a href="#" class="easyui-menubutton" data-options="menu:'#mm2',iconCls:'icon-clock-go'" style="height:100%;" onclick="showMenu('mm2')">{% trans "Execute" %}</a>{% endif %}
            {% if 'Draw_Process.views_menu_view' in perms %}<a href="#" class="easyui-menubutton" data-options="menu:'#mm3',iconCls:'icon-application-view'" style="height:100%;" onclick="showMenu('mm3')">{% trans "View" %}</a>{% endif %}
            {% if 'Draw_Process.views_menu_language' in perms %}<a href="#" class="easyui-menubutton" data-options="menu:'#mm4',iconCls:'icon-language'" style="height:100%;display: none;" onclick="showMenu('mm4')">{% trans "Language" %}</a>{% endif %}
            {% if 'Draw_Process.views_menu_record' in perms %}<a href="#" class="easyui-menubutton" data-options="menu:'#mm5',iconCls:'icon-record-red'" style="height:100%;" onclick="showMenu('mm5')">{% trans "Record" %}</a>{% endif %}
            <!--{% if 'Draw_Process.views_menu_help' in perms %}<a href="#" class="easyui-menubutton" data-options="menu:'#mm6',iconCls:'icon-help'" style="height:100%;">{% trans "Help" %}</a>{% endif %}-->
        </div>
        {% if 'Draw_Process.views_menu_file' in perms %}
        <div id="mm1" style="min-width:110px;">
            {% if 'Draw_Process.views_menu_file_open' in perms %}
            <div data-options="iconCls:'icon-folder-up'">
                <span>{% trans "Open" %}</span>
                <div>
                    {% if 'Draw_Process.views_menu_file_open_public' in perms %}<div data-options="iconCls:'icon-folder-user'" onclick="openFile('public')">{% trans "Public" %}</div>{% endif %}
                    {% if 'Draw_Process.views_menu_file_open_private' in perms %}<div data-options="iconCls:'icon-folder-key'" onclick="openFile('private')">{% trans "Private" %}</div>{% endif %}
                    {% if 'Draw_Process.views_menu_file_open_release' in perms %}<div data-options="iconCls:'icon-folder-link'" onclick="openFile('release')">{% trans "Release" %}</div>{% endif %}
                </div>
            </div>
            {% endif %}
            {% if 'Draw_Process.views_menu_file_save' in perms %}
            <div data-options="iconCls:'icon-save'">
                <span>{% trans "Save" %}</span>
                <div>
                    {% if 'Draw_Process.views_menu_file_save_public' in perms %}<div data-options="iconCls:'icon-folder-user'" onclick="saveProcess('public')">{% trans "Public" %}</div>{% endif %}
                    {% if 'Draw_Process.views_menu_file_save_private' in perms %}<div data-options="iconCls:'icon-folder-key'" onclick="saveProcess('private')">{% trans "Private" %}</div>{% endif %}
                    {% if 'Draw_Process.views_menu_file_save_release' in perms %}<div data-options="iconCls:'icon-folder-link'" onclick="saveProcess('release')">{% trans "Release" %}</div>{% endif %}
                </div>
            </div>
            {% endif %}
            {% if 'Draw_Process.views_menu_file_export' in perms %}
            <div data-options="iconCls:'icon-flow-download'">
                <span>{% trans "Export" %}</span>
                <div>
                    {% if 'Draw_Process.views_menu_file_export_process' in perms %}<div data-options="iconCls:'icon-page'" onclick="download('processExcel')">{% trans "Process" %}</div>{% endif %}
                    {% if 'Draw_Process.views_menu_file_export_codes_txt' in perms %}<div data-options="iconCls:'icon-page-code'" onclick="download('codesTxt')">{% trans "Codes Txt" %}</div>{% endif %}
                    {% if 'Draw_Process.views_menu_file_export_codes_pdf' in perms %}<div data-options="iconCls:'icon-pdf'" onclick="download('codesPdf')">{% trans "Codes Pdf" %}</div>{% endif %}
                </div>
            </div>
            {% endif %}
            {% if 'Draw_Process.views_menu_file_import' in perms %}
            <div data-options="iconCls:'icon-flow-upload'" onclick="upload()">
                <span>{% trans "Import" %}</span>
            </div>
            {% endif %}
        </div>
        {% endif %}
        {% if 'Draw_Process.views_menu_execute' in perms %}
        <div id="mm2" style="min-width:110px;">
            {% if 'Draw_Process.views_menu_execute_run' in perms %}
            <div data-options="iconCls:'icon-clock-start'">
                <span>{% trans "Run" %}</span>
                <div>
                    {% if 'Draw_Process.views_menu_execute_run_own_pc' in perms %}<div data-options="iconCls:'icon-computer-start'" onclick="before_run('own')">{% trans "Own PC" %}</div>{% endif %}
<!--                    {% if 'Draw_Process.views_menu_execute_run_server' in perms %}<div data-options="iconCls:'icon-computer-link'" onclick="before_run('server')">{% trans "Server" %}</div>{% endif %}-->
<!--                    {% if 'Draw_Process.views_menu_execute_run_cn190439' in perms %}<div data-options="iconCls:'icon-computer-key'" onclick="before_run('10.190.11.158')">{% trans "CN190439" %}</div>{% endif %}-->
                    <!--{% if 'Draw_Process.views_menu_execute_run_fixed_ip' in perms %}<div data-options="iconCls:'icon-computer-magnify'" onclick="before_run('fix')">{% trans "Fixed IP" %}</div>{% endif %}-->
                </div>
            </div>
            {% endif %}
            {% if 'Draw_Process.views_menu_execute_task' in perms %}
            <div data-options="iconCls:'icon-clock-edit'">
                <span>{% trans "Task" %}</span>
                <div>
                    {% if 'Draw_Process.views_menu_execute_task_own_pc' in perms %}<div data-options="iconCls:'icon-computer-start'" onclick="book('own')">{% trans "Own PC" %}</div>{% endif %}
<!--                    {% if 'Draw_Process.views_menu_execute_task_server' in perms %}<div data-options="iconCls:'icon-computer-link'" onclick="book('server')">{% trans "Server" %}</div>{% endif %}-->
<!--                    {% if 'Draw_Process.views_menu_execute_task_cn190439' in perms %}<div data-options="iconCls:'icon-computer-key'" onclick="book('10.190.11.158')">{% trans "CN190439" %}</div>{% endif %}-->
                </div>
            </div>
            {% endif %}
            <!--{% if 'Draw_Process.views_menu_execute_debug' in perms %}-->
            <!--<div data-options="iconCls:'icon-clock-pause'">-->
                <!--<span>{% trans "Debug" %}</span>-->
                <!--<div>-->
                    <!--{% if 'Draw_Process.views_menu_execute_debug_own_pc' in perms %}<div data-options="iconCls:'icon-computer-start'" onclick="develop()">{% trans "Own PC" %}</div>{% endif %}-->
                <!--</div>-->
            <!--</div>-->
            <!--{% endif %}-->
            <!--{% if 'Draw_Process.views_menu_execute_download' in perms %}-->
            <!--<div data-options="iconCls:'icon-disk-download'" onclick="develop()">{% trans "Download" %}</div>-->
            <!--{% endif %}-->
        </div>
        {% endif %}
        {% if 'Draw_Process.views_menu_view' in perms %}
        <div id="mm3" style="min-width:110px;">
            {% if 'Draw_Process.views_menu_view_rearrange' in perms %}<div data-options="iconCls:'icon-text-list-numbers'" onclick="rearrangement()">{% trans "Rearrange" %}</div>{% endif %}
            {% if 'Draw_Process.views_menu_view_clear' in perms %}<div data-options="iconCls:'icon-remove'" onclick="clean()">{% trans "Clear" %}</div>{% endif %}
            {% if 'Draw_Process.views_menu_view_group' in perms %}<div data-options="iconCls:'icon-flow-group'" onclick="group()">{% trans "Group" %}</div>{% endif %}
        </div>
        {% endif %}
        {% if 'Draw_Process.views_menu_language' in perms %}
        <div id="mm4" style="min-width:110px;">
            {% if 'Draw_Process.views_menu_language_english' in perms %}<div data-options="iconCls:'icon-flag-england'">{% trans "English" %}</div>{% endif %}
            {% if 'Draw_Process.views_menu_language_chinese' in perms %}<div data-options="iconCls:'icon-flag-cn'">{% trans "Chinese" %}</div>{% endif %}
        </div>
        {% endif %}
        <!--{% if 'Draw_Process.views_menu_record' in perms %}-->
        <div id="mm5" style="min-width:110px;">
            {% if 'Draw_Process.views_menu_record_chrome' in perms %}<div data-options="iconCls:'icon-chrome'" onclick="record('chrome')">Chrome</div>{% endif %}
            <!--{% if 'Draw_Process.views_menu_record_ie' in perms %}<div data-options="iconCls:'icon-ie'" onclick="develop()">IE</div>{% endif %}-->
            {% if 'Draw_Process.views_menu_record_sap' in perms %}<div data-options="iconCls:'icon-sap'" onclick="record('sap')">SAP</div>{% endif %}
            <!--{% if 'Draw_Process.views_menu_record_excel' in perms %}<div data-options="iconCls:'icon-page-white-excel'" onclick="develop()">Excel</div>{% endif %}-->
        </div>
        <!--{% endif %}-->
        <!--{% if 'Draw_Process.views_menu_help' in perms %}-->
        <!--<div id="mm6" style="min-width:110px;">-->
            <!--<div data-options="iconCls:'icon-robot'">-->
                <!--<span>{% trans "Robot" %}</span>-->
                <!--<div>-->
                    <!--<div data-options="iconCls:'icon-start-robot'" onclick="develop()">{% trans "Start" %}</div>-->
                    <!--<div data-options="iconCls:'icon-upgrade'" onclick="develop()">{% trans "Upgrade" %}</div>-->
                    <!--<div data-options="iconCls:'icon-batch-upgrade'" onclick="develop()">{% trans "Batch Upgrade" %}</div>-->
                    <!--<div data-options="iconCls:'icon-information'" onclick="develop()">{% trans "Batch Information" %}</div>-->
                <!--</div>-->
            <!--</div>-->
            <!--<div data-options="iconCls:'icon-information'" onclick="develop()">{% trans "Operation Manual" %}</div>-->
        <!--</div>-->
        <!--{% endif %}-->
    </div>
    <div data-options="region:'south',split:true,collapsible:true,collapsed:true,iconCls:'icon-error'" title="Console" style="height:120px;">
        <div id="control_area" style="margin-left:5px;"></div>
    </div>
    <div id="diagramContainer-left" data-options="region:'west',split:true,iconCls:'icon-shape-move-backwards'" title="{% trans 'Function Area' %}" style="width:300px;">
        <div class="easyui-panel" style="width:100%;z-index:1;position:relative;border:0px;">
            <input id="ss" class="easyui-searchbox" data-options="prompt:'{% trans 'Function Name' %}',searcher:doSearch" style="width:100%">
        </div>
        <script>
            function doSearch(value){
                $(' .icon-shape-move-backwards').on('click', function (event) {
                    doSearch("");
                });
                var elements = document.getElementById("leftMenu").getElementsByTagName("li");
                for (var i=0;i<elements.length;i++){
                    var element = elements[i];
                    if (value != ""){
                        element.className = "layui-nav-item layui-nav-itemed";
                        if (element.childNodes.length > 0){
                            var className = element.children[0].className;
                            element.children[0].style.display = "none";
                            if (className == "rpaMenu insert"){
                                element.style.display = "none";
                                break;
                            }
                        }
                    }else{
                        $('#ss').searchbox({
                            value: ''
                        });
                        element.className = "layui-nav-item";
                        if (element.childNodes.length > 0){
                            var className = element.children[0].className;
                            element.children[0].style.display = "block";
                            if (className == "rpaMenu insert"){
                                element.style.display = "block";
                                break;
                            }
                        }
                    }
                    if (element.childNodes.length > 0){
                        if (value != ""){
                            element.children[0].style.display = "none";
                        }else{
                            element.children[0].style.display = "block";
                        }
                    }
                    var dds = element.getElementsByTagName("dd");
                    for (var j=0;j<dds.length;j++){
                        var dd = dds[j];
                        if (dd.innerText.toLowerCase().indexOf(value.toLowerCase()) == -1){
                            dd.style.display = "none";
                        }else{
                            dd.style.display = "block";
                        }
                    }
                }
            }
        </script>
        <ul id="leftMenu" class="layui-nav layui-nav-tree layui-inline" lay-filter="demo" style="width:100%;padding-top:30px;">
            {% if 'Draw_Process.views_main_function' in perms %}
            <li class="layui-nav-item">
                <a href="javascript:;" class="rpaMenu"><i class="icon-home" aria-hidden="true"></i><span class="functionMenu">{% trans "Main Function" %}</span></a>
                <dl class="layui-nav-child">
<!--                    {% if 'Draw_Process.views_end_d' in perms %}-->
<!--                    <dd class="jnode-box2" data-template="jnode-template" data-jnode="judge" data-jnode-class="jnode-diamond jnode-judge bdc-warning"><a id="End_D" href="javascript:;" style="margin-left:15px;"><i class="fa fa-facebook"></i><span style="margin-left:5px;">{% trans "End_D" %}</span></a></dd>-->
<!--                    {% endif %}-->
                    {% if 'Draw_Process.views_start' in perms %}
                    <dd class="jnode-box2" data-template="jnode-template" data-jnode="start" data-jnode-class="jnode-radius bdc-success"><a id="Start" href="javascript:;" style="margin-left:15px;"><i class="fa fa-play-circle"></i><span style="margin-left:5px;">{% trans "Start" %}</span></a></dd>
                    {% endif %}
                    {% if 'Draw_Process.views_end' in perms %}
                    <dd class="jnode-box2" data-template="jnode-template" data-jnode="end" data-jnode-class="jnode-radius bdc-danger"><a id="End" href="javascript:;" style="margin-left:15px;"><i class="fa fa-stop-circle"></i><span style="margin-left:5px;">{% trans "End" %}</span></a></dd>
                    {% endif %}
                    {% if 'Draw_Process.views_wait' in perms %}
                    <dd class="jnode-box2" data-template="jnode-template" data-jnode="end" data-jnode-class="jnode-radius bdc-wait"><a id="Wait" href="javascript:;" style="margin-left:15px;"><i class="fa fa-clock-o"></i><span style="margin-left:5px;">{% trans "Wait" %}</span></a></dd>
                    {% endif %}
                    {% if 'Draw_Process.views_if' in perms %}
                    <dd class="jnode-box2" data-template="jnode-template" data-jnode="judge" data-jnode-class="jnode-diamond jnode-judge bdc-warning"><a id="If" href="javascript:;" style="margin-left:15px;"><i class="fa fa-random"></i><span style="margin-left:5px;">{% trans "If" %}</span></a></dd>
                    {% endif %}
                    {% if 'Draw_Process.views_else_if' in perms %}
                    <dd class="jnode-box2" data-template="jnode-template" data-jnode="judge" data-jnode-class="jnode-diamond jnode-judge bdc-warning"><a id="Else_If" href="javascript:;" style="margin-left:15px;"><i class="fa fa-random"></i><span style="margin-left:5px;">{% trans "Else_If" %}</span></a></dd>
                    {% endif %}
                    {% if 'Draw_Process.views_else' in perms %}
                    <dd class="jnode-box2" data-template="jnode-template" data-jnode="judge" data-jnode-class="jnode-diamond jnode-judge bdc-warning"><a id="Else" href="javascript:;" style="margin-left:15px;"><i class="fa fa-random"></i><span style="margin-left:5px;">{% trans "Else" %}</span></a></dd>
                    {% endif %}
                    {% if 'Draw_Process.views_end_if' in perms %}
                    <dd class="jnode-box2" data-template="jnode-template" data-jnode="judge" data-jnode-class="jnode-diamond jnode-judge bdc-warning"><a id="End_If" href="javascript:;" style="margin-left:15px;"><i class="fa fa-random"></i><span style="margin-left:5px;">{% trans "End_If" %}</span></a></dd>
                    {% endif %}
                    {% if 'Draw_Process.views_while' in perms %}
                    <dd class="jnode-box2" data-template="jnode-template" data-jnode="judge" data-jnode-class="jnode-diamond jnode-judge bdc-warning"><a id="While" href="javascript:;" style="margin-left:15px;"><i class="fa fa-circle-o-notch"></i><span style="margin-left:5px;">{% trans "While" %}</span></a></dd>
                    {% endif %}
                    {% if 'Draw_Process.views_exit_w' in perms %}
                    <dd class="jnode-box2" data-template="jnode-template" data-jnode="judge" data-jnode-class="jnode-diamond jnode-judge bdc-warning"><a id="Exit_W" href="javascript:;" style="margin-left:15px;"><i class="fa fa-circle-o-notch"></i><span style="margin-left:5px;">{% trans "Exit_W" %}</span></a></dd>
                    {% endif %}
                    {% if 'Draw_Process.views_for' in perms %}
                    <dd class="jnode-box2" data-template="jnode-template" data-jnode="judge" data-jnode-class="jnode-diamond jnode-judge bdc-warning"><a id="For" href="javascript:;" style="margin-left:15px;"><i class="fa fa-th-list"></i><span style="margin-left:5px;">{% trans "For" %}</span></a></dd>
                    {% endif %}
                    {% if 'Draw_Process.views_break' in perms %}
                    <dd class="jnode-box2" data-template="jnode-template" data-jnode="judge" data-jnode-class="jnode-diamond jnode-judge bdc-warning"><a id="Break" href="javascript:;" style="margin-left:15px;"><i class="fa fa-th-list"></i><span style="margin-left:5px;">{% trans "Break" %}</span></a></dd>
                    {% endif %}
                    {% if 'Draw_Process.views_continue' in perms %}
                    <dd class="jnode-box2" data-template="jnode-template" data-jnode="judge" data-jnode-class="jnode-diamond jnode-judge bdc-warning"><a id="Continue" href="javascript:;" style="margin-left:15px;"><i class="fa fa-th-list"></i><span style="margin-left:5px;">{% trans "Continue" %}</span></a></dd>
                    {% endif %}
                    {% if 'Draw_Process.views_exit_for' in perms %}
                    <dd class="jnode-box2" data-template="jnode-template" data-jnode="judge" data-jnode-class="jnode-diamond jnode-judge bdc-warning"><a id="Exit_For" href="javascript:;" style="margin-left:15px;"><i class="fa fa-th-list"></i><span style="margin-left:5px;">{% trans "Exit_For" %}</span></a></dd>
                    {% endif %}
                    {% if 'Draw_Process.views_if' in perms %}
                    <dd class="jnode-box2" data-template="jnode-template" data-jnode="judge" data-jnode-class="jnode-diamond jnode-judge bdc-warning"><a id="Try" href="javascript:;" style="margin-left:15px;"><i class="fa fa-random"></i><span style="margin-left:5px;">{% trans "Try" %}</span></a></dd>
                    {% endif %}
                    {% if 'Draw_Process.views_else_if' in perms %}
                    <dd class="jnode-box2" data-template="jnode-template" data-jnode="judge" data-jnode-class="jnode-diamond jnode-judge bdc-warning"><a id="Except" href="javascript:;" style="margin-left:15px;"><i class="fa fa-random"></i><span style="margin-left:5px;">{% trans "Except" %}</span></a></dd>
                    {% endif %}
                    {% if 'Draw_Process.views_else' in perms %}
                    <dd class="jnode-box2" data-template="jnode-template" data-jnode="judge" data-jnode-class="jnode-diamond jnode-judge bdc-warning"><a id="Finally" href="javascript:;" style="margin-left:15px;"><i class="fa fa-random"></i><span style="margin-left:5px;">{% trans "Finally" %}</span></a></dd>
                    {% endif %}
                    {% if 'Draw_Process.views_end_if' in perms %}
                    <dd class="jnode-box2" data-template="jnode-template" data-jnode="judge" data-jnode-class="jnode-diamond jnode-judge bdc-warning"><a id="End_Try" href="javascript:;" style="margin-left:15px;"><i class="fa fa-random"></i><span style="margin-left:5px;">{% trans "End_Try" %}</span></a></dd>
                    {% endif %}
                    {% if 'Draw_Process.views_reminder' in perms %}
                    <dd class="jnode-box2" data-template="jnode-template" data-jnode="judge" data-jnode-class="jnode-task bdc-primary"><a id="Remainder" href="javascript:;" style="margin-left:15px;"><i class="fa fa-italic"></i><span style="margin-left:5px;">{% trans "Remainder" %}</span></a></dd>
                    {% endif %}
                    {% if 'Draw_Process.views_integration' in perms %}
                    <dd class="jnode-box2" data-template="jnode-template" data-jnode="judge" data-jnode-class="jnode-task bdc-primary"><a id="Integration" href="javascript:;" style="margin-left:15px;"><i class="fa fa-italic"></i><span style="margin-left:5px;">{% trans "Integration" %}</span></a></dd>
                    {% endif %}
                    {% if 'Draw_Process.views_division' in perms %}
                    <dd class="jnode-box2" data-template="jnode-template" data-jnode="judge" data-jnode-class="jnode-task bdc-primary"><a id="Division" href="javascript:;" style="margin-left:15px;"><i class="fa fa-italic"></i><span style="margin-left:5px;">{% trans "Division" %}</span></a></dd>
                    {% endif %}
                    {% if 'Draw_Process.views_float' in perms %}
                    <dd class="jnode-box2" data-template="jnode-template" data-jnode="judge" data-jnode-class="jnode-task bdc-primary"><a id="Float" href="javascript:;" style="margin-left:15px;"><i class="fa fa-italic"></i><span style="margin-left:5px;">{% trans "Float" %}</span></a></dd>
                    {% endif %}
                </dl>
            </li>
            {% endif %}
            {% if 'Draw_Process.views_general_module' in perms %}
            <li class="layui-nav-item">
                <a href="javascript:;" class="rpaMenu"><i class="fa fa-envelope" aria-hidden="true"></i><span class="functionMenu">{% trans "General Module" %}</span></a>
                <dl class="layui-nav-child">
<!--                    {% if 'Draw_Process.views_general_select' in perms %}-->
<!--                    <dd class="jnode-box2" data-template="jnode-template" data-jnode="task" data-jnode-class="jnode-task bdc-primary"><a id="General_Select" href="javascript:;" style="margin-left:15px;"><i class="icon-location-pin"></i><span style="margin-left:5px;">{% trans "General_Select" %}</span></a></dd>-->
<!--                    {% endif %}-->
                    {% if 'Draw_Process.views_general_click' in perms %}
                    <dd class="jnode-box2" data-template="jnode-template" data-jnode="task" data-jnode-class="jnode-task bdc-primary"><a id="General_Click" href="javascript:;" style="margin-left:15px;"><i class="icon-location-pin"></i><span style="margin-left:5px;">{% trans "General_Click" %}</span></a></dd>
                    {% endif %}
                    {% if 'Draw_Process.views_general_input' in perms %}
                    <dd class="jnode-box2" data-template="jnode-template" data-jnode="task" data-jnode-class="jnode-task bdc-primary"><a id="General_Input" href="javascript:;" style="margin-left:15px;"><i class="icon-location-pin"></i><span style="margin-left:5px;">{% trans "General_Input" %}</span></a></dd>
                    {% endif %}
                    {% if 'Draw_Process.views_general_gettext' in perms %}
                    <dd class="jnode-box2" data-template="jnode-template" data-jnode="task" data-jnode-class="jnode-task bdc-primary"><a id="General_GetText" href="javascript:;" style="margin-left:15px;"><i class="icon-location-pin"></i><span style="margin-left:5px;">{% trans "General_GetText" %}</span></a></dd>
                    {% endif %}
                    {% if 'Draw_Process.views_general_clear' in perms %}
                    <dd class="jnode-box2" data-template="jnode-template" data-jnode="task" data-jnode-class="jnode-task bdc-primary"><a id="General_Clear" href="javascript:;" style="margin-left:15px;"><i class="icon-location-pin"></i><span style="margin-left:5px;">{% trans "General_Clear" %}</span></a></dd>
                    {% endif %}
                    {% if 'Draw_Process.views_general_exist' in perms %}
                    <dd class="jnode-box2" data-template="jnode-template" data-jnode="task" data-jnode-class="jnode-task bdc-primary"><a id="General_Exist?" href="javascript:;" style="margin-left:15px;"><i class="icon-location-pin"></i><span style="margin-left:5px;">{% trans "General_Exist?" %}</span></a></dd>
                    {% endif %}
                    {% if 'Draw_Process.views_current_time' in perms %}
                    <dd class="jnode-box2" data-template="jnode-template" data-jnode="judge" data-jnode-class="jnode-task bdc-primary"><a id="Current_Time" href="javascript:;" style="margin-left:15px;"><i class="glyphicon glyphicon-time"></i><span style="margin-left:5px;">{% trans "Current_Time" %}</span></a></dd>
                    {% endif %}
                    {% if 'Draw_Process.views_custom_variant' in perms %}
                    <dd class="jnode-box2" data-template="jnode-template" data-jnode="judge" data-jnode-class="jnode-task bdc-primary"><a id="Custom_Variant" href="javascript:;" style="margin-left:15px;"><i class="fa fa-pencil-square"></i><span style="margin-left:5px;">{% trans "Custom_Variant" %}</span></a></dd>
                    {% endif %}
                    {% if 'Draw_Process.views_custom_variant' in perms %}
                    <dd class="jnode-box2" data-template="jnode-template" data-jnode="judge" data-jnode-class="jnode-task bdc-primary"><a id="Print_Variant" href="javascript:;" style="margin-left:15px;"><i class="fa fa-pencil-square-o"></i><span style="margin-left:5px;">{% trans "Print_Variant" %}</span></a></dd>
                    {% endif %}
                    {% if 'Draw_Process.views_screen_shot' in perms %}
                    <dd class="jnode-box2" data-template="jnode-template" data-jnode="judge" data-jnode-class="jnode-task bdc-primary"><a id="Screen_Shot" href="javascript:;" style="margin-left:15px;"><i class="icon-screen-desktop"></i><span style="margin-left:5px;">{% trans "Screen_Shot" %}</span></a></dd>
                    {% endif %}
                    {% if 'Draw_Process.views_set_focus' in perms %}
                    <dd class="jnode-box2" data-template="jnode-template" data-jnode="judge" data-jnode-class="jnode-task bdc-primary"><a id="Set_Focus" href="javascript:;" style="margin-left:15px;"><i class="fa fa-object-group"></i><span style="margin-left:5px;">{% trans "Set_Focus" %}</span></a></dd>
                    {% endif %}
                    {% if 'Draw_Process.views_window_size' in perms %}
                    <dd class="jnode-box2" data-template="jnode-template" data-jnode="task" data-jnode-class="jnode-task bdc-primary"><a id="Window_Size" href="javascript:;" style="margin-left:15px;"><i class="fa fa-camera-retro"></i><span style="margin-left:5px;">{% trans "Window_Size" %}</span></a></dd>
                    {% endif %}
                    {% if 'Draw_Process.views_set_password' in perms %}
                    <dd class="jnode-box2" data-template="jnode-template" data-jnode="judge" data-jnode-class="jnode-task bdc-primary"><a id="Set_Password" href="javascript:;" style="margin-left:15px;"><i class="fa fa-lock"></i><span style="margin-left:5px;">{% trans "Set_Password" %}</span></a></dd>
                    {% endif %}
                    {% if 'Draw_Process.views_user_input' in perms %}
                    <dd class="jnode-box2" data-template="jnode-template" data-jnode="judge" data-jnode-class="jnode-task bdc-primary"><a id="User_Input" href="javascript:;" style="margin-left:15px;"><i class="fa fa-chrome"></i><span style="margin-left:5px;">{% trans "User_Input" %}</span></a></dd>
                    {% endif %}
                    {% if 'Draw_Process.views_driverinput' in perms %}
                    <dd class="jnode-box2" data-template="jnode-template" data-jnode="task" data-jnode-class="jnode-task bdc-primary"><a id="DriverInput" href="javascript:;" style="margin-left:15px;"><i class="fa fa-keyboard-o"></i><span style="margin-left:5px;">{% trans "DriverInput" %}</span></a></dd>
                    {% endif %}
                    {% if 'Draw_Process.views_clipboard_value' in perms %}
                    <dd class="jnode-box2" data-template="jnode-template" data-jnode="task" data-jnode-class="jnode-task bdc-primary"><a id="Clipboard_Value" href="javascript:;" style="margin-left:15px;"><i class="fa fa-clipboard"></i><span style="margin-left:5px;">{% trans "Clipboard_Value" %}</span></a></dd>
                    {% endif %}
                </dl>
            </li>
            {% endif %}
            {% if 'Draw_Process.views_mouse&keyboard' in perms %}
            <li class="layui-nav-item">
                <a href="javascript:;" class="rpaMenu"><i class="fa fa-keyboard-o" aria-hidden="true"></i><span class="functionMenu">{% trans "Mouse&Keyboard" %}</span></a>
                <dl class="layui-nav-child">
                    {% if 'Draw_Process.views_move_mouse' in perms %}
                    <dd class="jnode-box2" data-template="jnode-template" data-jnode="task" data-jnode-class="jnode-task bdc-primary"><a id="Move_Mouse" href="javascript:;" style="margin-left:15px;"><i class="icon-cursor-move"></i><span style="margin-left:5px;">{% trans "Move_Mouse" %}</span></a></dd>
                    {% endif %}
                    {% if 'Draw_Process.views_click_mouse' in perms %}
                    <dd class="jnode-box2" data-template="jnode-template" data-jnode="task" data-jnode-class="jnode-task bdc-primary"><a id="Click_Mouse" href="javascript:;" style="margin-left:15px;"><i class="icon-mouse"></i><span style="margin-left:5px;">{% trans "Click_Mouse" %}</span></a></dd>
                    {% endif %}
                    {% if 'Draw_Process.views_scroll_mouse' in perms %}
                    <dd class="jnode-box2" data-template="jnode-template" data-jnode="task" data-jnode-class="jnode-task bdc-primary"><a id="Scroll_Mouse" href="javascript:;" style="margin-left:15px;"><i class="icon-mouse"></i><span style="margin-left:5px;">{% trans "Scroll_Mouse" %}</span></a></dd>
                    {% endif %}
                    {% if 'Draw_Process.views_drag_mouse' in perms %}
                    <dd class="jnode-box2" data-template="jnode-template" data-jnode="task" data-jnode-class="jnode-task bdc-primary"><a id="Drag_Mouse" href="javascript:;" style="margin-left:15px;"><i class="icon-cursor"></i><span style="margin-left:5px;">{% trans "Drag_Mouse" %}</span></a></dd>
                    {% endif %}
                    {% if 'Draw_Process.views_press_keyboard' in perms %}
                    <dd class="jnode-box2" data-template="jnode-template" data-jnode="task" data-jnode-class="jnode-task bdc-primary"><a id="Press_Keyboard" href="javascript:;" style="margin-left:15px;"><i class="fa fa-keyboard-o"></i><span style="margin-left:5px;">{% trans "Press_Keyboard" %}</span></a></dd>
                    {% endif %}
                    {% if 'Draw_Process.views_hot_key' in perms %}
                    <dd class="jnode-box2" data-template="jnode-template" data-jnode="task" data-jnode-class="jnode-task bdc-primary"><a id="Hot_Key" href="javascript:;" style="margin-left:15px;"><i class="fa fa-keyboard-o"></i><span style="margin-left:5px;">{% trans "Hot_Key" %}</span></a></dd>
                    {% endif %}
                    {% if 'Draw_Process.views_typewrite' in perms %}
                    <dd class="jnode-box2" data-template="jnode-template" data-jnode="task" data-jnode-class="jnode-task bdc-primary"><a id="Typewrite" href="javascript:;" style="margin-left:15px;"><i class="fa fa-keyboard-o"></i><span style="margin-left:5px;">{% trans "Typewrite" %}</span></a></dd>
                    {% endif %}
                    {% if 'Draw_Process.views_screen_resolution' in perms %}
                    <dd class="jnode-box2" data-template="jnode-template" data-jnode="task" data-jnode-class="jnode-task bdc-primary"><a id="Screen_Resolution" href="javascript:;" style="margin-left:15px;"><i class="icon-screen-desktop"></i><span style="margin-left:5px;">{% trans "Screen_Resolution" %}</span></a></dd>
                    {% endif %}
                </dl>
            </li>
            {% endif %}
            {% if 'Draw_Process.views_sap' in perms %}
            <li class="layui-nav-item">
                <a href="javascript:;" class="rpaMenu"><i class="fa fa-pinterest-square" aria-hidden="true"></i><span class="functionMenu">{% trans "SAP Module" %}</span></a>
                <dl class="layui-nav-child">
<!--                    {% if 'Draw_Process.views_sap_press_toolbar' in perms %}-->
<!--                    <dd class="jnode-box2" data-template="jnode-template" data-jnode="task" data-jnode-class="jnode-task bdc-primary"><a id="SAP_PressToolbar" href="javascript:;" style="margin-left:15px;"><i class="icon-location-pin"></i><span style="margin-left:5px;">{% trans "SAP_PressToolbar" %}</span></a></dd>-->
<!--                    {% endif %}-->
<!--                    {% if 'Draw_Process.views_sap_select_context' in perms %}-->
<!--                    <dd class="jnode-box2" data-template="jnode-template" data-jnode="task" data-jnode-class="jnode-task bdc-primary"><a id="SAP_SelectContext" href="javascript:;" style="margin-left:15px;"><i class="icon-location-pin"></i><span style="margin-left:5px;">{% trans "SAP_SelectContext" %}</span></a></dd>-->
<!--                    {% endif %}-->
                    {% if 'Draw_Process.views_start_sap' in perms %}
                    <dd class="jnode-box2" data-template="jnode-template" data-jnode="task" data-jnode-class="jnode-task bdc-primary"><a id="SAP_Start" href="javascript:;" style="margin-left:15px;"><i class="icon-mouse"></i><span style="margin-left:5px;">{% trans "SAP_Start" %}</span></a></dd>
                    {% endif %}
                    {% if 'Draw_Process.views_login_sap' in perms %}
                    <dd class="jnode-box2" data-template="jnode-template" data-jnode="task" data-jnode-class="jnode-task bdc-primary"><a id="SAP_Login" href="javascript:;" style="margin-left:15px;"><i class="icon-login"></i><span style="margin-left:5px;">{% trans "SAP_Login" %}</span></a></dd>
                    {% endif %}
                    {% if 'Draw_Process.views_logout_sap' in perms %}
                    <dd class="jnode-box2" data-template="jnode-template" data-jnode="task" data-jnode-class="jnode-task bdc-primary"><a id="SAP_Logout" href="javascript:;" style="margin-left:15px;"><i class="icon-logout"></i><span style="margin-left:5px;">{% trans "SAP_Logout" %}</span></a></dd>
                    {% endif %}
                    {% if 'Draw_Process.views_sap_close' in perms %}
                    <dd class="jnode-box2" data-template="jnode-template" data-jnode="task" data-jnode-class="jnode-task bdc-primary"><a id="SAP_Close" href="javascript:;" style="margin-left:15px;"><i class="icon-location-pin"></i><span style="margin-left:5px;">{% trans "SAP_Close" %}</span></a></dd>
                    {% endif %}
                    {% if 'Draw_Process.views_t_code' in perms %}
                    <dd class="jnode-box2" data-template="jnode-template" data-jnode="task" data-jnode-class="jnode-task bdc-primary"><a id="SAP_TCode" href="javascript:;" style="margin-left:15px;"><i class="icon-pencil"></i><span style="margin-left:5px;">{% trans "SAP_TCode" %}</span></a></dd>
                    {% endif %}
                    {% if 'Draw_Process.views_sap_getcellvalue' in perms %}
                    <dd class="jnode-box2" data-template="jnode-template" data-jnode="task" data-jnode-class="jnode-task bdc-primary"><a id="SAP_GetCellValue" href="javascript:;" style="margin-left:15px;"><i class="icon-location-pin"></i><span style="margin-left:5px;">{% trans "SAP_GetCellValue" %}</span></a></dd>
                    {% endif %}
                    {% if 'Draw_Process.views_sap_get_text' in perms %}
                    <dd class="jnode-box2" data-template="jnode-template" data-jnode="task" data-jnode-class="jnode-task bdc-primary"><a id="SAP_GetText" href="javascript:;" style="margin-left:15px;"><i class="icon-location-pin"></i><span style="margin-left:5px;">{% trans "SAP_GetText" %}</span></a></dd>
                    {% endif %}
                    {% if 'Draw_Process.views_sap_table_rows' in perms %}
                    <dd class="jnode-box2" data-template="jnode-template" data-jnode="task" data-jnode-class="jnode-task bdc-primary"><a id="SAP_TableRows" href="javascript:;" style="margin-left:15px;"><i class="icon-location-pin"></i><span style="margin-left:5px;">{% trans "SAP_TableRows" %}</span></a></dd>
                    {% endif %}
                    {% if 'Draw_Process.views_sap_exist?' in perms %}
                    <dd class="jnode-box2" data-template="jnode-template" data-jnode="task" data-jnode-class="jnode-task bdc-primary"><a id="SAP_Exist?" href="javascript:;" style="margin-left:15px;"><i class="icon-question"></i><span style="margin-left:5px;">{% trans "SAP_Exist?" %}</span></a></dd>
                    {% endif %}
                    {% if 'Draw_Process.views_sap_cancel_select' in perms %}
                    <dd class="jnode-box2" data-template="jnode-template" data-jnode="task" data-jnode-class="jnode-task bdc-primary"><a id="SAP_CancelSelect" href="javascript:;" style="margin-left:15px;"><i class="icon-location-pin"></i><span style="margin-left:5px;">{% trans "SAP_CancelSelect" %}</span></a></dd>
                    {% endif %}
                    {% if 'Draw_Process.views_caret_position' in perms %}
                    <dd class="jnode-box2" data-template="jnode-template" data-jnode="task" data-jnode-class="jnode-task bdc-primary"><a id="SAP_CaretPosition" href="javascript:;" style="margin-left:15px;"><i class="icon-location-pin"></i><span style="margin-left:5px;">{% trans "SAP_CaretPosition" %}</span></a></dd>
                    {% endif %}
                    {% if 'Draw_Process.views_sap_column_selected' in perms %}
                    <dd class="jnode-box2" data-template="jnode-template" data-jnode="task" data-jnode-class="jnode-task bdc-primary"><a id="SAP_ColumnSelected" href="javascript:;" style="margin-left:15px;"><i class="icon-location-pin"></i><span style="margin-left:5px;">{% trans "SAP_ColumnSelected" %}</span></a></dd>
                    {% endif %}
                    {% if 'Draw_Process.views_sap_column_cancel_selected' in perms %}
                    <dd class="jnode-box2" data-template="jnode-template" data-jnode="task" data-jnode-class="jnode-task bdc-primary"><a id="SAP_ColumnCancelSelected" href="javascript:;" style="margin-left:15px;"><i class="icon-location-pin"></i><span style="margin-left:5px;">{% trans "SAP_ColumnCancelSelected" %}</span></a></dd>
                    {% endif %}
                    {% if 'Draw_Process.views_click_current_cell' in perms %}
                    <dd class="jnode-box2" data-template="jnode-template" data-jnode="task" data-jnode-class="jnode-task bdc-primary"><a id="SAP_ClickCurrentCell" href="javascript:;" style="margin-left:15px;"><i class="icon-location-pin"></i><span style="margin-left:5px;">{% trans "SAP_ClickCurrentCell" %}</span></a></dd>
                    {% endif %}
                    {% if 'Draw_Process.views_sap_doubleclickitem' in perms %}
                    <dd class="jnode-box2" data-template="jnode-template" data-jnode="task" data-jnode-class="jnode-task bdc-primary"><a id="SAP_DoubleClickItem" href="javascript:;" style="margin-left:15px;"><i class="icon-location-pin"></i><span style="margin-left:5px;">{% trans "SAP_DoubleClickItem" %}</span></a></dd>
                    {% endif %}
                    {% if 'Draw_Process.views_double_click_node' in perms %}
                    <dd class="jnode-box2" data-template="jnode-template" data-jnode="task" data-jnode-class="jnode-task bdc-primary"><a id="SAP_DoubleClickNode" href="javascript:;" style="margin-left:15px;"><i class="icon-location-pin"></i><span style="margin-left:5px;">{% trans "SAP_DoubleClickNode" %}</span></a></dd>
                    {% endif %}
                    {% if 'Draw_Process.views_sap_ensurevisiblehorizontalitem' in perms %}
                    <dd class="jnode-box2" data-template="jnode-template" data-jnode="task" data-jnode-class="jnode-task bdc-primary"><a id="SAP_EnsureVisibleHorizontalItem" href="javascript:;" style="margin-left:15px;"><i class="icon-location-pin"></i><span style="margin-left:5px;">{% trans "SAP_EnsureVisibleHorizontalItem" %}</span></a></dd>
                    {% endif %}
                    {% if 'Draw_Process.views_expand_node' in perms %}
                    <dd class="jnode-box2" data-template="jnode-template" data-jnode="task" data-jnode-class="jnode-task bdc-primary"><a id="SAP_ExpandNode" href="javascript:;" style="margin-left:15px;"><i class="icon-location-pin"></i><span style="margin-left:5px;">{% trans "SAP_ExpandNode" %}</span></a></dd>
                    {% endif %}
                    {% if 'Draw_Process.views_sap_first_visible_row' in perms %}
                    <dd class="jnode-box2" data-template="jnode-template" data-jnode="task" data-jnode-class="jnode-task bdc-primary"><a id="SAP_FirstVisibleRow" href="javascript:;" style="margin-left:15px;"><i class="icon-location-pin"></i><span style="margin-left:5px;">{% trans "SAP_FirstVisibleRow" %}</span></a></dd>
                    {% endif %}
                    {% if 'Draw_Process.views_sap_get_absolute_row' in perms %}
                    <dd class="jnode-box2" data-template="jnode-template" data-jnode="task" data-jnode-class="jnode-task bdc-primary"><a id="SAP_GetAbsoluteRow" href="javascript:;" style="margin-left:15px;"><i class="icon-location-pin"></i><span style="margin-left:5px;">{% trans "SAP_GetAbsoluteRow" %}</span></a></dd>
                    {% endif %}
                    {% if 'Draw_Process.views_sap_is_changeable' in perms %}
                    <dd class="jnode-box2" data-template="jnode-template" data-jnode="task" data-jnode-class="jnode-task bdc-primary"><a id="SAP_IsChangeable" href="javascript:;" style="margin-left:15px;"><i class="icon-location-pin"></i><span style="margin-left:5px;">{% trans "SAP_IsChangeable" %}</span></a></dd>
                    {% endif %}
                    {% if 'Draw_Process.views_sap_key' in perms %}
                    <dd class="jnode-box2" data-template="jnode-template" data-jnode="task" data-jnode-class="jnode-task bdc-primary"><a id="SAP_Key" href="javascript:;" style="margin-left:15px;"><i class="icon-location-pin"></i><span style="margin-left:5px;">{% trans "SAP_Key" %}</span></a></dd>
                    {% endif %}
                    {% if 'Draw_Process.views_sap_modifycell' in perms %}
                    <dd class="jnode-box2" data-template="jnode-template" data-jnode="task" data-jnode-class="jnode-task bdc-primary"><a id="SAP_ModifyCell" href="javascript:;" style="margin-left:15px;"><i class="icon-location-pin"></i><span style="margin-left:5px;">{% trans "SAP_ModifyCell" %}</span></a></dd>
                    {% endif %}
                    {% if 'Draw_Process.views_sap_node_rows' in perms %}
                    <dd class="jnode-box2" data-template="jnode-template" data-jnode="task" data-jnode-class="jnode-task bdc-primary"><a id="SAP_NodeRows" href="javascript:;" style="margin-left:15px;"><i class="icon-location-pin"></i><span style="margin-left:5px;">{% trans "SAP_NodeRows" %}</span></a></dd>
                    {% endif %}
                    {% if 'Draw_Process.views_sap_click' in perms %}
                    <dd class="jnode-box2" data-template="jnode-template" data-jnode="task" data-jnode-class="jnode-task bdc-primary"><a id="SAP_Press" href="javascript:;" style="margin-left:15px;"><i class="icon-location-pin"></i><span style="margin-left:5px;">{% trans "SAP_Press" %}</span></a></dd>
                    {% endif %}
                    {% if 'Draw_Process.views_sap_pressbutton' in perms %}
                    <dd class="jnode-box2" data-template="jnode-template" data-jnode="task" data-jnode-class="jnode-task bdc-primary"><a id="SAP_PressButton" href="javascript:;" style="margin-left:15px;"><i class="icon-location-pin"></i><span style="margin-left:5px;">{% trans "SAP_PressButton" %}</span></a></dd>
                    {% endif %}
                    {% if 'Draw_Process.views_sap_presscontextbutton' in perms %}
                    <dd class="jnode-box2" data-template="jnode-template" data-jnode="task" data-jnode-class="jnode-task bdc-primary"><a id="SAP_PressContextButton" href="javascript:;" style="margin-left:15px;"><i class="icon-location-pin"></i><span style="margin-left:5px;">{% trans "SAP_PressContextButton" %}</span></a></dd>
                    {% endif %}
                    {% if 'Draw_Process.views_sap_presstoolbarcontextbutton' in perms %}
                    <dd class="jnode-box2" data-template="jnode-template" data-jnode="task" data-jnode-class="jnode-task bdc-primary"><a id="SAP_PressToolbarContextButton" href="javascript:;" style="margin-left:15px;"><i class="icon-location-pin"></i><span style="margin-left:5px;">{% trans "SAP_PressToolbarContextButton" %}</span></a></dd>
                    {% endif %}
                    {% if 'Draw_Process.views_sap_select' in perms %}
                    <dd class="jnode-box2" data-template="jnode-template" data-jnode="task" data-jnode-class="jnode-task bdc-primary"><a id="SAP_Select" href="javascript:;" style="margin-left:15px;"><i class="icon-location-pin"></i><span style="margin-left:5px;">{% trans "SAP_Select" %}</span></a></dd>
                    {% endif %}
                    {% if 'Draw_Process.views_sap_selectall' in perms %}
                    <dd class="jnode-box2" data-template="jnode-template" data-jnode="task" data-jnode-class="jnode-task bdc-primary"><a id="SAP_SelectAll" href="javascript:;" style="margin-left:15px;"><i class="icon-location-pin"></i><span style="margin-left:5px;">{% trans "SAP_SelectAll" %}</span></a></dd>
                    {% endif %}
                    {% if 'Draw_Process.views_sap_selectcontextmenuitem' in perms %}
                    <dd class="jnode-box2" data-template="jnode-template" data-jnode="task" data-jnode-class="jnode-task bdc-primary"><a id="SAP_SelectContextMenuItem" href="javascript:;" style="margin-left:15px;"><i class="icon-location-pin"></i><span style="margin-left:5px;">{% trans "SAP_SelectContextMenuItem" %}</span></a></dd>
                    {% endif %}
                    {% if 'Draw_Process.views_sap_selected' in perms %}
                    <dd class="jnode-box2" data-template="jnode-template" data-jnode="task" data-jnode-class="jnode-task bdc-primary"><a id="SAP_Selected" href="javascript:;" style="margin-left:15px;"><i class="icon-location-pin"></i><span style="margin-left:5px;">{% trans "SAP_Selected" %}</span></a></dd>
                    {% endif %}
                    {% if 'Draw_Process.views_selected_node' in perms %}
                    <dd class="jnode-box2" data-template="jnode-template" data-jnode="task" data-jnode-class="jnode-task bdc-primary"><a id="SAP_SelectedNode" href="javascript:;" style="margin-left:15px;"><i class="icon-location-pin"></i><span style="margin-left:5px;">{% trans "SAP_SelectedNode" %}</span></a></dd>
                    {% endif %}
                    {% if 'Draw_Process.views_sap_selectitem' in perms %}
                    <dd class="jnode-box2" data-template="jnode-template" data-jnode="task" data-jnode-class="jnode-task bdc-primary"><a id="SAP_SelectItem" href="javascript:;" style="margin-left:15px;"><i class="icon-location-pin"></i><span style="margin-left:5px;">{% trans "SAP_SelectItem" %}</span></a></dd>
                    {% endif %}
                    {% if 'Draw_Process.views_select_node' in perms %}
                    <dd class="jnode-box2" data-template="jnode-template" data-jnode="task" data-jnode-class="jnode-task bdc-primary"><a id="SAP_SelectNode" href="javascript:;" style="margin-left:15px;"><i class="icon-location-pin"></i><span style="margin-left:5px;">{% trans "SAP_SelectNode" %}</span></a></dd>
                    {% endif %}
                    {% if 'Draw_Process.views_select_rows' in perms %}
                    <dd class="jnode-box2" data-template="jnode-template" data-jnode="task" data-jnode-class="jnode-task bdc-primary"><a id="SAP_SelectRows" href="javascript:;" style="margin-left:15px;"><i class="icon-location-pin"></i><span style="margin-left:5px;">{% trans "SAP_SelectRows" %}</span></a></dd>
                    {% endif %}
                    {% if 'Draw_Process.views_sap_send_vkey' in perms %}
                    <dd class="jnode-box2" data-template="jnode-template" data-jnode="task" data-jnode-class="jnode-task bdc-primary"><a id="SAP_SendVkey" href="javascript:;" style="margin-left:15px;"><i class="icon-control-play"></i><span style="margin-left:5px;">{% trans "SAP_SendVkey" %}</span></a></dd>
                    {% endif %}
                    {% if 'Draw_Process.views_sap_set_current_cell' in perms %}
                    <dd class="jnode-box2" data-template="jnode-template" data-jnode="task" data-jnode-class="jnode-task bdc-primary"><a id="SAP_SetCurrentCell" href="javascript:;" style="margin-left:15px;"><i class="icon-location-pin"></i><span style="margin-left:5px;">{% trans "SAP_SetCurrentCell" %}</span></a></dd>
                    {% endif %}
                    {% if 'Draw_Process.views_sap_focus' in perms %}
                    <dd class="jnode-box2" data-template="jnode-template" data-jnode="task" data-jnode-class="jnode-task bdc-primary"><a id="SAP_SetFocus" href="javascript:;" style="margin-left:15px;"><i class="icon-location-pin"></i><span style="margin-left:5px;">{% trans "SAP_SetFocus" %}</span></a></dd>
                    {% endif %}
                    {% if 'Draw_Process.views_sap_input' in perms %}
                    <dd class="jnode-box2" data-template="jnode-template" data-jnode="task" data-jnode-class="jnode-task bdc-primary"><a id="SAP_Text" href="javascript:;" style="margin-left:15px;"><i class="icon-location-pin"></i><span style="margin-left:5px;">{% trans "SAP_Text" %}</span></a></dd>
                    {% endif %}
                    {% if 'Draw_Process.views_top_node' in perms %}
                    <dd class="jnode-box2" data-template="jnode-template" data-jnode="task" data-jnode-class="jnode-task bdc-primary"><a id="SAP_TopNode" href="javascript:;" style="margin-left:15px;"><i class="icon-location-pin"></i><span style="margin-left:5px;">{% trans "SAP_TopNode" %}</span></a></dd>
                    {% endif %}
                    {% if 'Draw_Process.views_sap_vertical_scrollbar' in perms %}
                    <dd class="jnode-box2" data-template="jnode-template" data-jnode="task" data-jnode-class="jnode-task bdc-primary"><a id="SAP_VerticalScrollbar" href="javascript:;" style="margin-left:15px;"><i class="icon-location-pin"></i><span style="margin-left:5px;">{% trans "SAP_VerticalScrollbar" %}</span></a></dd>
                    {% endif %}
                </dl>
            </li>
            {% endif %}
            {% if 'Draw_Process.views_excel_module' in perms %}
            <li class="layui-nav-item">
                <a href="javascript:;" class="rpaMenu"><i class="fa fa-file-excel-o" aria-hidden="true"></i><span class="functionMenu">{% trans "Excel Module" %}</span></a>
                <dl class="layui-nav-child">
                    {% if 'Draw_Process.views_new_workbook' in perms %}
                    <dd class="jnode-box2" data-template="jnode-template" data-jnode="task" data-jnode-class="jnode-task bdc-primary"><a id="Excel_NewWorkbook" href="javascript:;" style="margin-left:15px;"><i class="fa fa-plus-square-o"></i><span style="margin-left:5px;">{% trans "Excel_NewWorkbook" %}</span></a></dd>
                    {% endif %}
                    {% if 'Draw_Process.views_open_workbook' in perms %}
                    <dd class="jnode-box2" data-template="jnode-template" data-jnode="task" data-jnode-class="jnode-task bdc-primary"><a id="Excel_OpenWorkbook" href="javascript:;" style="margin-left:15px;"><i class="icon-size-fullscreen"></i><span style="margin-left:5px;">{% trans "Excel_OpenWorkbook" %}</span></a></dd>
                    {% endif %}
                    {% if 'Draw_Process.views_select_excel' in perms %}
                    <dd class="jnode-box2" data-template="jnode-template" data-jnode="task" data-jnode-class="jnode-task bdc-primary"><a id="Excel_SelectExcel" href="javascript:;" style="margin-left:15px;"><i class="fa fa-exchange"></i><span style="margin-left:5px;">{% trans "Excel_SelectExcel" %}</span></a></dd>
                    {% endif %}
                    {% if 'Draw_Process.views_active_workbook' in perms %}
                    <dd class="jnode-box2" data-template="jnode-template" data-jnode="task" data-jnode-class="jnode-task bdc-primary"><a id="Excel_ActiveWorkbook" href="javascript:;" style="margin-left:15px;"><i class="icon-target"></i><span style="margin-left:5px;">{% trans "Excel_ActiveWorkbook" %}</span></a></dd>
                    {% endif %}
                    {% if 'Draw_Process.views_save' in perms %}
                    <dd class="jnode-box2" data-template="jnode-template" data-jnode="task" data-jnode-class="jnode-task bdc-primary"><a id="Excel_Save" href="javascript:;" style="margin-left:15px;"><i class="fa fa-save"></i><span style="margin-left:5px;">{% trans "Excel_Save" %}</span></a></dd>
                    {% endif %}
                    {% if 'Draw_Process.views_save_as' in perms %}
                    <dd class="jnode-box2" data-template="jnode-template" data-jnode="task" data-jnode-class="jnode-task bdc-primary"><a id="Excel_SaveAs" href="javascript:;" style="margin-left:15px;"><i class="glyphicon glyphicon-floppy-saved"></i><span style="margin-left:5px;">{% trans "Excel_SaveAs" %}</span></a></dd>
                    {% endif %}
                    {% if 'Draw_Process.views_close_workbook' in perms %}
                    <dd class="jnode-box2" data-template="jnode-template" data-jnode="task" data-jnode-class="jnode-task bdc-primary"><a id="Excel_CloseWorkbook" href="javascript:;" style="margin-left:15px;"><i class="icon-close"></i><span style="margin-left:5px;">{% trans "Excel_CloseWorkbook" %}</span></a></dd>
                    {% endif %}
                    {% if 'Draw_Process.views_excel_exit' in perms %}
                    <dd class="jnode-box2" data-template="jnode-template" data-jnode="task" data-jnode-class="jnode-task bdc-primary"><a id="Excel_Exit" href="javascript:;" style="margin-left:15px;"><i class="icon-close"></i><span style="margin-left:5px;">{% trans "Excel_Exit" %}</span></a></dd>
                    {% endif %}
                    {% if 'Draw_Process.views_add_sheet' in perms %}
                    <dd class="jnode-box2" data-template="jnode-template" data-jnode="task" data-jnode-class="jnode-task bdc-primary"><a id="Excel_AddSheet" href="javascript:;" style="margin-left:15px;"><i class="fa fa-plus-square"></i><span style="margin-left:5px;">{% trans "Excel_AddSheet" %}</span></a></dd>
                    {% endif %}
                    {% if 'Draw_Process.views_delete_sheet' in perms %}
                    <dd class="jnode-box2" data-template="jnode-template" data-jnode="task" data-jnode-class="jnode-task bdc-primary"><a id="Excel_DeleteSheet" href="javascript:;" style="margin-left:15px;"><i class="glyphicon glyphicon-remove-circle"></i><span style="margin-left:5px;">{% trans "Excel_DeleteSheet" %}</span></a></dd>
                    {% endif %}
                    {% if 'Draw_Process.views_excel_renamesheet' in perms %}
                    <dd class="jnode-box2" data-template="jnode-template" data-jnode="task" data-jnode-class="jnode-task bdc-primary"><a id="Excel_RenameSheet" href="javascript:;" style="margin-left:15px;"><i class="fa fa-edit"></i><span style="margin-left:5px;">{% trans "Excel_RenameSheet" %}</span></a></dd>
                    {% endif %}
                    {% if 'Draw_Process.views_excel_current_sheets_count' in perms %}
                    <dd class="jnode-box2" data-template="jnode-template" data-jnode="task" data-jnode-class="jnode-task bdc-primary"><a id="Excel_CurrentSheetsCount" href="javascript:;" style="margin-left:15px;"><i class="fa fa-exchange"></i><span style="margin-left:5px;">{% trans "Excel_CurrentSheetsCount" %}</span></a></dd>
                    {% endif %}
                    {% if 'Draw_Process.views_excel_getsheet_name' in perms %}
                    <dd class="jnode-box2" data-template="jnode-template" data-jnode="task" data-jnode-class="jnode-task bdc-primary"><a id="Excel_GetSheetName" href="javascript:;" style="margin-left:15px;"><i class="fa fa-table"></i><span style="margin-left:5px;">{% trans "Excel_GetSheetName" %}</span></a></dd>
                    {% endif %}
                    {% if 'Draw_Process.views_sheet_exist' in perms %}
                    <dd class="jnode-box2" data-template="jnode-template" data-jnode="task" data-jnode-class="jnode-task bdc-primary"><a id="Excel_SheetExist?" href="javascript:;" style="margin-left:15px;"><i class="fa fa-question-circle"></i><span style="margin-left:5px;">{% trans "Excel_SheetExist?" %}</span></a></dd>
                    {% endif %}
                    {% if 'Draw_Process.views_used_rows' in perms %}
                    <dd class="jnode-box2" data-template="jnode-template" data-jnode="task" data-jnode-class="jnode-task bdc-primary"><a id="Excel_UsedRows" href="javascript:;" style="margin-left:15px;"><i class="fa fa-list-ol"></i><span style="margin-left:5px;">{% trans "Excel_UsedRows" %}</span></a></dd>
                    {% endif %}
                    {% if 'Draw_Process.views_used_columns' in perms %}
                    <dd class="jnode-box2" data-template="jnode-template" data-jnode="task" data-jnode-class="jnode-task bdc-primary"><a id="Excel_UsedColumns" href="javascript:;" style="margin-left:15px;"><i class="fa fa-list-ol"></i><span style="margin-left:5px;">{% trans "Excel_UsedColumns" %}</span></a></dd>
                    {% endif %}
                    {% if 'Draw_Process.views_excel_getcolumnname' in perms %}
                    <dd class="jnode-box2" data-template="jnode-template" data-jnode="task" data-jnode-class="jnode-task bdc-primary"><a id="Excel_GetColumnName" href="javascript:;" style="margin-left:15px;"><i class="fa fa-list"></i><span style="margin-left:5px;">{% trans "Excel_GetColumnName" %}</span></a></dd>
                    {% endif %}
                    {% if 'Draw_Process.views_insert' in perms %}
                    <dd class="jnode-box2" data-template="jnode-template" data-jnode="task" data-jnode-class="jnode-task bdc-primary"><a id="Excel_Insert" href="javascript:;" style="margin-left:15px;"><i class="fa fa-plus-square-o"></i><span style="margin-left:5px;">{% trans "Excel_Insert" %}</span></a></dd>
                    {% endif %}
                    {% if 'Draw_Process.views_auto_fit' in perms %}
                    <dd class="jnode-box2" data-template="jnode-template" data-jnode="task" data-jnode-class="jnode-task bdc-primary"><a id="Excel_AutoFit" href="javascript:;" style="margin-left:15px;"><i class="fa fa-columns"></i><span style="margin-left:5px;">{% trans "Excel_AutoFit" %}</span></a></dd>
                    {% endif %}
                    {% if 'Draw_Process.views_write_cell' in perms %}
                    <dd class="jnode-box2" data-template="jnode-template" data-jnode="task" data-jnode-class="jnode-task bdc-primary"><a id="Excel_WriteCells" href="javascript:;" style="margin-left:15px;"><i class="fa fa-pencil-square-o"></i><span style="margin-left:5px;">{% trans "Excel_WriteCells" %}</span></a></dd>
                    {% endif %}
                    {% if 'Draw_Process.views_read_cell' in perms %}
                    <dd class="jnode-box2" data-template="jnode-template" data-jnode="task" data-jnode-class="jnode-task bdc-primary"><a id="Excel_ReadCell" href="javascript:;" style="margin-left:15px;"><i class="fa fa-newspaper-o"></i><span style="margin-left:5px;">{% trans "Excel_ReadCell" %}</span></a></dd>
                    {% endif %}
                    {% if 'Draw_Process.views_calculation' in perms %}
                    <dd class="jnode-box2" data-template="jnode-template" data-jnode="task" data-jnode-class="jnode-task bdc-primary"><a id="Excel_Calculation"  href="javascript:;" style="margin-left:15px;"><i class="fa fa-calculator"></i><span style="margin-left:5px;">{% trans "Excel_Calculation" %}</span></a></dd>
                    {% endif %}
                    {% if 'Draw_Process.views_copy_cells' in perms %}
                    <dd class="jnode-box2" data-template="jnode-template" data-jnode="task" data-jnode-class="jnode-task bdc-primary"><a id="Excel_CopyCells" href="javascript:;" style="margin-left:15px;"><i class="fa fa-copy"></i><span style="margin-left:5px;">{% trans "Excel_CopyCells" %}</span></a></dd>
                    {% endif %}
                    {% if 'Draw_Process.views_paste_cells' in perms %}
                    <dd class="jnode-box2" data-template="jnode-template" data-jnode="task" data-jnode-class="jnode-task bdc-primary"><a id="Excel_PasteCells" href="javascript:;" style="margin-left:15px;"><i class="fa fa-paste"></i><span style="margin-left:5px;">{% trans "Excel_PasteCells" %}</span></a></dd>
                    {% endif %}
                    {% if 'Draw_Process.views_cut_cells' in perms %}
                    <dd class="jnode-box2" data-template="jnode-template" data-jnode="task" data-jnode-class="jnode-task bdc-primary"><a id="Excel_CutCells" href="javascript:;" style="margin-left:15px;"><i class="fa fa-cut"></i><span style="margin-left:5px;">{% trans "Excel_CutCells" %}</span></a></dd>
                    {% endif %}
                    {% if 'Draw_Process.views_delete_cells' in perms %}
                    <dd class="jnode-box2" data-template="jnode-template" data-jnode="task" data-jnode-class="jnode-task bdc-primary"><a id="Excel_DeleteCells" href="javascript:;" style="margin-left:15px;"><i class="glyphicon glyphicon-remove-sign"></i><span style="margin-left:5px;">{% trans "Excel_DeleteCells" %}</span></a></dd>
                    {% endif %}
                    {% if 'Draw_Process.views_clear_cells' in perms %}
                    <dd class="jnode-box2" data-template="jnode-template" data-jnode="task" data-jnode-class="jnode-task bdc-primary"><a id="Excel_ClearCells" href="javascript:;" style="margin-left:15px;"><i class="glyphicon glyphicon-remove-circle"></i><span style="margin-left:5px;">{% trans "Excel_ClearCells" %}</span></a></dd>
                    {% endif %}
                    {% if 'Draw_Process.views_sort_cells' in perms %}
                    <dd class="jnode-box2" data-template="jnode-template" data-jnode="task" data-jnode-class="jnode-task bdc-primary"><a id="Excel_SortCells" href="javascript:;" style="margin-left:15px;"><i class="fa fa-sort-amount-asc"></i><span style="margin-left:5px;">{% trans "Excel_SortCells" %}</span></a></dd>
                    {% endif %}
                    {% if 'Draw_Process.views_merge_cells' in perms %}
                    <dd class="jnode-box2" data-template="jnode-template" data-jnode="task" data-jnode-class="jnode-task bdc-primary"><a id="Excel_MergeCells" href="javascript:;" style="margin-left:15px;"><i class="fa fa-object-group"></i><span style="margin-left:5px;">{% trans "Excel_MergeCells" %}</span></a></dd>
                    {% endif %}
                    {% if 'Draw_Process.views_unmerge_cells' in perms %}
                    <dd class="jnode-box2" data-template="jnode-template" data-jnode="task" data-jnode-class="jnode-task bdc-primary"><a id="Excel_UnMergeCells" href="javascript:;" style="margin-left:15px;"><i class="fa fa-object-ungroup"></i><span style="margin-left:5px;">{% trans "Excel_UnMergeCells" %}</span></a></dd>
                    {% endif %}
                    {% if 'Draw_Process.views_excel_parse' in perms %}
                    <dd class="jnode-box2" data-template="jnode-template" data-jnode="task" data-jnode-class="jnode-task bdc-primary"><a id="Excel_Parse" href="javascript:;" style="margin-left:15px;"><i class="fa fa-object-ungroup"></i><span style="margin-left:5px;">{% trans "Excel_Parse" %}</span></a></dd>
                    {% endif %}
                    {% if 'Draw_Process.views_excel_remove_duplicates' in perms %}
                    <dd class="jnode-box2" data-template="jnode-template" data-jnode="task" data-jnode-class="jnode-task bdc-primary"><a id="Excel_RemoveDuplicates" href="javascript:;" style="margin-left:15px;"><i class="fa fa-trash-o"></i><span style="margin-left:5px;">{% trans "Excel_RemoveDuplicates" %}</span></a></dd>
                    {% endif %}
                    {% if 'Draw_Process.views_filter' in perms %}
                    <dd class="jnode-box2" data-template="jnode-template" data-jnode="task" data-jnode-class="jnode-task bdc-primary"><a id="Excel_Filter" href="javascript:;" style="margin-left:15px;"><i class="fa fa-filter"></i><span style="margin-left:5px;">{% trans "Excel_Filter" %}</span></a></dd>
                    {% endif %}
                    {% if 'Draw_Process.views_top_10' in perms %}
                    <dd class="jnode-box2" data-template="jnode-template" data-jnode="task" data-jnode-class="jnode-task bdc-primary"><a id="Excel_Top10" href="javascript:;" style="margin-left:15px;"><i class="fa fa-filter"></i><span style="margin-left:5px;">{% trans "Excel_Top10" %}</span></a></dd>
                    {% endif %}
                    {% if 'Draw_Process.views_format' in perms %}
                    <dd class="jnode-box2" data-template="jnode-template" data-jnode="task" data-jnode-class="jnode-task bdc-primary"><a id="Excel_Format" href="javascript:;" style="margin-left:15px;"><i class="fa fa-th"></i><span style="margin-left:5px;">{% trans "Excel_Format" %}</span></a></dd>
                    {% endif %}
                    {% if 'Draw_Process.views_excel_conditionalformat' in perms %}
                    <dd class="jnode-box2" data-template="jnode-template" data-jnode="task" data-jnode-class="jnode-task bdc-primary"><a id="Excel_ConditionalFormat" href="javascript:;" style="margin-left:15px;"><i class="fa fa-th"></i><span style="margin-left:5px;">{% trans "Excel_ConditionalFormat" %}</span></a></dd>
                    {% endif %}
                    {% if 'Draw_Process.views_excel_autofill' in perms %}
                    <dd class="jnode-box2" data-template="jnode-template" data-jnode="task" data-jnode-class="jnode-task bdc-primary"><a id="Excel_AutoFill" href="javascript:;" style="margin-left:15px;"><i class="fa fa-edit"></i><span style="margin-left:5px;">{% trans "Excel_AutoFill" %}</span></a></dd>
                    {% endif %}
                    {% if 'Draw_Process.views_image_cell' in perms %}
                    <dd class="jnode-box2" data-template="jnode-template" data-jnode="task" data-jnode-class="jnode-task bdc-primary"><a id="Excel_ImageCell" href="javascript:;" style="margin-left:15px;"><i class="fa fa-file-image-o"></i><span style="margin-left:5px;">{% trans "Excel_ImageCell" %}</span></a></dd>
                    {% endif %}
                    {% if 'Draw_Process.views_run_marco' in perms %}
                    <dd class="jnode-box2" data-template="jnode-template" data-jnode="task" data-jnode-class="jnode-task bdc-primary"><a id="Excel_RunMarco" href="javascript:;" style="margin-left:15px;"><i class="fa fa-file-code-o"></i><span style="margin-left:5px;">{% trans "Excel_RunMarco" %}</span></a></dd>
                    {% endif %}
                    {% if 'Draw_Process.views_show_level' in perms %}
                    <dd class="jnode-box2" data-template="jnode-template" data-jnode="task" data-jnode-class="jnode-task bdc-primary"><a id="Excel_ShowLevel" href="javascript:;" style="margin-left:15px;"><i class="fa fa-level-down"></i><span style="margin-left:5px;">{% trans "Excel_ShowLevel" %}</span></a></dd>
                    {% endif %}
                    {% if 'Draw_Process.views_excel_print' in perms %}
                    <dd class="jnode-box2" data-template="jnode-template" data-jnode="task" data-jnode-class="jnode-task bdc-primary"><a id="Excel_Print" href="javascript:;" style="margin-left:15px;"><i class="fa fa-print"></i><span style="margin-left:5px;">{% trans "Excel_Print" %}</span></a></dd>
                    {% endif %}
                    {% if 'Draw_Process.views_excel_updatechartseriesdata' in perms %}
                    <dd class="jnode-box2" data-template="jnode-template" data-jnode="task" data-jnode-class="jnode-task bdc-primary"><a id="Excel_UpdateChartSeriesData" href="javascript:;" style="margin-left:15px;"><i class="fa fa-print"></i><span style="margin-left:5px;">{% trans "Excel_UpdateChartSeriesData" %}</span></a></dd>
                    {% endif %}
                    {% if 'Draw_Process.views_excel_pivottable' in perms %}
                    <dd class="jnode-box2" data-template="jnode-template" data-jnode="task" data-jnode-class="jnode-task bdc-primary"><a id="Excel_PivotTable" href="javascript:;" style="margin-left:15px;"><i class="fa fa-print"></i><span style="margin-left:5px;">{% trans "Excel_PivotTable" %}</span></a></dd>
                    {% endif %}
                </dl>
            </li>
            {% endif %}
            {% if 'Draw_Process.views_file_module' in perms %}
            <li class="layui-nav-item">
                <a href="javascript:;" class="rpaMenu"><i class="fa fa-file-o" aria-hidden="true"></i><span class="functionMenu">{% trans "File Module" %}</span></a>
                <dl class="layui-nav-child">
                    {% if 'Draw_Process.views_new_folder' in perms %}
                    <dd class="jnode-box2" data-template="jnode-template" data-jnode="task" data-jnode-class="jnode-task bdc-primary"><a id="New_Folder" href="javascript:;" style="margin-left:15px;"><i class="fa fa-folder"></i><span style="margin-left:5px;">{% trans "New_Folder" %}</span></a></dd>
                    {% endif %}
                    {% if 'Draw_Process.views_open_folder' in perms %}
                    <dd class="jnode-box2" data-template="jnode-template" data-jnode="task" data-jnode-class="jnode-task bdc-primary"><a id="Open_Folder" href="javascript:;" style="margin-left:15px;"><i class="fa fa-folder-open"></i><span style="margin-left:5px;">{% trans "Open_Folder" %}</span></a></dd>
                    {% endif %}
                    {% if 'Draw_Process.views_copy_folder' in perms %}
                    <dd class="jnode-box2" data-template="jnode-template" data-jnode="task" data-jnode-class="jnode-task bdc-primary"><a id="Copy_Folder" href="javascript:;" style="margin-left:15px;"><i class="fa fa-copy"></i><span style="margin-left:5px;">{% trans "Copy_Folder" %}</span></a></dd>
                    {% endif %}
                    {% if 'Draw_Process.views_move_folder' in perms %}
                    <dd class="jnode-box2" data-template="jnode-template" data-jnode="task" data-jnode-class="jnode-task bdc-primary"><a id="Move_Folder" href="javascript:;" style="margin-left:15px;"><i class="glyphicon glyphicon-transfer"></i><span style="margin-left:5px;">{% trans "Move_Folder" %}</span></a></dd>
                    {% endif %}
                    {% if 'Draw_Process.views_delete_folder' in perms %}
                    <dd class="jnode-box2" data-template="jnode-template" data-jnode="task" data-jnode-class="jnode-task bdc-primary"><a id="Delete_Folder" href="javascript:;" style="margin-left:15px;"><i class="glyphicon glyphicon-remove-circle"></i><span style="margin-left:5px;">{% trans "Delete_Folder" %}</span></a></dd>
                    {% endif %}
                    {% if 'Draw_Process.views_read_folder' in perms %}
                    <dd class="jnode-box2" data-template="jnode-template" data-jnode="task" data-jnode-class="jnode-task bdc-primary"><a id="Read_Folder" href="javascript:;" style="margin-left:15px;"><i class="glyphicon glyphicon-list-alt"></i><span style="margin-left:5px;">{% trans "Read_Folder" %}</span></a></dd>
                    {% endif %}
                    {% if 'Draw_Process.views_folder_exist?' in perms %}
                    <dd class="jnode-box2" data-template="jnode-template" data-jnode="task" data-jnode-class="jnode-task bdc-primary"><a id="Folder_Exist?" href="javascript:;" style="margin-left:15px;"><i class="fa fa-question-circle"></i><span style="margin-left:5px;">{% trans "Folder_Exist?" %}</span></a></dd>
                    {% endif %}
                    {% if 'Draw_Process.views_new_file' in perms %}
                    <dd class="jnode-box2" data-template="jnode-template" data-jnode="task" data-jnode-class="jnode-task bdc-primary"><a id="New_File" href="javascript:;" style="margin-left:15px;"><i class="fa fa-file-text-o"></i><span style="margin-left:5px;">{% trans "New_File" %}</span></a></dd>
                    {% endif %}
                    {% if 'Draw_Process.views_open_file' in perms %}
                    <dd class="jnode-box2" data-template="jnode-template" data-jnode="task" data-jnode-class="jnode-task bdc-primary"><a id="Open_File" href="javascript:;" style="margin-left:15px;"><i class="fa fa-file-text"></i><span style="margin-left:5px;">{% trans "Open_File" %}</span></a></dd>
                    {% endif %}
                    {% if 'Draw_Process.views_copy_file' in perms %}
                    <dd class="jnode-box2" data-template="jnode-template" data-jnode="task" data-jnode-class="jnode-task bdc-primary"><a id="Copy_File" href="javascript:;" style="margin-left:15px;"><i class="fa fa-copy"></i><span style="margin-left:5px;">{% trans "Copy_File" %}</span></a></dd>
                    {% endif %}
                    {% if 'Draw_Process.views_move_file' in perms %}
                    <dd class="jnode-box2" data-template="jnode-template" data-jnode="task" data-jnode-class="jnode-task bdc-primary"><a id="Move_File" href="javascript:;" style="margin-left:15px;"><i class="glyphicon glyphicon-transfer"></i><span style="margin-left:5px;">{% trans "Move_File" %}</span></a></dd>
                    {% endif %}
                    {% if 'Draw_Process.views_delete_file' in perms %}
                    <dd class="jnode-box2" data-template="jnode-template" data-jnode="task" data-jnode-class="jnode-task bdc-primary"><a id="Delete_File" href="javascript:;" style="margin-left:15px;"><i class="glyphicon glyphicon-remove-circle"></i><span style="margin-left:5px;">{% trans "Delete_File" %}</span></a></dd>
                    {% endif %}
                    {% if 'Draw_Process.views_add_to_file' in perms %}
                    <dd class="jnode-box2" data-template="jnode-template" data-jnode="task" data-jnode-class="jnode-task bdc-primary"><a id="Add_to_File" href="javascript:;" style="margin-left:15px;"><i class="fa fa-pencil-square-o"></i><span style="margin-left:5px;">{% trans "Add_to_File" %}</span></a></dd>
                    {% endif %}
                    {% if 'Draw_Process.views_get_file_information' in perms %}
                    <dd class="jnode-box2" data-template="jnode-template" data-jnode="task" data-jnode-class="jnode-task bdc-primary"><a id="Get_File_Information" href="javascript:;" style="margin-left:15px;"><i class="fa fa-file-zip-o"></i><span style="margin-left:5px;">{% trans "Get_File_Information" %}</span></a></dd>
                    {% endif %}
                    {% if 'Draw_Process.views_get_file_content' in perms %}
                    <dd class="jnode-box2" data-template="jnode-template" data-jnode="task" data-jnode-class="jnode-task bdc-primary"><a id="Get_File_Content" href="javascript:;" style="margin-left:15px;"><i class="fa fa-file-text-o"></i><span style="margin-left:5px;">{% trans "Get_File_Content" %}</span></a></dd>
                    {% endif %}
                    {% if 'Draw_Process.views_file_exist?' in perms %}
                    <dd class="jnode-box2" data-template="jnode-template" data-jnode="task" data-jnode-class="jnode-task bdc-primary"><a id="File_Exist?" href="javascript:;" style="margin-left:15px;"><i class="fa fa-question-circle"></i><span style="margin-left:5px;">{% trans "File_Exist?" %}</span></a></dd>
                    {% endif %}
                    {% if 'Draw_Process.views_zip_file' in perms %}
                    <dd class="jnode-box2" data-template="jnode-template" data-jnode="task" data-jnode-class="jnode-task bdc-primary"><a id="Zip_File" href="javascript:;" style="margin-left:15px;"><i class="fa fa-compress"></i><span style="margin-left:5px;">{% trans "Zip_File" %}</span></a></dd>
                    {% endif %}
                    {% if 'Draw_Process.views_unzip_file' in perms %}
                    <dd class="jnode-box2" data-template="jnode-template" data-jnode="task" data-jnode-class="jnode-task bdc-primary"><a id="Unzip_File" href="javascript:;" style="margin-left:15px;"><i class="fa fa-compass"></i><span style="margin-left:5px;">{% trans "Unzip_File" %}</span></a></dd>
                    {% endif %}
                    {% if 'Draw_Process.views_run_bat' in perms %}
                    <dd class="jnode-box2" data-template="jnode-template" data-jnode="task" data-jnode-class="jnode-task bdc-primary"><a id="Run_Bat" href="javascript:;" style="margin-left:15px;"><i class="fa fa-code"></i><span style="margin-left:5px;">{% trans "Run_Bat" %}</span></a></dd>
                    {% endif %}
                </dl>
            </li>
            {% endif %}
            {% if 'Draw_Process.views_access_module' in perms %}
            <li class="layui-nav-item">
                <a href="javascript:;" class="rpaMenu"><i class="fa fa-database" aria-hidden="true"></i><span class="functionMenu">{% trans "Access Module" %}</span></a>
                <dl class="layui-nav-child">
                    {% if 'Draw_Process.views_insert_sql' in perms %}
                    <dd class="jnode-box2" data-template="jnode-template" data-jnode="task" data-jnode-class="jnode-task bdc-primary"><a id="Insert_SQL" href="javascript:;" style="margin-left:15px;"><i class="fa fa-search-plus"></i><span style="margin-left:5px;">{% trans "Insert_SQL" %}</span></a></dd>
                    {% endif %}
                    {% if 'Draw_Process.views_update_sql' in perms %}
                    <dd class="jnode-box2" data-template="jnode-template" data-jnode="task" data-jnode-class="jnode-task bdc-primary"><a id="Update_SQL" href="javascript:;" style="margin-left:15px;"><i class="fa fa-search"></i><span style="margin-left:5px;">{% trans "Update_SQL" %}</span></a></dd>
                    {% endif %}
                    {% if 'Draw_Process.views_delete_sql' in perms %}
                    <dd class="jnode-box2" data-template="jnode-template" data-jnode="task" data-jnode-class="jnode-task bdc-primary"><a id="Delete_SQL" href="javascript:;" style="margin-left:15px;"><i class="fa fa-search-minus"></i><span style="margin-left:5px;">{% trans "Delete_SQL" %}</span></a></dd>
                    {% endif %}
                    {% if 'Draw_Process.views_select_sql' in perms %}
                    <dd class="jnode-box2" data-template="jnode-template" data-jnode="task" data-jnode-class="jnode-task bdc-primary"><a id="Select_SQL" href="javascript:;" style="margin-left:15px;"><i class="fa fa-search"></i><span style="margin-left:5px;">{% trans "Select_SQL" %}</span></a></dd>
                    {% endif %}
                    {% if 'Draw_Process.views_custom_sql' in perms %}
                    <dd class="jnode-box2" data-template="jnode-template" data-jnode="task" data-jnode-class="jnode-task bdc-primary"><a id="Custom_SQL" href="javascript:;" style="margin-left:15px;"><i class="fa fa-pencil-square-o"></i><span style="margin-left:5px;">{% trans "Custom_SQL" %}</span></a></dd>
                    {% endif %}
                </dl>
            </li>
            {% endif %}
            {% if 'Draw_Process.views_web_module' in perms %}
            <li class="layui-nav-item">
                <a href="javascript:;" class="rpaMenu"><i class="fa fa-internet-explorer" aria-hidden="true"></i><span class="functionMenu">{% trans "Web Module" %}</span></a>
                <dl class="layui-nav-child">
<!--                    {% if 'Draw_Process.views_web_upload' in perms %}-->
<!--                    <dd class="jnode-box2" data-template="jnode-template" data-jnode="task" data-jnode-class="jnode-task bdc-primary"><a id="Web_FileUpload" href="javascript:;" style="margin-left:15px;"><i class="fa fa-cloud-download"></i><span style="margin-left:5px;">{% trans "Web_FileUpload" %}</span></a></dd>-->
<!--                    {% endif %}-->
                    {% if 'Draw_Process.views_start_browser' in perms %}
                    <dd class="jnode-box2" data-template="jnode-template" data-jnode="task" data-jnode-class="jnode-task bdc-primary"><a id="Web_StartBrowser" href="javascript:;" style="margin-left:15px;"><i class="fa fa-play"></i><span style="margin-left:5px;">{% trans "Web_StartBrowser" %}</span></a></dd>
                    {% endif %}
                    {% if 'Draw_Process.views_reuse_browser' in perms %}
                    <dd class="jnode-box2" data-template="jnode-template" data-jnode="task" data-jnode-class="jnode-task bdc-primary"><a id="Web_ReuseBrowser" href="javascript:;" style="margin-left:15px;"><i class="icon-control-play"></i><span style="margin-left:5px;">{% trans "Web_ReuseBrowser" %}</span></a></dd>
                    {% endif %}
                    {% if 'Draw_Process.views_switch_to_window' in perms %}
                    <dd class="jnode-box2" data-template="jnode-template" data-jnode="task" data-jnode-class="jnode-task bdc-primary"><a id="Web_SwitchToWindow" href="javascript:;" style="margin-left:15px;"><i class="fa fa-exchange"></i><span style="margin-left:5px;">{% trans "Web_SwitchToWindow" %}</span></a></dd>
                    {% endif %}
                    {% if 'Draw_Process.views_web_mouseover' in perms %}
                    <dd class="jnode-box2" data-template="jnode-template" data-jnode="task" data-jnode-class="jnode-task bdc-primary"><a id="Web_Mouseover" href="javascript:;" style="margin-left:15px;"><i class="icon-location-pin"></i><span style="margin-left:5px;">{% trans "Web_Mouseover" %}</span></a></dd>
                    {% endif %}
                    {% if 'Draw_Process.views_click_element' in perms %}
                    <dd class="jnode-box2" data-template="jnode-template" data-jnode="task" data-jnode-class="jnode-task bdc-primary"><a id="Web_ClickElement" href="javascript:;" style="margin-left:15px;"><i class="icon-location-pin"></i><span style="margin-left:5px;">{% trans "Web_ClickElement" %}</span></a></dd>
                    {% endif %}
                    {% if 'Draw_Process.views_send_keys' in perms %}
                    <dd class="jnode-box2" data-template="jnode-template" data-jnode="task" data-jnode-class="jnode-task bdc-primary"><a id="Web_SendKeys" href="javascript:;" style="margin-left:15px;"><i class="icon-location-pin"></i><span style="margin-left:5px;">{% trans "Web_SendKeys" %}</span></a></dd>
                    {% endif %}
                    {% if 'Draw_Process.views_set_text' in perms %}
                    <dd class="jnode-box2" data-template="jnode-template" data-jnode="task" data-jnode-class="jnode-task bdc-primary"><a id="Web_SetText" href="javascript:;" style="margin-left:15px;"><i class="fa fa-underline"></i><span style="margin-left:5px;">{% trans "Web_SetText" %}</span></a></dd>
                    {% endif %}
                    {% if 'Draw_Process.views_get_text' in perms %}
                    <dd class="jnode-box2" data-template="jnode-template" data-jnode="task" data-jnode-class="jnode-task bdc-primary"><a id="Web_GetText" href="javascript:;" style="margin-left:15px;"><i class="fa fa-file-text-o"></i><span style="margin-left:5px;">{% trans "Web_GetText" %}</span></a></dd>
                    {% endif %}
                    {% if 'Draw_Process.views_web_crawlinformation' in perms %}
                    <dd class="jnode-box2" data-template="jnode-template" data-jnode="task" data-jnode-class="jnode-task bdc-primary"><a id="Web_CrawlInformation" href="javascript:;" style="margin-left:15px;"><i class="fa fa-list-alt"></i><span style="margin-left:5px;">{% trans "Web_CrawlInformation" %}</span></a></dd>
                    {% endif %}
                    {% if 'Draw_Process.views_web_select' in perms %}
                    <dd class="jnode-box2" data-template="jnode-template" data-jnode="task" data-jnode-class="jnode-task bdc-primary"><a id="Web_Select" href="javascript:;" style="margin-left:15px;"><i class="icon-location-pin"></i><span style="margin-left:5px;">{% trans "Web_Select" %}</span></a></dd>
                    {% endif %}
                    {% if 'Draw_Process.views_get_attribute' in perms %}
                    <dd class="jnode-box2" data-template="jnode-template" data-jnode="task" data-jnode-class="jnode-task bdc-primary"><a id="Web_GetAttribute" href="javascript:;" style="margin-left:15px;"><i class="fa fa-leaf"></i><span style="margin-left:5px;">{% trans "Web_GetAttribute" %}</span></a></dd>
                    {% endif %}
                    {% if 'Draw_Process.views_element_exist?' in perms %}
                    <dd class="jnode-box2" data-template="jnode-template" data-jnode="task" data-jnode-class="jnode-task bdc-primary"><a id="Web_ElementExist?" href="javascript:;" style="margin-left:15px;"><i class="fa fa-question-circle"></i><span style="margin-left:5px;">{% trans "Web_ElementExist?" %}</span></a></dd>
                    {% endif %}
                    {% if 'Draw_Process.views_web_dragging' in perms %}
                    <dd class="jnode-box2" data-template="jnode-template" data-jnode="judge" data-jnode-class="jnode-task bdc-primary"><a id="Web_Dragging" href="javascript:;" style="margin-left:15px;"><i class="fa fa-hand-o-up"></i><span style="margin-left:5px;">{% trans "Web_Dragging" %}</span></a></dd>
                    {% endif %}
                    {% if 'Draw_Process.views_forward' in perms %}
                    <dd class="jnode-box2" data-template="jnode-template" data-jnode="task" data-jnode-class="jnode-task bdc-primary"><a id="Web_Forward" href="javascript:;" style="margin-left:15px;"><i class="fa fa-arrow-right"></i><span style="margin-left:5px;">{% trans "Web_Forward" %}</span></a></dd>
                    {% endif %}
                    {% if 'Draw_Process.views_back' in perms %}
                    <dd class="jnode-box2" data-template="jnode-template" data-jnode="task" data-jnode-class="jnode-task bdc-primary"><a id="Web_Back" href="javascript:;" style="margin-left:15px;"><i class="fa fa-arrow-left"></i><span style="margin-left:5px;">{% trans "Web_Back" %}</span></a></dd>
                    {% endif %}
                    {% if 'Draw_Process.views_refresh' in perms %}
                    <dd class="jnode-box2" data-template="jnode-template" data-jnode="task" data-jnode-class="jnode-task bdc-primary"><a id="Web_Refresh" href="javascript:;" style="margin-left:15px;"><i class="fa fa-refresh"></i><span style="margin-left:5px;">{% trans "Web_Refresh" %}</span></a></dd>
                    {% endif %}
                    {% if 'Draw_Process.views_close' in perms %}
                    <dd class="jnode-box2" data-template="jnode-template" data-jnode="task" data-jnode-class="jnode-task bdc-primary"><a id="Web_Close" href="javascript:;" style="margin-left:15px;"><i class="fa fa-close"></i><span style="margin-left:5px;">{% trans "Web_Close" %}</span></a></dd>
                    {% endif %}
                    {% if 'Draw_Process.views_quit' in perms %}
                    <dd class="jnode-box2" data-template="jnode-template" data-jnode="task" data-jnode-class="jnode-task bdc-primary"><a id="Web_Quit" href="javascript:;" style="margin-left:15px;"><i class="fa fa-sign-out"></i><span style="margin-left:5px;">{% trans "Web_Quit" %}</span></a></dd>
                    {% endif %}
                    {% if 'Draw_Process.views_run_script' in perms %}
                    <dd class="jnode-box2" data-template="jnode-template" data-jnode="task" data-jnode-class="jnode-task bdc-primary"><a id="Web_RunJSCode" href="javascript:;" style="margin-left:15px;"><i class="fa fa-code"></i><span style="margin-left:5px;">{% trans "Web_RunJSCode" %}</span></a></dd>
                    {% endif %}
                </dl>
            </li>
            {% endif %}
            {% if 'Draw_Process.views_mail' in perms %}
            <li class="layui-nav-item">
                <a href="javascript:;" class="rpaMenu"><i class="fa fa-envelope" aria-hidden="true"></i><span class="functionMenu">{% trans "Mail Module" %}</span></a>
                <dl class="layui-nav-child">
                    {% if 'Draw_Process.views_read_mail' in perms %}
                    <dd class="jnode-box2" data-template="jnode-template" data-jnode="task" data-jnode-class="jnode-task bdc-primary"><a id="Read_Mail" href="javascript:;" style="margin-left:15px;"><i class="icon-envelope-letter"></i><span style="margin-left:5px;">{% trans "Read_Mail" %}</span></a></dd>
                    {% endif %}
                    {% if 'Draw_Process.views_send_mail' in perms %}
                    <dd class="jnode-box2" data-template="jnode-template" data-jnode="task" data-jnode-class="jnode-task bdc-primary"><a id="Send_Mail" href="javascript:;" style="margin-left:15px;"><i class="icon-envelope-open"></i><span style="margin-left:5px;">{% trans "Send_Mail" %}</span></a></dd>
                    {% endif %}
                </dl>
            </li>
            {% endif %}
            {% if 'Draw_Process.views_hci_module' in perms %}
            <li class="layui-nav-item">
                <a href="javascript:;" class="rpaMenu"><i class="fa fa-television" aria-hidden="true"></i><span class="functionMenu">{% trans "HCI Module" %}</span></a>
                <dl class="layui-nav-child">
                    {% if 'Draw_Process.views_hci_confirm' in perms %}
                    <dd class="jnode-box2" data-template="jnode-template" data-jnode="task" data-jnode-class="jnode-task bdc-primary"><a id="HCI_Confirm" href="javascript:;" style="margin-left:15px;"><i class="fa fa-check-circle-o"></i><span style="margin-left:5px;">{% trans "HCI_Confirm" %}</span></a></dd>
                    {% endif %}
                    {% if 'Draw_Process.views_hci_input' in perms %}
                    <dd class="jnode-box2" data-template="jnode-template" data-jnode="task" data-jnode-class="jnode-task bdc-primary"><a id="HCI_Input" href="javascript:;" style="margin-left:15px;"><i class="fa fa-keyboard-o"></i><span style="margin-left:5px;">{% trans "HCI_Input" %}</span></a></dd>
                    {% endif %}
                </dl>
            </li>
            {% endif %}
            {% if 'Draw_Process.views_ai_module' in perms %}
            <li class="layui-nav-item">
                <a href="javascript:;" class="rpaMenu"><i class="fa fa-eye" aria-hidden="true"></i><span class="functionMenu">{% trans "AI Module" %}</span></a>
                <dl class="layui-nav-child">
                    {% if 'Draw_Process.views_unlockwindow' in perms %}
                    <dd class="jnode-box2" data-template="jnode-template" data-jnode="judge" data-jnode-class="jnode-task bdc-primary"><a id="Unlockwindow" href="javascript:;" style="margin-left:15px;"><i class="fa fa-desktop"></i><span style="margin-left:5px;">{% trans "Unlockwindow" %}</span></a></dd>
                    {% endif %}
                    {% if 'Draw_Process.views_picture_shot_coordinate' in perms %}
                    <dd class="jnode-box2" data-template="jnode-template" data-jnode="judge" data-jnode-class="jnode-task bdc-primary"><a id="Picture_Shot_Coordinate" href="javascript:;" style="margin-left:15px;"><i class="icon-screen-desktop"></i><span style="margin-left:5px;">{% trans "Picture_Shot_Coordinate" %}</span></a></dd>
                    {% endif %}
                    {% if 'Draw_Process.views_picture_shot_handle' in perms %}
                    <dd class="jnode-box2" data-template="jnode-template" data-jnode="judge" data-jnode-class="jnode-task bdc-primary"><a id="Picture_Shot_Handle" href="javascript:;" style="margin-left:15px;"><i class="icon-screen-desktop"></i><span style="margin-left:5px;">{% trans "Picture_Shot_Handle" %}</span></a></dd>
                    {% endif %}
                    {% if 'Draw_Process.views_picture_shot_web' in perms %}
                    <dd class="jnode-box2" data-template="jnode-template" data-jnode="judge" data-jnode-class="jnode-task bdc-primary"><a id="Picture_Shot_Web" href="javascript:;" style="margin-left:15px;"><i class="icon-screen-desktop"></i><span style="margin-left:5px;">{% trans "Picture_Shot_Web" %}</span></a></dd>
                    {% endif %}
                    {% if 'Draw_Process.views_verification_code_recognition' in perms %}
                    <dd class="jnode-box2" data-template="jnode-template" data-jnode="judge" data-jnode-class="jnode-task bdc-primary"><a id="Verification_Code_Recognition" href="javascript:;" style="margin-left:15px;"><i class="fa fa-question-circle"></i><span style="margin-left:5px;">{% trans "Verification_Code_Recognition" %}</span></a></dd>
                    {% endif %}
                    {% if 'Draw_Process.views_ocr' in perms %}
                    <dd class="jnode-box2" data-template="jnode-template" data-jnode="judge" data-jnode-class="jnode-task bdc-primary"><a id="OCR" href="javascript:;" style="margin-left:15px;"><i class="fa fa-font"></i><span style="margin-left:5px;">{% trans "OCR" %}</span></a></dd>
                    {% endif %}
                </dl>
            </li>
            {% endif %}
            {% if 'Draw_Process.views_self_development' in perms %}
            <li class="layui-nav-item">
                <a href="javascript:;" class="rpaMenu"><i class="fa fa-code" aria-hidden="true"></i><span class="functionMenu">{% trans "Self Development" %}</span></a>
                <dl class="layui-nav-child">

                    {% if 'Draw_Process.views_python_code' in perms %}
                    <dd class="jnode-box2" data-template="jnode-template" data-jnode="task" data-jnode-class="jnode-task bdc-primary"><a id="Python_Code" href="javascript:;" style="margin-left:15px;"><i class="fa fa-code"></i><span style="margin-left:5px;">{% trans "Python_Code" %}</span></a></dd>
                    {% endif %}
                    {% if 'Draw_Process.views_python_file' in perms %}
                    <dd class="jnode-box2" data-template="jnode-template" data-jnode="task" data-jnode-class="jnode-task bdc-primary"><a id="Python_File" href="javascript:;" style="margin-left:15px;"><i class="fa fa-file"></i><span style="margin-left:5px;">{% trans "Python_File" %}</span></a></dd>
                    {% endif %}
                </dl>
            </li>
            {% endif %}
        </ul>
    </div>
    <div data-options="region:'center',iconCls:'icon-ok'">
        <div id="tt" class="easyui-tabs" data-options="fit:true,tools:'#tab-tools'" style="padding: 0px;">
            <div id="codes_area" title='{% trans "View Codes" %}'><table class="layui-hide" id="codes_table" data-options="fit:true"></table></div>
            <div id="process-area" title="{% trans 'Flow' %}" data-options="footer:'#ft'">
                <div class="bg-success ui-droppable" id="diagramContainer-main" style="height:100%;width:100%;overflow:auto;position:relative;">
                    <input id="screen_size" style="display:none;" value="100"/>
                    <input id="font_size" style="display:none;" value="10"/>
                    <input id="line_height" style="display:none;" value="45"/>
                    <input id="icon_left" style="display:none;" value="10"/>
                    <input id="icon_right" style="display:none;" value="10"/>
                    <input id="icon_top" style="display:none;" value="33"/>
                    <input name="select_file" id="selectfile" style="display:none;"/>
                    <input name="browser_mode" id="browser_mode" style="display:none;" value="Chrome"/>
                    <input id="error_line" style="display:none;"/>
                    <script type="text/x-mustache" id="jnode-template">
					    <div class="jnode-panel" id="{{id}}" style="top:{{top}}px;left:{{left}}px">
						    <div class="jnode-box {{jnodeClass}}">{{jnodeHtml}}</div>
					    </div>
				    </script>
                </div>
            </div>
        </div>
    </div>
    <div id="tab-tools">
		<a href="javascript:void(0)" class="easyui-linkbutton" data-options="plain:true,iconCls:'icon-add'" onclick="addPanel('')"></a>
		<a href="javascript:void(0)" class="easyui-linkbutton" data-options="plain:true,iconCls:'icon-remove'" onclick="removePanel()"></a>
        {% if 'Draw_Process.views_menu_file_save' in perms %}<a href="javascript:void(0)" class="easyui-linkbutton" data-options="plain:true,iconCls:'icon-save'" onclick="quickSaving('save')"></a>{% endif %}
	</div>
    <div id="content_list" class="easyui-menu" style="width:120px;">
        {% if 'Draw_Process.views_menu_execute_run' in perms %}<div data-options="iconCls:'icon-computer-start'" onclick="before_run('own')">{% trans "Run" %}</div>{% endif %}
        {% if 'Draw_Process.views_menu_view_clear' in perms %}<div data-options="iconCls:'icon-remove'" onclick="clean()">{% trans "Clear" %}</div>{% endif %}
		{% if 'Draw_Process.views_menu_view_rearrange' in perms %}<div data-options="iconCls:'icon-text-list-numbers'" onclick="rearrangement()">{% trans "Rearrange" %}</div>{% endif %}
        {% if 'Draw_Process.views_menu_file_save' in perms %}<div data-options="name:'save',iconCls:'icon-accept-save'" onclick="quickSaving('save')">{% trans "Save" %}</div>{% endif %}
        {% if 'Draw_Process.views_menu_file_save' in perms %}<div id="saveAsBtn" data-options="name:'save',iconCls:'icon-go-save'" onclick="quickSaving('saveAs')">{% trans "Save As" %}</div>{% endif %}
        {% if 'Draw_Process.views_menu_view_group' in perms %}<div data-options="iconCls:'icon-flow-group'" onclick="group()">{% trans "Group" %}</div>{% endif %}
        <div data-options="iconCls:'icon-cancel-select'" onclick="cancelSelect()">{% trans "Cancel Select" %}</div>
        <div data-options="iconCls:'icon-tab-add'" onclick="addPanel('')">{% trans "Add Tab" %}</div>
        <div data-options="iconCls:'icon-tab-delete'" onclick="removePanel()">{% trans "Close Tab" %}</div>
        <div class="menu-sep"></div>
        <div data-options="iconCls:'icon-screen-size'">
            <span>{% trans "Screen Size" %}</span>
            <div>
                <div data-options="iconCls:'icon-arrow-in-longer'" onclick="adjScr(70)">70%</div>
                <div data-options="iconCls:'icon-arrow-in-longer'" onclick="adjScr(80)">80%</div>
                <div data-options="iconCls:'icon-arrow-in-longer'" onclick="adjScr(90)">90%</div>
                <div data-options="iconCls:'icon-arrow-redo'" onclick="adjScr(100)">100%</div>
                <div data-options="iconCls:'icon-arrow-out-longer'" onclick="adjScr(110)">110%</div>
                <div data-options="iconCls:'icon-arrow-out-longer'" onclick="adjScr(120)">120%</div>
            </div>
        </div>
	</div>
    <div id="ft" style="padding:0px 5px;height:18px;">
        <div class="layui-row">
            <div class="layui-input-inline">
                <div id="slide" class="demo-slider" style="margin-left:5px;width:200px;max-width:300px;"></div>
            </div>
            <label id="slider_input" class="layui-label slider-label layui-disabled">100%</label>
            <label id="file_path_label" class="layui-label slider-label" style="color: #000000 !important;"></label>
            <label id="current_browser" class="layui-label slider-label" style="color: #000000 !important;"></label>
            <div class="layui-inline">
                <form class="layui-form" action="" style="width:50px;right:15px;position:fixed;margin-top:-10px;">
                    <input id="sb" type="checkbox" lay-skin="switch" lay-filter="switchStatus" lay-text="ON|OFF">
                </form>
            </div>
        </div>
    </div>
	<script type="text/javascript">
		function addPanel(title){
		    var tabs=$('#tt').tabs('tabs');
		    if (tabs.length == 5){
		        layer.msg('{% trans "Maximum Tabs" %}', {
                  offset: 't',
                });
                return false;
		    }
			tabs_index++;
			var ft = '<div id="ft'+tabs_index+'" style="padding:0px 5px;height:18px;">'
			        +'<div class="layui-row">'
			        +'<div class="layui-input-inline">'
                    +'<div id="slide'+tabs_index+'" class="demo-slider" style="margin-left:5px;width:200px;max-width:300px;"></div>'
                    +'</div>'
                    +'<label id="slider_input'+tabs_index+'" class="layui-label slider-label layui-disabled">100%</label>'
                    +'<label id="file_path_label'+tabs_index+'" class="layui-label slider-label" style="color: #000000 !important;"></label>'
                    +'<label id="current_browser'+tabs_index+'" class="layui-label slider-label" style="color: #000000 !important;"></label>'
                    +'<div class="layui-inline"><form class="layui-form" action="" style="width:50px;right:15px;position:fixed;margin-top:-10px;"><input id="sb'+tabs_index+'" type="checkbox" lay-skin="switch" lay-filter="switchStatus" lay-text="ON|OFF"></form></div>'
                    +'</div></div>'
			$("#ft").after(ft);
			var content = '<div class="bg-success ui-droppable" id="diagramContainer-main' + tabs_index + '" style="height:100%;width:100%;overflow:auto;position:relative;">'
			            +'<input id="screen_size' + tabs_index + '" style="display:none;" value="100"/>'
			            +'<input id="font_size' + tabs_index + '" style="display:none;" value="10"/>'
                        +'<input id="line_height' + tabs_index + '" style="display:none;" value="45"/>'
                        +'<input id="icon_left' + tabs_index + '" style="display:none;" value="10"/>'
                        +'<input id="icon_right' + tabs_index + '" style="display:none;" value="10"/>'
                        +'<input id="icon_top' + tabs_index + '" style="display:none;" value="33"/>'
                        +'<input name="select_file" id="selectfile' + tabs_index + '" style="display:none;"/>'
                        +'<input name="browser_mode" id="browser_mode' + tabs_index + '" style="display:none;" value="Chrome"/>'
                        +'<input id="error_line' + tabs_index + '" style="display:none;"/>'
			            +'<script type="text/x-mustache" id="jnode-template"><div class="jnode-panel" id="{{id}}" style="top:{{top}}px;left:{{left}}px">'
                        + '<div class="jnode-box {{jnodeClass}}">{{jnodeHtml}}</div></div></'+'script></div>';
			var tab_title = '';
			if (title == "" || title == null){
			    tab_title = '{% trans "Flow" %}' + tabs_index.toString();
			}else{
			    tab_title = title;
			}
			var exist_tabs = $("#tt").tabs().tabs('tabs');
            for (var i = 0; i < exist_tabs.length; i++) {
                var exist_title = exist_tabs[i].panel('options').title;
                if (exist_title == tab_title){
                    tab_title = tab_title + ' (2)';
                }
            }
			$('#tt').tabs('add',{
			    id: 'process-area' + tabs_index.toString(),
				title: tab_title,
				content: content,
				closable: true,
				footer: '#ft' + tabs_index.toString(),
				padding: "0px;",
			});
			layui.use('slider', function(){
                var $ = layui.$
                ,slider = layui.slider;
                var ins2 = slider.render({
                    elem: '#slide' + tabs_index.toString()
                    ,step: 10
                    ,showstep: true
                    ,value: 100
                    ,min: 70
                    ,max: 120
                    ,tips: false
                    ,change: function(vals){
                        var tab_index = getActiveTab();
                        var org_size = parseInt($('#screen_size' + tab_index.toString()).val());
                        if (vals != org_size){
                            $('#screen_size' + tab_index.toString()).val(vals);
                            $('#slider_input' + tab_index.toString()).text(vals+'%');
                            layer.msg('{% trans "Screen Size" %}: ' + vals.toString() + "%", {
                                offset: 't',
                            });
                            adjScreen(org_size,vals);
                        }
                    }
                })
            })
            layui.use(['form'], function(){
                var form = layui.form;
                layer = layui.layer;
                $ = layui.$;
                form.render('checkbox');
            })
			$("#new_page_tab").val("yes");
			$('#tt').tabs("select", tab_title);
			reloadJS("jvisio","../static/javascript/jvisio-flow/jvisio-index2.js");
			var tabs = $("#tt").tabs().tabs('tabs');
            var new_title = "";
            for (var i = 0; i < tabs.length; i++) {
                tabs[i].panel('options').tab.unbind().bind('click', { index: i }, function (e) {
                    new_title = ($(this).find(".tabs-title").html());
                    var current_tab = getActiveTab();
                    process_index = current_tab;
                    if(new_title != '{% trans "View Codes" %}'){
                        $(".selected_tab").removeClass("selected_tab");
			            reloadJS("jvisio","../static/javascript/jvisio-flow/jvisio-index2.js");
                    }else{
                        $(".tabs-selected").find("span:eq(0)").addClass("selected_tab");
                        var connections = getConnections();
                        if (connections.length > 0){
                            layer.load(2);
                            layui.use('table', function(){
                                var table = layui.table;
                                table.render({
                                    elem: '#codes_table'
                                    ,skin: 'nob'
                                    ,url: '../getcodes/'
                                    ,method: 'post'
                                    ,where: {"connections":JSON.stringify(connections)}
                                    ,cellMinWidth: 20
                                    ,id: 'codeTable'
                                    ,cols: [[
                                        {field:'id', width:20, title: 'ID', hide: true},
                                        {field:'code', title: 'Code'}
                                    ]]
                                    ,done: function(res, curr, count){
                                        layer.closeAll('loading');
                                        var line = $("#error_line" + current_tab).val();
                                        if (line > 0){
                                            $("tr[data-index='" + line + "']").attr({"style":"color:red;background:yellow;"});
                                        }
                                    }
                                });
                            });
                            $('th').hide();
                        } else{
                            layui.use('table',function() {
                                var table = layui.table;
                                 table.reload('codeTable',{
                                    data: [],
                                    url: '',
                                });
                            });
                            $('th').hide();
                        }
                    }
                });
            }
            $('#tt').tabs({
                onSelect: function(title, index) {  
                    var tab_index = getActiveTab();
                    var selectfile = $("#selectfile" + tab_index.toString()).val();
                    try{
                        if (selectfile == ""){
                            changeSaveAsStatus("disable");
                        }else{
                            changeSaveAsStatus("show");
                        }
                    }catch(err){
                        console.log(err);
                    }
                },
                // 增加关闭tab页前的提示确认框
                onBeforeClose: function(title,index){
                    var target = this;
                    var tab_index = getActiveTab();
                    var divs = $('#process-area'+ tab_index.toString()).find('.jnode-box');
                    var exist_select_isture = -1
                    for (var i=0;i<div_selection_list.length;i++) {
                        var val = div_selection_list[i];
                        var areaId_Inner = "#diagramContainer-main" + tab_index;
                        var div_length = $(areaId_Inner + " div[id='" + val + "']").length;
                        // 当前tab页存在选中元素
                        if (div_length > 0){
                            exist_select_isture = -1
                        }else{
                            exist_select_isture = 0
                            break
                        }
                    }
                    if (divs.length > 0){
                        layer.confirm('{% trans "Are you sure to delete this tab without saving" %}?', {
                            title:'{% trans "Confirmation" %}',
                            btn: ['{% trans "Yes" %}', '{% trans "No" %}'],
                            btn1:function(tab_index){
                                layer.close(tab_index);
                                var opts = $(target).tabs('options');
                                var bc = opts.onBeforeClose;
                                opts.onBeforeClose = function(){};
                                $(target).tabs('close',index);
                                opts.onBeforeClose = bc;
<!--                            //关闭tab页时候，如果当前页面存在选中元素，则清空selectlist-->
                                if (exist_select_isture == -1){
                                    div_selection_list = new Array;
                                }
                                reloadJS("jvisio","../static/javascript/jvisio-flow/jvisio-index2.js");
                            },
                            btn2:function(tab_index,layero){
                                layer.close(tab_index);
                            }
                        });
                        return false;

                    }else{
                        reloadJS("jvisio","../static/javascript/jvisio-flow/jvisio-index2.js");
                    }
                }
            });
            $('#tt').tabs("select", tab_title);
		}
		function removePanel(){
			var tab = $('#tt').tabs('getSelected');
			if (tab){
				var index = $('#tt').tabs('getTabIndex', tab);
				if (index > 1){
                    var tab_index = getActiveTab();
                    var divs = $('#process-area'+ tab_index.toString()).find('.jnode-box');
                    if (divs.length > 0){
                        $('#tt').tabs('close', index);
                        var tabs = $("#tt").tabs().tabs('tabs');
                        var last_tab = $('#tt').tabs('getTab',tabs.length-1).panel('options').title;
                        if (last_tab == "View Codes"){
                            last_tab = "Flow";
                        }
                        $('#tt').tabs("select", last_tab);
                    }else{
                        $('#tt').tabs('close', index);
                        var tabs = $("#tt").tabs().tabs('tabs');
                        var last_tab = $('#tt').tabs('getTab',tabs.length-1).panel('options').title;
                        if (last_tab == "View Codes"){
                            last_tab = "Flow";
                        }
                        $('#tt').tabs("select", last_tab);
                    }
				}else{
				    layer.msg('{% trans "Not Allowed" %}',{
				        time: 1000,
				        offset: 't',
				    });
				}
			}
		}
	</script>
    <form id="import_form" enctype="multipart/form-data" action="../uploadprocess/" method="post" style="display:none;">
        {% csrf_token %}
        <input type="file" id="myfile" name="myfile" onchange="importfile()"/>
    </form>
</div>


<script type="text/javascript" src="{% url 'javascript-catalog' %}"></script>
<script src="../static/javascript/jvisio-flow/lib/jquery/jquery.min.js"></script>
<script type="text/javascript" src="../static/javascript/EasyUI/jquery.easyui.min.js"></script>
<!--<script type="text/javascript" src="../static/javascript/jvisio-flow/lib/jquery/jquery.min.js"></script>-->
<script src="../static/javascript/jvisio-flow/lib/uuid.min.js"></script>
<script src="../static/javascript/jvisio-flow/lib/mustache.min.js"></script>
<script id="jqueryUi"  src="../static/javascript/jvisio-flow/lib/jqueryui/jquery-ui.min.adj.js"></script>
<script src="../static/javascript/jvisio-flow/lib/jquery.jsPlumbAdjust-1.7.2.js"></script>
<script src="../static/javascript/jvisio-flow/jvisio-config.js"></script>
<script id="layui" src="../static/javascript/layer/layui.all.js"></script>
<script src="../static/javascript/layer/layer.js"></script>
<script src="../static/javascript/jvisio-flow/index.js"></script>
<script src="../static/javascript/jvisio-flow/json2.js"></script>
<script src="../static/javascript/colorpicker.js"></script>
<script src="../static/javascript/createTools4.js"></script>
<script src="../static/javascript/ySelect.js"></script>
<script id="jvisio" src="../static/javascript/jvisio-flow/jvisio-index2.js"></script>
<script src="../static/javascript/jvisio-flow/jvisio-action.js"></script>
<script>
    var rtime;
    var timeout = false;
    var delta = 200;
    $(window).resize(function() {
        rtime = new Date();
        if (timeout === false) {
            timeout = true;
            setTimeout(resizeend, delta);
        }
    });
    function resizeend() {
        if (new Date() - rtime < delta) {
            setTimeout(resizeend, delta);
        } else {
            timeout = false;
            var header = document.getElementById("cc").firstElementChild.firstElementChild.firstElementChild.firstElementChild;
            var headerWidth = header.clientWidth||header.offsetWidth;
            var parent = header.parentElement;
            var parentWidth = parent.clientWidth||parent.offsetWidth;
            header.style.width = parentWidth + "px";
            var ele = document.getElementById("settingPage");
            if (ele){
                var div = ele.parentElement;
                var height = $("#process-area").height() + 'px';
                div.style.overflow = 'auto';
                div.style.height = height;
            }
        }
    }
	$(function(){
	    //adjust search style
	    try{
            var ele = document.getElementById("diagramContainer-left");
            ele.children[0].className = ele.children[0].className + " search-adj";
            ele.children[0].style.border = "0px";
            ele.children[0].style.position = "absolute";
            ele.children[0].children[0].className = ele.children[0].children[0].className + " search-adj";
            ele.children[0].children[0].style.padding = "0px 1px 0px 0px";
            ele.children[0].children[0].children[1].className = ele.children[0].children[0].children[1].className + " search-adj";
        }catch(err){
            console.log(err);
        }
	    if ("WebSocket" in window) {
            // 打开一个 web socket
            createWs();
        } else {
            // 浏览器不支持 WebSocket
            alert("您的浏览器不支持 WebSocket!");
        }
        var days = "{{ day }}";
        var version = "{{ version }}";
        if(version == "local"){
            if(parseInt(days) <= 30){
                layer.alert('{% trans "It is only valid for " %}' + days + '{% trans " days" %}' + '!', {
                    title: '{% trans "Info" %}',
                    skin: 'layui-layer-lan',
                    closeBtn: 1,
                    icon: 6,
                    offset: 'rb',
                    btn: false,
                });
            }
        }
	    $(document).bind('contextmenu',function(e){
		    e.preventDefault();
			$('#content_list').menu('show', {
			    left: e.pageX,
				top: e.pageY
			});
		});
		changeSaveAsStatus("disable");
		var tabs = $("#tt").tabs().tabs('tabs');
        for (var i = 0; i < tabs.length; i++) {
            tabs[i].panel('options').tab.unbind().bind('click', { index: i }, function (e) {
                var new_title = ($(this).find(".tabs-title").html());
                var current_tab = getActiveTab();
                if (new_title == '{% trans "View Codes" %}') {
                    var connections = getConnections();
                    // 增加代码的基本条件，如果没有完整的一个条流程，无法查看代码视图。
                    start_text = connections["startID"] + "text";
                    start_confirm_text = connections[start_text]
                    var end_text = ""
                    for (var key in connections) {
                        if (connections[key] == "End"){
                            end_text = "End"
                        }
                    }
                    if (start_confirm_text != "Start" || end_text != "End"){
                        layer.msg(gettext("Opening code view with errors! You have not created a complete process."), {
                            time: 3000,
                            icon: 5,
                        });
                        return false
                    }
                    if (connections.length > 0){
                        layer.load(2);
                        layui.use('table',function() {
                            var table = layui.table;
                            table.render({
                                elem: '#codes_table',
                                skin: 'nob',
                                url: '../getcodes/',
                                method: 'post',
                                where: {"connections":JSON.stringify(connections)},
                                cellMinWidth: 20,
                                id: 'codeTable',
                                cols: [[
                                    {field:'id', width:20, title: 'ID', hide: true},
                                    {field:'code', title: 'Code'}
                                ]]
                                ,done: function(res, curr, count){
                                    layer.closeAll('loading');
                                    var line = parseInt($("#error_line" + current_tab).val()) - 1;
                                    if (line > 0){
                                        $("tr[data-index='" + line + "']").attr({"style":"color:red;background:yellow;"});
                                    }
                                }
                            });
                        });
                        $('th').hide();
                    }else{
                        layui.use('table',function() {
                            var table = layui.table;
                            layui.use('table',function() {
                                var table = layui.table;
                                 table.reload('codeTable',{
                                    data: [],
                                    url: '',
                                });
                            });
                            $('th').hide();
                        });
                    }
                }
            });
        }
	});

    layui.use('slider', function(){
        var $ = layui.$
        ,slider = layui.slider;
        var ins1 = slider.render({
            elem: '#slide'
            ,step: 10
            ,showstep: true
            ,value: 100
            ,min: 70
            ,max: 120
            ,tips: false
            ,change: function(vals){
                var org_size = parseInt($("#screen_size").val());
                if (vals != org_size){
                    $("#screen_size").val(vals);
                    $("#slider_input").text(vals+'%');
                    var message = 'Screen Size: ' + vals.toString() + "%";
                    layer.msg('{% trans "Screen Size" %}: ' + vals.toString() + "%", {
                        offset: 't',
                    });
                    adjScreen(org_size,vals);
                }
            }
        });
    })

    layui.use(['form'], function(){
        var form = layui.form;
        layer = layui.layer;
        $ = layui.$;
        form.render('checkbox');
    })

    // 导航菜单的间隔像素
    {% if 'Draw_Process.views_menu_file_open' in perms %}
    var menuCell = 1;
    layui.use('element', function(){
        var element = layui.element;
        var $ = layui.jquery;
        $.ajax({
            type:'POST',
            url:'../datalist2/',
            dataType:'json',
            async : false,
            data:{},
            success:function(data){
                var dataList = data.rows;
                var data_list = new Array;
                for (var i =0;i<dataList.length;i++){
                    var folder = dataList[i].title;
                    {% if 'Draw_Process.views_menu_file_open_public' in perms %}
                    if (folder == '{% trans "Public" %}'){
                        data_list.push(dataList[i]);
                    }
                    {% endif %}
                    {% if 'Draw_Process.views_menu_file_open_private' in perms %}
                    if (folder == '{% trans "Private" %}'){
                        data_list.push(dataList[i]);
                    }
                    {% endif %}
                    {% if 'Draw_Process.views_menu_file_open_release' in perms %}
                    if (folder == '{% trans "Release" %}'){
                        data_list.push(dataList[i]);
                    }
                    {% endif %}
                }
                var liStr= "";
                // 遍历生成主菜单
                for( var i = 0; i <data_list.length; i++){
                    // 判断是否存在子菜单
                    if(data_list[i].children!=null&&data_list[i].children.length>0){
                        liStr+="<dd><ul><li class=\"layui-nav-item\"><a style=\"margin-left:15px;\" class=\"\" href=\"javascript:;\"><i class='fa fa-folder'></i><span style=\"margin-left:5px;\">"+gettext(data_list[i].title)+"</span></a>\n"+
                                    "<dl class=\"layui-nav-child\">\n";
                        // 遍历获取子菜单
                        for( var k = 0; k <data_list[i].children.length; k++){
                            liStr+=getChildMenu(data_list[i].children[k],0);
                        }
                        liStr+="</dl></li></ul></dd>";
                    }else{
                        liStr+="<dd><ul><li class=\"layui-nav-item\"><a style=\"margin-left:15px;\" class=\"\" href=\"javascript:;\"><i class='fa fa-file-o'></i><span name=\""+data_list[i].path+"\" style=\"margin-left:5px;\">"+data_list[i].title+"</span></a></li></ul></dd>";
                    }
                };
                liStr = '<li class=\"layui-nav-item\"><a href=\"javascript:;\" class=\"rpaMenu insert\"><i class="fa fa-clone" aria-hidden="true"></i><span class=\"functionMenu\">{% trans "Process" %}</span></a><dl class=\"layui-nav-child\">' + liStr + '</dl><li>'
                $("#leftMenu").append(liStr);
                reloadJS("jvisio","../static/javascript/jvisio-flow/jvisio-index2.js");
                $(".layui-nav-bar").attr("class", "zorder:999;");
                element.init();
            }
        })
    });
    {% endif %}

    // 递归生成子菜单
    function getChildMenu(subMenu,num) {
        num++;
        var subStr = "";
        if(subMenu.children!=null&&subMenu.children.length>0){
            subStr+="<dd><ul><li class=\"layui-nav-item\" ><a style=\"margin-left:"+15*(num*menuCell+1)+"px;\" href=\"javascript:;\"><i class='fa fa-folder'></i><span style=\"margin-left:5px;\">"+subMenu.title+"</span></a>" +
                    "<dl class=\"layui-nav-child\">\n";
            for( var j = 0; j <subMenu.children.length; j++){
                subStr+=getChildMenu(subMenu.children[j],num);
            }
            subStr+="</dl></li></ul></dd>";
        }else{
            subStr+="<dd class=\"jnode-box2\" data-template=\"jnode-template\" data-jnode=\"task\" data-jnode-class=\"jnode-task bdc-process\"><a style=\"margin-left:"+15*(num*menuCell+1)+"px;\" href=\"javascript:;\"><i class='fa fa-file-o'></i><span name=\""+subMenu.path+"\" style=\"margin-left:5px;\">"+subMenu.title+"</span></a></dd>";
        }
        return subStr;
    }

    //判断version是否匹配
<!--    var version = "{{ rpa_version }}";-->
<!--    if (version != "same"){-->
<!--        layer.confirm('{% trans "机器人版本不匹配" %}?', {-->
<!--                title:'{% trans "Confirmation" %}',-->
<!--                btn: ['{% trans "Yes" %}', '{% trans "No" %}'],-->
<!--                btn1:function(tab_index){-->
<!--                    layer.close(tab_index);-->
<!--                },-->
<!--                btn2:function(tab_index,layero){-->
<!--                    layer.close(tab_index);-->
<!--                }-->
<!--            });-->
<!--    }-->
</script>
</body>
</html>